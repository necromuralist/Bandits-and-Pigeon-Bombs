<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Notes while learning reinforcement learning.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Reinforcement Learning Notes</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/reinforcement_learning/">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script><link rel="prefetch" href="posts/teaching-a-robot-to-walk/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-default navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://necromuralist.github.io/reinforcement_learning/">

                <span id="blog-title">Reinforcement Learning Notes</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>
                </li>
<li>
<a href="sphinx/index.html">Documentation</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<button type="submit" class="btn btn-primary">
	<span class="glyphicon glyphicon-search"></span>
</button>
<input type="hidden" name="sitesearch" value="https://necromuralist.github.io/reinforcement_learning/">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/teaching-a-robot-to-walk/" class="u-url">Teaching A Robot To Walk</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/cloistered-monkey/">Cloistered Monkey</a>
            </span></p>
            <p class="dateline"><a href="posts/teaching-a-robot-to-walk/" rel="bookmark"><time class="published dt-published" datetime="2018-07-07T13:42:15-07:00" title="2018-07-07 13:42">2018-07-07 13:42</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org6b5e40d" class="outline-2">
<h2 id="org6b5e40d">Imports</h2>
<div class="outline-text-2" id="text-org6b5e40d">
<p>
We need to import <a href="https://gym.openai.com/">openai-gym</a> (as gym).
</p>

<div class="highlight"><pre><span></span><span class="c1"># from pypi</span>
<span class="kn">import</span> <span class="nn">gym</span>
</pre></div>
</div>
</div>

<div id="outline-container-org1a5fd34" class="outline-2">
<h2 id="org1a5fd34">Setting Up the Environment</h2>
<div class="outline-text-2" id="text-org1a5fd34">
<p>
You build the environment with <code>gym.make</code>. In this case we're going to use the <a href="https://gym.openai.com/envs/BipedalWalker-v2/">BipedalWalker-v2</a>, which the documentation describes like this:
</p>

<blockquote>
<p>
Reward is given for moving forward, total 300+ points up to the far end. If the robot falls, it gets -100. Applying motor torque costs a small amount of points, more optimal agent will get better score. State consists of hull angle speed, angular velocity, horizontal speed, vertical speed, position of joints and joints angular speed, legs contact with ground, and 10 lidar rangefinder measurements. There's no coordinates in the state vector.
</p>
</blockquote>

<div class="highlight"><pre><span></span><span class="n">environment</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">"BipedalWalker-v2"</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgc9a2f4f" class="outline-2">
<h2 id="orgc9a2f4f">Running It</h2>
<div class="outline-text-2" id="text-orgc9a2f4f">
<p>
We're going to run this for 10 episodes (each run from start to finish is an episode), resetting the environment for each episode. Then within an episode we're going to have the environment run up to 1,000 steps (a time-step that updates the environment). If it falls down or walks off screen the environment will indicate that it's done.
</p>

<div class="highlight"><pre><span></span><span class="n">EPISODES</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">STEPS</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="n">EPISODES</span><span class="p">:</span>
    <span class="n">observation</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">STEPS</span><span class="p">):</span>
	<span class="n">environment</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
	<span class="n">action</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
	<span class="n">observation</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">done</span><span class="p">:</span>
	    <span class="k">print</span><span class="p">(</span><span class="s2">"It took {} steps to finish this episode."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
	    <span class="k">break</span>
</pre></div>

<p>
It only finished five out of the ten times, probably by falling down each time. Note that I didn't implement any logic to teach the robot to walk, this is all run with built-in functionality.
</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/one-dimensional-world/" class="u-url">One-Dimensional World</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/cloistered-monkey/">Cloistered Monkey</a>
            </span></p>
            <p class="dateline"><a href="posts/one-dimensional-world/" rel="bookmark"><time class="published dt-published" datetime="2018-01-19T11:38:59-08:00" title="2018-01-19 11:38">2018-01-19 11:38</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org5b49773" class="outline-2">
<h2 id="org5b49773">Background</h2>
<div class="outline-text-2" id="text-org5b49773">
<p>
This is take from MorvanZhou's <a href="https://github.com/MorvanZhou/Reinforcement-learning-with-tensorflow">github repository</a>. It uses Q-learning to train an agent to explore a one-dimensional world that has the reward-state at the end of the world.
</p>
</div>
</div>

<div id="outline-container-orgb3113cb" class="outline-2">
<h2 id="orgb3113cb">Tangle</h2>
<div class="outline-text-2" id="text-orgb3113cb">
<p>
This is the no-web tangle block. It shows how the code is organized.
</p>

<div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">constants</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">Q</span><span class="o">-</span><span class="n">Learner</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">episodes</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">terminal</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">q</span><span class="o">-</span><span class="n">environment</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">q</span><span class="o">-</span><span class="n">agent</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">q</span><span class="o">-</span><span class="n">call</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">environment</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">evaluate</span><span class="o">-</span><span class="n">action</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">update</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">goal</span><span class="o">-</span><span class="n">reached</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">reset</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">agent</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">q</span><span class="o">-</span><span class="n">table</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">action</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">act</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">main</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
</div>

<div id="outline-container-org474dbc0" class="outline-2">
<h2 id="org474dbc0">Imports</h2>
<div class="outline-text-2" id="text-org474dbc0">
<p>
The only non-python-standard library requirements are numpy and pandas.
</p>
<div class="highlight"><pre><span></span><span class="c1"># python standard library</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># from pypi</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
</pre></div>
</div>
</div>

<div id="outline-container-org61cd562" class="outline-2">
<h2 id="org61cd562">Constants</h2>
<div class="outline-text-2" id="text-org61cd562">
<p>
The <code>Actions</code> class holds the strings used for the choice of actions. I tend to change my mind about names so I made a central object to store the strings.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Actions</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Left'</span><span class="p">,</span> <span class="s1">'Right'</span><span class="p">]</span>
    <span class="n">move_left</span> <span class="o">=</span> <span class="s1">'Left'</span>
    <span class="n">move_right</span> <span class="o">=</span> <span class="s1">'Right'</span>
</pre></div>
</div>
</div>
<div id="outline-container-orgfbad3bd" class="outline-2">
<h2 id="orgfbad3bd">Q-Learner</h2>
<div class="outline-text-2" id="text-orgfbad3bd">
<p>
This is what will run the reinforcement learning.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">QLearner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""Runs the reinforcement learning</span>

<span class="sd">    Args:</span>
<span class="sd">     episodes: Number of time to repeat training</span>
<span class="sd">     start_state (int): where to start the agent</span>
<span class="sd">     states (int): total size for the environment</span>
<span class="sd">     terminal (int): where the goal state is</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episodes</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">start_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">terminal</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">episodes</span> <span class="o">=</span> <span class="n">episodes</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">start_state</span> <span class="o">=</span> <span class="n">start_state</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="n">states</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_terminal</span> <span class="o">=</span> <span class="n">terminal</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_environment</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_agent</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>
</pre></div>
</div>
<div id="outline-container-orga28526a" class="outline-3">
<h3 id="orga28526a">Terminal</h3>
<div class="outline-text-3" id="text-orga28526a">
<p>
This is the goal state. If it isn't set then it will default to being the rightmost state.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">terminal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Goal state</span>

<span class="sd">    Returns:</span>
<span class="sd">     int: zero-based index of the goal-state</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terminal</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_terminal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terminal</span>
</pre></div>
</div>
</div>
<div id="outline-container-orga2b4f3b" class="outline-3">
<h3 id="orga2b4f3b">Episodes</h3>
<div class="outline-text-3" id="text-orga2b4f3b">
<p>
An 'episode' is a single session that is run until the agent reaches the goal. To improve its performance, you can run it over multiple episodes so it can keep learning.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">episodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""the episodes iterator</span>

<span class="sd">    Returns:</span>
<span class="sd">     range: (1, episodes + 1)</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span>

<span class="nd">@episodes.setter</span>
<span class="k">def</span> <span class="nf">episodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_count</span><span class="p">):</span>
    <span class="sd">"""creates the episodes iterator</span>

<span class="sd">    Args:</span>
<span class="sd">     episode_count(int): number of episodes to train the agent</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">episode_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgf86e99c" class="outline-3">
<h3 id="orgf86e99c">The Q-Environment</h3>
<div class="outline-text-3" id="text-orgf86e99c">
<p>
I couldn't decide who should build the agent and the environment so I had the Q-Learner do it.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">environment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""The Environment for the agent</span>

<span class="sd">    Returns:</span>
<span class="sd">     Environment: one-dimensional environment</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_environment</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_environment</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_state</span><span class="p">,</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">,</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">terminal</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_environment</span>
</pre></div>
</div>
</div>

<div id="outline-container-org96bbf70" class="outline-3">
<h3 id="org96bbf70">The Q-Agent</h3>
<div class="outline-text-3" id="text-org96bbf70">
<p>
Since the Q-Learner is building the environment I'm going to make it build the Agent too.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">agent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""The agent that explores the environment</span>

<span class="sd">    Returns:</span>
<span class="sd">     Agent: agent built for the environment</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span>
</pre></div>
</div>
</div>

<div id="outline-container-org4478e46" class="outline-3">
<h3 id="org4478e46">Call</h3>
<div class="outline-text-3" id="text-org4478e46">
<p>
This runs the episodes.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""runs the episodes to train the agent in the environment</span>

<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">episodes</span><span class="p">:</span>
	<span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">episode</span><span class="p">,</span> <span class="n">counter</span><span class="p">)</span>
	<span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">goal_reached</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">act</span><span class="p">()</span>
	    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">episode</span><span class="p">,</span> <span class="n">counter</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org3d38f7e" class="outline-2">
<h2 id="org3d38f7e">The Environment</h2>
<div class="outline-text-2" id="text-org3d38f7e">
<p>
This will hold the environment for the agent to explore.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Environment</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""The environment to explore</span>

<span class="sd">    Args:</span>
<span class="sd">     start_state(int): where the agent will start</span>
<span class="sd">     states (int): the size of the world</span>
<span class="sd">     terminal (int): where the target state is</span>
<span class="sd">     output_pause (float): seconds to sleep after printing to the screen</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_state</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">terminal</span><span class="p">,</span> <span class="n">output_pause</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">start_state</span> <span class="o">=</span> <span class="n">start_state</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">start_state</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">next_state</span> <span class="o">=</span> <span class="n">start_state</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="n">states</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="n">terminal</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">output_pause</span> <span class="o">=</span> <span class="n">output_pause</span>
	<span class="k">return</span>
</pre></div>
</div>

<div id="outline-container-orga31a631" class="outline-3">
<h3 id="orga31a631">Goal Reached</h3>
<div class="outline-text-3" id="text-orga31a631">
<p>
This is used both to update the q-table and to decide whether to quit the episode. Because updating the q-table requires both the current and next states, it is based on the next state, with the assumption that it will be updated before the next episode
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">goal_reached</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Checks if the next-state is the goal</span>

<span class="sd">    Returns:</span>
<span class="sd">     bool: True if next-state is the goal</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_state</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminal</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgb62d9b7" class="outline-3">
<h3 id="orgb62d9b7">Evaluate Action</h3>
<div class="outline-text-3" id="text-orgb62d9b7">
<p>
This will check if the <code>action</code> will lead to the goal and decide the reward to give for the action. It also sets the <code>next_state</code> property based on the current <code>state</code> and the chosen <code>action</code>.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="sd">"""Checks if the action will lead to the goal</span>

<span class="sd">    Args:</span>
<span class="sd">     action (str): one of the actions to explore the environment</span>

<span class="sd">    Returns:</span>
<span class="sd">     int: 1 if this will lead to the goal, 0 otherwise</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="n">Actions</span><span class="o">.</span><span class="n">move_right</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">next_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">next_state</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">reward</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_state</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminal</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">reward</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge2cc630" class="outline-3">
<h3 id="orge2cc630">Update the Environment</h3>
<div class="outline-text-3" id="text-orge2cc630">
<p>
This prints out the environment for the user and updates the state.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
    <span class="sd">"""Emits the updated environment to the user</span>

<span class="sd">    also sets the state to the next state</span>

<span class="sd">    Args:</span>
<span class="sd">     episode (int): what episode we're in</span>
<span class="sd">     step (int): how long we've been running this episode</span>
<span class="sd">    """</span>
    <span class="n">environment</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'-'</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">'T'</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal_reached</span><span class="p">:</span>
	<span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Episode {}: Total Steps = {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">episode</span><span class="p">,</span> <span class="n">step</span><span class="p">))</span>
	<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_pause</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
	<span class="n">environment</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">next_state</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'O'</span>
	<span class="k">print</span><span class="p">(</span><span class="s2">"{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">environment</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_state</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-org1515e4e" class="outline-3">
<h3 id="org1515e4e">Reset the environment</h3>
<div class="outline-text-3" id="text-org1515e4e">
<p>
This sets the current <code>state</code> and the <code>next-state</code> to the <code>start state</code> so the environment can be re-used in different episodes.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Resets the states to the start state"""</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">next_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_state</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org67f7e35" class="outline-2">
<h2 id="org67f7e35">The Agent</h2>
<div class="outline-text-2" id="text-org67f7e35">
<p>
This is the agent that will learn to find the reward.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Agent</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""This is the agent that will learn to find the treasure</span>

<span class="sd">    Args:</span>
<span class="sd">     environment: The environment to explore</span>
<span class="sd">     exploitation_rate: Fraction of the time to exploit (epsilon)</span>
<span class="sd">     discount_factor: Discount factor (gamma)</span>
<span class="sd">     learning_rate: how much to change the reward (alpha)</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">,</span> <span class="n">exploitation_rate</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">discount_factor</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
		 <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">environment</span> <span class="o">=</span> <span class="n">environment</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">exploitation_rate</span> <span class="o">=</span> <span class="n">exploitation_rate</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">discount_factor</span> <span class="o">=</span> <span class="n">discount_factor</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_q_table</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>
</pre></div>

<p>
Other than the environment, these are the values the <code>Agent</code> needs:
</p>

<ul class="org-ul">
<li>
<code>exploitation_rate</code>: What fraction of the time to use the best known action so far. Setting it to 0 means always use a random action, 1 means only use the best known action.</li>
<li>
<code>discount_factor</code>: The amount to discount the previously discovered reward. Setting it to less than 1 prevents infinite loops.</li>
<li>
<code>learning_rate</code>: How much to update the values in the table. 0 means don't update. 1 means use all of the new information.</li>
</ul>
</div>

<div id="outline-container-org29dbd29" class="outline-3">
<h3 id="org29dbd29">The Q-Table</h3>
<div class="outline-text-3" id="text-org29dbd29">
<p>
The agent learns by building a table of 'Quality' estimates for any action chosen for the current state. Each state is a row in the table and each column is a possible action that can be taken. Initially the table is set to all zeros.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">q_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""The Quality Estimate table</span>

<span class="sd">    Each cell is the quality-estimate for a given state, action pair</span>

<span class="sd">    Returns:</span>
<span class="sd">     DataFrame: rows are states, columns are actions</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q_table</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_q_table</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
	    <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">states</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Actions</span><span class="o">.</span><span class="n">actions</span><span class="p">))),</span>
	    <span class="n">columns</span><span class="o">=</span><span class="n">Actions</span><span class="o">.</span><span class="n">actions</span><span class="p">,</span>
	<span class="p">)</span>
	<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_table</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">states</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Actions</span><span class="o">.</span><span class="n">actions</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q_table</span>
</pre></div>
</div>
</div>

<div id="outline-container-org17937a4" class="outline-3">
<h3 id="org17937a4">Action</h3>
<div class="outline-text-3" id="text-org17937a4">
<p>
Generates an action based on the current state. This is using an epsilon-greedy algorithm so it will explore if the value is above a certain threshold, otherwise it will exploit the best solution so far. It also will explore if the state has never lead to reaching the goal. This was confusing at first, but the updated reward for the current state is calculated based on the next state that this action leads to, so as the episodes continue, the rewards will fill in from the goal-state back to the start state.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return the next chosen action</span>

<span class="sd">    Returns:</span>
<span class="sd">     str: the next action to take</span>
<span class="sd">    """</span>
    <span class="c1"># get the row in the q-table matching the current state</span>
    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="p">:]</span>

    <span class="c1"># only explore if we generate a value over epsilon</span>
    <span class="c1"># or none of the actions have a reward</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">exploitation_rate</span> <span class="ow">or</span> <span class="n">state</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
	<span class="n">action</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">Actions</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># exploit</span>
	<span class="c1"># get the column-name of the cell with the largest value</span>
	<span class="n">action</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">action</span>
</pre></div>
</div>
</div>
<div id="outline-container-orgb6226c3" class="outline-3">
<h3 id="orgb6226c3">Act</h3>
<div class="outline-text-3" id="text-orgb6226c3">
<p>
This gets the next action to take, queries the environment for the reward (which also triggers storing the next state in the environment), then updates the q-table.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">act</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Updates the Q-table based on the reward from the last action"""</span>
    <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span>
    <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="n">previous_quality</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">goal_reached</span><span class="p">:</span>
	<span class="n">new_quality</span> <span class="o">=</span> <span class="n">reward</span>
    <span class="k">else</span><span class="p">:</span>
	<span class="n">new_quality</span> <span class="o">=</span> <span class="n">reward</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">discount_factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">next_state</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">q_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="p">(</span><span class="n">new_quality</span> <span class="o">-</span> <span class="n">previous_quality</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org54fe58b" class="outline-2">
<h2 id="org54fe58b">Main</h2>
<div class="outline-text-2" id="text-org54fe58b">
<p>
Runs the simulation.
</p>

<div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">learner</span> <span class="o">=</span> <span class="n">QLearner</span><span class="p">(</span><span class="n">states</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">learner</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">q_table</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">learned-model with only exploitation set"</span><span class="p">)</span>
    <span class="n">learner</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">exploitation_rate</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">learner</span><span class="o">.</span><span class="n">episodes</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">learner</span><span class="p">()</span>
</pre></div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/PyBrain-Optimization-Example/" class="u-url">PyBrain Optimization Example</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/necromuralist/">necromuralist</a>
            </span></p>
            <p class="dateline"><a href="posts/PyBrain-Optimization-Example/" rel="bookmark"><time class="published dt-published" datetime="2018-01-12T16:16:00-08:00" title="2018-01-12 16:16">2018-01-12 16:16</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>This is the <a class="reference external" href="http://www.pybrain.org/docs/tutorial/optimization.html#general-optimization-using-evolvable">general optimization example</a> from the pybrain documentation.</p>
<div class="section" id="imports">
<h2>1 Imports</h2>
<pre class="code ipython"><a name="rest_code_2f02fdb50d8b4f4bad83603001c8099f-1"></a><span class="c1"># python standard library</span>
<a name="rest_code_2f02fdb50d8b4f4bad83603001c8099f-2"></a><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span>
<a name="rest_code_2f02fdb50d8b4f4bad83603001c8099f-3"></a>
<a name="rest_code_2f02fdb50d8b4f4bad83603001c8099f-4"></a><span class="c1"># pypi</span>
<a name="rest_code_2f02fdb50d8b4f4bad83603001c8099f-5"></a><span class="kn">from</span> <span class="nn">pybrain.structure.evolvables.evolvable</span> <span class="kn">import</span> <span class="n">Evolvable</span>
<a name="rest_code_2f02fdb50d8b4f4bad83603001c8099f-6"></a><span class="kn">from</span> <span class="nn">pybrain.optimization</span> <span class="kn">import</span> <span class="n">HillClimber</span>
</pre>
</div>
<div class="section" id="the-evolvable">
<h2>2 The Evolvable</h2>
<p>To make an optimization that can take arbitrary values (not just continuous numbers), you can implement a sub-class of the PyBrain <a class="reference external" href="http://www.pybrain.org/docs/api/structure/evolvables.html">Evolvable</a> class.</p>
<div class="section" id="the-constructor">
<h3>2.1 The Constructor</h3>
<p>The <tt class="docutils literal">Evolvable</tt> class doesn't implement a constructor so you can create one with any parameters you need.</p>
</div>
<div class="section" id="the-mutate-method">
<h3>2.2 The Mutate Method</h3>
<p>This is the method that is called after each round to change the parameters a little (a <cite>tweak</cite>). It takes positional arguments, but I think it's called by the Hill Climber so I don't know where it gets passed in.</p>
</div>
<div class="section" id="the-copy-method">
<h3>2.3 The Copy Method</h3>
<p>The tutorial says this is a required method, but the documentation for the API says it should default to a deep-copy. Anyway, I think this is only used if you use something like a Genetic Algorithm.</p>
</div>
<div class="section" id="the-randomize-method">
<h3>2.4 The Randomize Method</h3>
<p>This is used to initialize the parameters to a random value. This is required but I'm pretty sure it doesn't get used in this case.</p>
<pre class="code ipython"><a name="rest_code_19a1f63604094cba9483258d3970580d-1"></a><span class="k">class</span> <span class="nc">Mutant</span><span class="p">(</span><span class="n">Evolvable</span><span class="p">):</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-2"></a>    <span class="sd">"""A simple evolvable class</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-3"></a>
<a name="rest_code_19a1f63604094cba9483258d3970580d-4"></a><span class="sd">    Args:</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-5"></a><span class="sd">     x: a starting value to mimic the fitness of the model</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-6"></a><span class="sd">     mininmum: smallest allowed value</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-7"></a><span class="sd">     maximum: biggest allowed value</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-8"></a><span class="sd">    """</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-9"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="n">minimum</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="n">maximum</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-12"></a>        <span class="c1"># minimum &lt;= x &lt;= maximum</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-15"></a>        <span class="k">return</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-16"></a>
<a name="rest_code_19a1f63604094cba9483258d3970580d-17"></a>    <span class="nd">@property</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-18"></a>    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-19"></a>        <span class="sd">"""The value to optimize</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-20"></a>
<a name="rest_code_19a1f63604094cba9483258d3970580d-21"></a><span class="sd">        Returns:</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-22"></a><span class="sd">         x (float): value to optimize</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-23"></a><span class="sd">        """</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-24"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-25"></a>
<a name="rest_code_19a1f63604094cba9483258d3970580d-26"></a>    <span class="nd">@x.setter</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-27"></a>    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_x</span><span class="p">):</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-28"></a>        <span class="sd">"""sets x, constraining the value</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-29"></a>
<a name="rest_code_19a1f63604094cba9483258d3970580d-30"></a><span class="sd">        Args:</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-31"></a><span class="sd">         new_x: float from minimum to maximum</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-32"></a><span class="sd">        """</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-33"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">new_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span><span class="p">))</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-34"></a>        <span class="k">return</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-35"></a>
<a name="rest_code_19a1f63604094cba9483258d3970580d-36"></a>    <span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-37"></a>        <span class="sd">"""Updates x with a random change</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-38"></a>
<a name="rest_code_19a1f63604094cba9483258d3970580d-39"></a><span class="sd">        Maintains the constraint of the value</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-40"></a><span class="sd">        """</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="p">(</span><span class="n">random</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">)</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-42"></a>        <span class="k">return</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-43"></a>
<a name="rest_code_19a1f63604094cba9483258d3970580d-44"></a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-45"></a>        <span class="sd">"""Returns a new instance with the same x-value</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-46"></a>
<a name="rest_code_19a1f63604094cba9483258d3970580d-47"></a><span class="sd">        Returns:</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-48"></a><span class="sd">         Mutant: copy of this instance</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-49"></a><span class="sd">        """</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-50"></a>        <span class="k">return</span> <span class="n">Mutant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-51"></a>
<a name="rest_code_19a1f63604094cba9483258d3970580d-52"></a>    <span class="k">def</span> <span class="nf">randomize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-53"></a>        <span class="sd">"""A method to randomize the x-value"""</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-54"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span> <span class="o">*</span> <span class="n">random</span><span class="p">()</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-55"></a>        <span class="k">return</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-56"></a>
<a name="rest_code_19a1f63604094cba9483258d3970580d-57"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-58"></a>        <span class="sd">"""String representation</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-59"></a>
<a name="rest_code_19a1f63604094cba9483258d3970580d-60"></a><span class="sd">        Returns:</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-61"></a><span class="sd">         str: formatted version of x</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-62"></a><span class="sd">        """</span>
<a name="rest_code_19a1f63604094cba9483258d3970580d-63"></a>        <span class="k">return</span> <span class="s2">"&lt; {:.2f} (Maximized={})&gt;"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span>
</pre>
</div>
</div>
<div class="section" id="hill-climbing">
<h2>3 Hill Climbing</h2>
<p>The <a class="reference external" href="http://www.pybrain.org/docs/api/optimization/optimization.html#module-pybrain.optimization">HillClimber</a> is the simplest search - it assumes the first minima or maxima it finds is the global one. By default it tries to maximize the outcome. None of the arguments are required at instantiation, but in this case we're setting:</p>
<ul class="simple">
<li>an <tt class="docutils literal">evaluator</tt>: a callable that outputs how well the object to be evaluated did</li>
<li>an <tt class="docutils literal">evaluable</tt>: the object to be evaluated in this case our <tt class="docutils literal">Mutant</tt>
</li>
<li>
<tt class="docutils literal">maxEvaluations</tt>: The maximum number of times the <tt class="docutils literal">evaluable</tt> is evaluated</li>
<li>
<tt class="docutils literal">verbose</tt>: print each step</li>
<li>
<tt class="docutils literal">desiredEvaluation</tt>: the value that is good enough so the climber can stop</li>
</ul>
<div class="section" id="the-evaluator-function">
<h3>3.1 The Evaluator Function</h3>
<p>In this case we're just going to return the x value of the object.</p>
<pre class="code ipython"><a name="rest_code_2c10287e073e4e1f934f808e2e113701-1"></a><span class="k">def</span> <span class="nf">evaluator</span><span class="p">(</span><span class="n">mutant</span><span class="p">):</span>
<a name="rest_code_2c10287e073e4e1f934f808e2e113701-2"></a>    <span class="k">return</span> <span class="n">mutant</span><span class="o">.</span><span class="n">x</span>
</pre>
</div>
<div class="section" id="the-instances">
<h3>3.2 The Instances</h3>
<pre class="code ipython"><a name="rest_code_4ad8633146024de695ed7e61b38631f3-1"></a><span class="n">mutant</span> <span class="o">=</span> <span class="n">Mutant</span><span class="p">(</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
<a name="rest_code_4ad8633146024de695ed7e61b38631f3-2"></a><span class="n">climber</span> <span class="o">=</span> <span class="n">HillClimber</span><span class="p">(</span><span class="n">evaluator</span><span class="p">,</span> <span class="n">mutant</span><span class="p">,</span> <span class="n">maxEvaluations</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">desiredEvaluation</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="the-optimization">
<h3>3.3 The Optimization</h3>
<p>The optimization classes get run using their <tt class="docutils literal">learn</tt> methods.</p>
<pre class="code ipython"><a name="rest_code_fd9b54e941cf4b60b7634b6c38103a17-1"></a><span class="n">outcome</span> <span class="o">=</span> <span class="n">climber</span><span class="o">.</span><span class="n">learn</span><span class="p">()</span>
<a name="rest_code_fd9b54e941cf4b60b7634b6c38103a17-2"></a><span class="k">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre>
<pre class="literal-block">
('Step:', 0, 'best:', 6.780765339892317)
('Step:', 1, 'best:', 6.780765339892317)
('Step:', 2, 'best:', 6.807553650921801)
('Step:', 3, 'best:', 7.282574697921699)
('Step:', 4, 'best:', 7.45592511459156)
('Step:', 5, 'best:', 7.533694376079802)
('Step:', 6, 'best:', 7.751507552794123)
('Step:', 7, 'best:', 8.184303418505593)
('Step:', 8, 'best:', 8.184303418505593)
('Step:', 9, 'best:', 8.224264996606221)
('Step:', 10, 'best:', 8.4835021736195)
('Step:', 11, 'best:', 9.153976071682798)
('Step:', 12, 'best:', 9.55795557780446)
('Step:', 13, 'best:', 10)
(&lt; 10.00 (Maximized=True)&gt;, 10)
</pre>
<p>It managed to find the maximum in 13 steps.</p>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/Epsilon-Greedy-with-Normal-Distribution-Payouts/" class="u-url">Epsilon Greedy with Normal-Distribution Payouts</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/brunhilde/">Brunhilde</a>
            </span></p>
            <p class="dateline"><a href="posts/Epsilon-Greedy-with-Normal-Distribution-Payouts/" rel="bookmark"><time class="published dt-published" datetime="2017-08-01T18:48:00-07:00" title="2017-08-01 18:48">2017-08-01 18:48</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Since the Optimistic Initial Values agent can't use the Bernoulli Arm, I'm creating a version of the Epsilon Greedy Optimized that expects the <tt class="docutils literal">arms</tt> to be the population-mean for their payouts and the <tt class="docutils literal">pull_arm</tt> will return a set of normally-distributed around that mean.</p>
<pre class="code python"><a name="rest_code_da387969a3bd43969c2850da5a7c2d62-1"></a><span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-2"></a>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-3"></a><span class="o">&lt;&lt;</span><span class="n">spec</span><span class="o">&gt;&gt;</span>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-4"></a>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-5"></a><span class="o">&lt;&lt;</span><span class="n">find</span><span class="o">-</span><span class="n">first</span><span class="o">&gt;&gt;</span>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-6"></a><span class="nd">@jitclass</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-7"></a><span class="k">class</span> <span class="nc">EpsilonGreedyNormal</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-8"></a>    <span class="sd">"""The Epsilon Greedy Algorithm With Normal Arm</span>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-9"></a>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-10"></a><span class="sd">    Args:</span>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-11"></a><span class="sd">     epsilon (float): fraction of the time to explore</span>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-12"></a><span class="sd">     arms (list): collection of probabilities for bandit arm</span>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-13"></a><span class="sd">    """</span>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-14"></a>    <span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">constructor</span><span class="o">&gt;&gt;</span>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-15"></a>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-16"></a>    <span class="o">&lt;&lt;</span><span class="n">best</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-17"></a>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-18"></a>    <span class="o">&lt;&lt;</span><span class="n">select</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-19"></a>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-20"></a>    <span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">pull</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-21"></a>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-22"></a>    <span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">update</span><span class="o">&gt;&gt;</span>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-23"></a>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-24"></a>    <span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">reset</span><span class="o">&gt;&gt;</span>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-25"></a>
<a name="rest_code_da387969a3bd43969c2850da5a7c2d62-26"></a>    <span class="o">&lt;&lt;</span><span class="n">call</span><span class="o">&gt;&gt;</span>
</pre>
<div class="section" id="optimized-imports">
<h2>1.1 Optimized Imports</h2>
<pre class="code python"><a name="rest_code_53cec2b26b3746f39a85b5613305ffec-1"></a><span class="c1"># pypi</span>
<a name="rest_code_53cec2b26b3746f39a85b5613305ffec-2"></a><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_53cec2b26b3746f39a85b5613305ffec-3"></a>    <span class="n">jit</span><span class="p">,</span>
<a name="rest_code_53cec2b26b3746f39a85b5613305ffec-4"></a>    <span class="n">jitclass</span><span class="p">,</span>
<a name="rest_code_53cec2b26b3746f39a85b5613305ffec-5"></a>    <span class="p">)</span>
<a name="rest_code_53cec2b26b3746f39a85b5613305ffec-6"></a><span class="kn">import</span> <span class="nn">numba</span>
<a name="rest_code_53cec2b26b3746f39a85b5613305ffec-7"></a><span class="kn">import</span> <span class="nn">numpy</span>
</pre>
</div>
<div class="section" id="the-spec">
<h2>1.2 The Spec</h2>
<p>This is how you tell numba what attributes the class will have.</p>
<pre class="code python"><a name="rest_code_865ae0078fb540e9888ac1ea7ede48e9-1"></a><span class="n">spec</span> <span class="o">=</span> <span class="p">[</span>
<a name="rest_code_865ae0078fb540e9888ac1ea7ede48e9-2"></a>    <span class="p">(</span><span class="s2">"epsilon"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">),</span>
<a name="rest_code_865ae0078fb540e9888ac1ea7ede48e9-3"></a>    <span class="p">(</span><span class="s2">"arms"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a name="rest_code_865ae0078fb540e9888ac1ea7ede48e9-4"></a>    <span class="p">(</span><span class="s2">"counts"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a name="rest_code_865ae0078fb540e9888ac1ea7ede48e9-5"></a>    <span class="p">(</span><span class="s2">"rewards"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a name="rest_code_865ae0078fb540e9888ac1ea7ede48e9-6"></a>    <span class="p">(</span><span class="s2">"total_reward"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
<a name="rest_code_865ae0078fb540e9888ac1ea7ede48e9-7"></a><span class="p">]</span>
</pre>
</div>
<div class="section" id="the-constructor">
<h2>1.3 The Constructor</h2>
<p>The constructor takes two arguments - <em>epsilon</em> and <em>arms</em>. The <em>arms</em> list should contain the mean payout for each arm.</p>
<pre class="code python"><a name="rest_code_b2a3580c86f144c7a666a75c6109bc95-1"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">arms</span><span class="p">):</span>
<a name="rest_code_b2a3580c86f144c7a666a75c6109bc95-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
<a name="rest_code_b2a3580c86f144c7a666a75c6109bc95-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="n">arms</span>
<a name="rest_code_b2a3580c86f144c7a666a75c6109bc95-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_b2a3580c86f144c7a666a75c6109bc95-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_b2a3580c86f144c7a666a75c6109bc95-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_b2a3580c86f144c7a666a75c6109bc95-7"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="reset">
<h2>1.4 Reset</h2>
<pre class="code python"><a name="rest_code_0926b1d2c024467eb3277782017d8fc0-1"></a><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_0926b1d2c024467eb3277782017d8fc0-2"></a>    <span class="sd">"""sets the counts, rewards, total_reward to 0s</span>
<a name="rest_code_0926b1d2c024467eb3277782017d8fc0-3"></a>
<a name="rest_code_0926b1d2c024467eb3277782017d8fc0-4"></a><span class="sd">    This lets you re-used the EpsilonGreedy</span>
<a name="rest_code_0926b1d2c024467eb3277782017d8fc0-5"></a><span class="sd">    """</span>
<a name="rest_code_0926b1d2c024467eb3277782017d8fc0-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_0926b1d2c024467eb3277782017d8fc0-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_0926b1d2c024467eb3277782017d8fc0-8"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_0926b1d2c024467eb3277782017d8fc0-9"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="best-arm">
<h2>1.5 Best Arm</h2>
<p>The <tt class="docutils literal">best_arm</tt> property returns the index of the arm that has the highest average reward so far. It returns the index instead of the arm itself because it's used to get the matching counts and rewards in the <tt class="docutils literal">update</tt> method. Since I'm using the <tt class="docutils literal">jitclass</tt> decorator I'm going to get rid of <tt class="docutils literal">first_find</tt>.</p>
<pre class="code python"><a name="rest_code_04febdb970cc4fe5ba593e4d59282922-1"></a><span class="nd">@property</span>
<a name="rest_code_04febdb970cc4fe5ba593e4d59282922-2"></a><span class="k">def</span> <span class="nf">best_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_04febdb970cc4fe5ba593e4d59282922-3"></a>    <span class="sd">"""Index of the arm with the most reward"""</span>
<a name="rest_code_04febdb970cc4fe5ba593e4d59282922-4"></a>    <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<a name="rest_code_04febdb970cc4fe5ba593e4d59282922-5"></a>    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">)):</span>
<a name="rest_code_04febdb970cc4fe5ba593e4d59282922-6"></a>        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
<a name="rest_code_04febdb970cc4fe5ba593e4d59282922-7"></a>            <span class="k">return</span> <span class="n">index</span>
<a name="rest_code_04febdb970cc4fe5ba593e4d59282922-8"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="select-arm">
<h2>1.6 Select Arm</h2>
<p>This differs from the other Epsilon Greedy code only in that I'm using numpy instead of python for the random function.</p>
<pre class="code python"><a name="rest_code_fd1eefc5c3c148d99501b0c43400b4e5-1"></a><span class="k">def</span> <span class="nf">select_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_fd1eefc5c3c148d99501b0c43400b4e5-2"></a>    <span class="sd">"""chooses the next arm to update</span>
<a name="rest_code_fd1eefc5c3c148d99501b0c43400b4e5-3"></a>
<a name="rest_code_fd1eefc5c3c148d99501b0c43400b4e5-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_fd1eefc5c3c148d99501b0c43400b4e5-5"></a><span class="sd">     int: index of the next arm to pull</span>
<a name="rest_code_fd1eefc5c3c148d99501b0c43400b4e5-6"></a><span class="sd">    """</span>
<a name="rest_code_fd1eefc5c3c148d99501b0c43400b4e5-7"></a>    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">:</span>
<a name="rest_code_fd1eefc5c3c148d99501b0c43400b4e5-8"></a>        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_fd1eefc5c3c148d99501b0c43400b4e5-9"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_arm</span>
</pre>
</div>
<div class="section" id="pull-arm">
<h2>1.7 Pull Arm</h2>
<p>Since we can't give user-defined objects as attributes of the class, this version will be both algorithm and bandit. This is what's different from the other Epsilon Greedy algorithms in that we're returning the arm's mean plus a random number from the normal distribution. If numba allowed us to pass in objects maybe we could have just switched out bandits. I need to look into how to make that work.</p>
<pre class="code python"><a name="rest_code_3b0039b7e94e4abfad83f6d8bbcc1169-1"></a><span class="k">def</span> <span class="nf">pull_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">):</span>
<a name="rest_code_3b0039b7e94e4abfad83f6d8bbcc1169-2"></a>    <span class="sd">"""gets the reward</span>
<a name="rest_code_3b0039b7e94e4abfad83f6d8bbcc1169-3"></a>
<a name="rest_code_3b0039b7e94e4abfad83f6d8bbcc1169-4"></a><span class="sd">    Args:</span>
<a name="rest_code_3b0039b7e94e4abfad83f6d8bbcc1169-5"></a><span class="sd">     arm (int): index for the arm-probability array</span>
<a name="rest_code_3b0039b7e94e4abfad83f6d8bbcc1169-6"></a><span class="sd">    Returns:</span>
<a name="rest_code_3b0039b7e94e4abfad83f6d8bbcc1169-7"></a><span class="sd">     float: reward</span>
<a name="rest_code_3b0039b7e94e4abfad83f6d8bbcc1169-8"></a><span class="sd">    """</span>
<a name="rest_code_3b0039b7e94e4abfad83f6d8bbcc1169-9"></a>    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
</pre>
</div>
<div class="section" id="update">
<h2>1.8 Update</h2>
<p>The update method pulls the arm whose index it is given and then updates the count and reward. Here we're calling the <tt class="docutils literal">pull_arm</tt> method instead of using a <tt class="docutils literal">BernoulliArm</tt> so we can't re-use the original method.</p>
<pre class="code python"><a name="rest_code_19a62851d9f0423ebf43e5e21c8d5be3-1"></a><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">):</span>
<a name="rest_code_19a62851d9f0423ebf43e5e21c8d5be3-2"></a>    <span class="sd">"""pulls the arm and updates the value</span>
<a name="rest_code_19a62851d9f0423ebf43e5e21c8d5be3-3"></a>
<a name="rest_code_19a62851d9f0423ebf43e5e21c8d5be3-4"></a><span class="sd">    Args:</span>
<a name="rest_code_19a62851d9f0423ebf43e5e21c8d5be3-5"></a><span class="sd">     arm (int): index of the arm to pull</span>
<a name="rest_code_19a62851d9f0423ebf43e5e21c8d5be3-6"></a><span class="sd">    """</span>
<a name="rest_code_19a62851d9f0423ebf43e5e21c8d5be3-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a name="rest_code_19a62851d9f0423ebf43e5e21c8d5be3-8"></a>    <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
<a name="rest_code_19a62851d9f0423ebf43e5e21c8d5be3-9"></a>    <span class="n">average_reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
<a name="rest_code_19a62851d9f0423ebf43e5e21c8d5be3-10"></a>    <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_arm</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
<a name="rest_code_19a62851d9f0423ebf43e5e21c8d5be3-11"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">+=</span> <span class="n">reward</span>
<a name="rest_code_19a62851d9f0423ebf43e5e21c8d5be3-12"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">))</span> <span class="o">*</span> <span class="n">average_reward</span>
<a name="rest_code_19a62851d9f0423ebf43e5e21c8d5be3-13"></a>                        <span class="o">+</span> <span class="p">(</span><span class="n">reward</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">)))</span>
<a name="rest_code_19a62851d9f0423ebf43e5e21c8d5be3-14"></a>    <span class="k">return</span>
</pre>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/Optimistic-Initial-Values/" class="u-url">Optimistic Initial Values</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/brunhilde/">Brunhilde</a>
            </span></p>
            <p class="dateline"><a href="posts/Optimistic-Initial-Values/" rel="bookmark"><time class="published dt-published" datetime="2017-08-01T18:47:00-07:00" title="2017-08-01 18:47">2017-08-01 18:47</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="introduction">
<h2>1 Introduction</h2>
<p>This is one possible to the n-armed bandit problem. It is similar to the <em>Epsilon Greedy</em> algorithm except that instead of using a conditional to decide whether to explore or exploit, the algorithm sets the estimated (mean) payout for each arm to 1 (the theoretical maximum for our case) and then always exploits. As things proceed, the arms will settle down to their actual payoff-rates and those that haven't been explored will be chosen because they are still too high.</p>
</div>
<div class="section" id="the-tangle">
<h2>2 The Tangle</h2>
<p>This is the no-web template to build the final file.</p>
<pre class="code python"><a name="rest_code_3d43d62f55ec448887d380b3d4ade7eb-1"></a><span class="o">&lt;&lt;</span><span class="n">imports</span><span class="o">&gt;&gt;</span>
<a name="rest_code_3d43d62f55ec448887d380b3d4ade7eb-2"></a>
<a name="rest_code_3d43d62f55ec448887d380b3d4ade7eb-3"></a><span class="o">&lt;&lt;</span><span class="n">spec</span><span class="o">&gt;&gt;</span>
<a name="rest_code_3d43d62f55ec448887d380b3d4ade7eb-4"></a>
<a name="rest_code_3d43d62f55ec448887d380b3d4ade7eb-5"></a><span class="o">&lt;&lt;</span><span class="n">class</span><span class="o">-</span><span class="n">declaration</span><span class="o">&gt;&gt;</span>
<a name="rest_code_3d43d62f55ec448887d380b3d4ade7eb-6"></a>
<a name="rest_code_3d43d62f55ec448887d380b3d4ade7eb-7"></a>    <span class="o">&lt;&lt;</span><span class="n">constructor</span><span class="o">&gt;&gt;</span>
<a name="rest_code_3d43d62f55ec448887d380b3d4ade7eb-8"></a>
<a name="rest_code_3d43d62f55ec448887d380b3d4ade7eb-9"></a>    <span class="o">&lt;&lt;</span><span class="n">select</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a name="rest_code_3d43d62f55ec448887d380b3d4ade7eb-10"></a>
<a name="rest_code_3d43d62f55ec448887d380b3d4ade7eb-11"></a>    <span class="o">&lt;&lt;</span><span class="n">pull</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a name="rest_code_3d43d62f55ec448887d380b3d4ade7eb-12"></a>
<a name="rest_code_3d43d62f55ec448887d380b3d4ade7eb-13"></a>    <span class="o">&lt;&lt;</span><span class="n">update</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a name="rest_code_3d43d62f55ec448887d380b3d4ade7eb-14"></a>
<a name="rest_code_3d43d62f55ec448887d380b3d4ade7eb-15"></a>    <span class="o">&lt;&lt;</span><span class="n">reset</span><span class="o">&gt;&gt;</span>
</pre>
</div>
<div class="section" id="imports">
<h2>3 Imports</h2>
<p>These are our external dependencies.</p>
<pre class="code python"><a name="rest_code_094fe67a3f324db389a039d8ca5315c0-1"></a><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jitclass</span>
<a name="rest_code_094fe67a3f324db389a039d8ca5315c0-2"></a><span class="kn">import</span> <span class="nn">numba</span>
<a name="rest_code_094fe67a3f324db389a039d8ca5315c0-3"></a><span class="kn">import</span> <span class="nn">numpy</span>
</pre>
</div>
<div class="section" id="the-spec">
<h2>4 The Spec</h2>
<p>In order to use numba with the <tt class="docutils literal">OptimisticInitialValues</tt> class you have to create a 'spec' that tells numba what the data-types are for each of its fields.</p>
<pre class="code python"><a name="rest_code_72676d90280e4990abdece090b95f2f3-1"></a><span class="n">SPEC</span> <span class="o">=</span> <span class="p">[</span>
<a name="rest_code_72676d90280e4990abdece090b95f2f3-2"></a>    <span class="p">(</span><span class="s2">"arms"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a name="rest_code_72676d90280e4990abdece090b95f2f3-3"></a>    <span class="p">(</span><span class="s2">"counts"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a name="rest_code_72676d90280e4990abdece090b95f2f3-4"></a>    <span class="p">(</span><span class="s2">"rewards"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a name="rest_code_72676d90280e4990abdece090b95f2f3-5"></a>    <span class="p">(</span><span class="s2">"total_reward"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
<a name="rest_code_72676d90280e4990abdece090b95f2f3-6"></a>    <span class="p">(</span><span class="s2">"initial_reward"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">),</span>
<a name="rest_code_72676d90280e4990abdece090b95f2f3-7"></a><span class="p">]</span>
</pre>
</div>
<div class="section" id="the-class-declaration">
<h2>5 The Class Declaration</h2>
<pre class="code python"><a name="rest_code_bb240b82d9af4491aaf2bb5eaa737bd6-1"></a><span class="nd">@jitclass</span><span class="p">(</span><span class="n">SPEC</span><span class="p">)</span>
<a name="rest_code_bb240b82d9af4491aaf2bb5eaa737bd6-2"></a><span class="k">class</span> <span class="nc">OptimisticInitialValues</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_bb240b82d9af4491aaf2bb5eaa737bd6-3"></a>    <span class="sd">"""Optimistic Initial Values greedy algorithm</span>
<a name="rest_code_bb240b82d9af4491aaf2bb5eaa737bd6-4"></a>
<a name="rest_code_bb240b82d9af4491aaf2bb5eaa737bd6-5"></a><span class="sd">    Args:</span>
<a name="rest_code_bb240b82d9af4491aaf2bb5eaa737bd6-6"></a><span class="sd">     numpy.array[float]: payout-probabilities for each arm</span>
<a name="rest_code_bb240b82d9af4491aaf2bb5eaa737bd6-7"></a><span class="sd">    """</span>
</pre>
</div>
<div class="section" id="the-constructor">
<h2>6 The Constructor</h2>
<p>Here's our first change from the epsilon-greedy algorithm. We no longer have an <tt class="docutils literal">epsilon</tt> value and instead of initializing the <tt class="docutils literal">rewards</tt> as zeros we initialize them with an 'initial' reward. Also, although you can't see it here, the arms have to be a list of mean payout values (see the <tt class="docutils literal">pull_arm</tt> method below).</p>
<pre class="code python"><a name="rest_code_da54e378a7884e4d87bc46dbbc0559de-1"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arms</span><span class="p">,</span> <span class="n">initial_reward</span><span class="p">):</span>
<a name="rest_code_da54e378a7884e4d87bc46dbbc0559de-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="n">arms</span>
<a name="rest_code_da54e378a7884e4d87bc46dbbc0559de-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_da54e378a7884e4d87bc46dbbc0559de-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arms</span><span class="p">))</span> <span class="o">+</span> <span class="n">initial_reward</span>
<a name="rest_code_da54e378a7884e4d87bc46dbbc0559de-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_da54e378a7884e4d87bc46dbbc0559de-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">initial_reward</span> <span class="o">=</span> <span class="n">initial_reward</span>
<a name="rest_code_da54e378a7884e4d87bc46dbbc0559de-7"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="select-arm">
<h2>7 Select Arm</h2>
<p>This chooses the next arm. Unlike the epsilon-greedy algorithm it will always pick the 'best' arm, choosing the first if there is a tie. Since the whole class is in the jit I'm also not using the external <tt class="docutils literal">find_first</tt> method.</p>
<pre class="code python"><a name="rest_code_d34c28e22dfb4b86b528e64f5ba33e24-1"></a><span class="k">def</span> <span class="nf">select_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_d34c28e22dfb4b86b528e64f5ba33e24-2"></a>    <span class="sd">"""Index of the arm with the most reward</span>
<a name="rest_code_d34c28e22dfb4b86b528e64f5ba33e24-3"></a>
<a name="rest_code_d34c28e22dfb4b86b528e64f5ba33e24-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_d34c28e22dfb4b86b528e64f5ba33e24-5"></a><span class="sd">     integer: index of arm with highest average reward</span>
<a name="rest_code_d34c28e22dfb4b86b528e64f5ba33e24-6"></a><span class="sd">    """</span>
<a name="rest_code_d34c28e22dfb4b86b528e64f5ba33e24-7"></a>    <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<a name="rest_code_d34c28e22dfb4b86b528e64f5ba33e24-8"></a>    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">)):</span>
<a name="rest_code_d34c28e22dfb4b86b528e64f5ba33e24-9"></a>        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
<a name="rest_code_d34c28e22dfb4b86b528e64f5ba33e24-10"></a>            <span class="k">return</span> <span class="n">index</span>
</pre>
</div>
<div class="section" id="pull-arm">
<h2>8 Pull Arm</h2>
<p>This gets the reward for the arm. with a Bernoulli arm, there's a chance that an arm will be set to 0 on its first pull, at which point you will never explore it (since there's no exploration), so even the best arm might get wiped out. To fix this you need a different scheme. This one uses a population mean (selected <tt class="docutils literal">from self.arms</tt>) which has noise added by selecting from the standard normal distribution.</p>
<pre class="code python"><a name="rest_code_c9539a9322b14bd2ad669f1a6e083052-1"></a><span class="k">def</span> <span class="nf">pull_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">):</span>
<a name="rest_code_c9539a9322b14bd2ad669f1a6e083052-2"></a>    <span class="sd">"""gets the reward</span>
<a name="rest_code_c9539a9322b14bd2ad669f1a6e083052-3"></a>
<a name="rest_code_c9539a9322b14bd2ad669f1a6e083052-4"></a><span class="sd">    Args:</span>
<a name="rest_code_c9539a9322b14bd2ad669f1a6e083052-5"></a><span class="sd">     arm (int): index for the arm population-mean array</span>
<a name="rest_code_c9539a9322b14bd2ad669f1a6e083052-6"></a><span class="sd">    Returns:</span>
<a name="rest_code_c9539a9322b14bd2ad669f1a6e083052-7"></a><span class="sd">     float: payout for the arm</span>
<a name="rest_code_c9539a9322b14bd2ad669f1a6e083052-8"></a><span class="sd">    """</span>
<a name="rest_code_c9539a9322b14bd2ad669f1a6e083052-9"></a>    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
</pre>
</div>
<div class="section" id="update-arm">
<h2>9 Update Arm</h2>
<p>This pulls the arm and updates the reward. This works the same as the <tt class="docutils literal"><span class="pre">epsilon-greedy</span></tt> version does.</p>
<pre class="code python"><a name="rest_code_89188c86760f4da1bf6f0f2ca889f8c9-1"></a><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">):</span>
<a name="rest_code_89188c86760f4da1bf6f0f2ca889f8c9-2"></a>    <span class="sd">"""pulls the arm and updates the average reward</span>
<a name="rest_code_89188c86760f4da1bf6f0f2ca889f8c9-3"></a>
<a name="rest_code_89188c86760f4da1bf6f0f2ca889f8c9-4"></a><span class="sd">    also updates the total_reward the algorithm has earned so far</span>
<a name="rest_code_89188c86760f4da1bf6f0f2ca889f8c9-5"></a>
<a name="rest_code_89188c86760f4da1bf6f0f2ca889f8c9-6"></a><span class="sd">    Args:</span>
<a name="rest_code_89188c86760f4da1bf6f0f2ca889f8c9-7"></a><span class="sd">     arm (int): index of the arm to pull</span>
<a name="rest_code_89188c86760f4da1bf6f0f2ca889f8c9-8"></a><span class="sd">    """</span>
<a name="rest_code_89188c86760f4da1bf6f0f2ca889f8c9-9"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a name="rest_code_89188c86760f4da1bf6f0f2ca889f8c9-10"></a>    <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
<a name="rest_code_89188c86760f4da1bf6f0f2ca889f8c9-11"></a>    <span class="n">average_reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
<a name="rest_code_89188c86760f4da1bf6f0f2ca889f8c9-12"></a>    <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_arm</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
<a name="rest_code_89188c86760f4da1bf6f0f2ca889f8c9-13"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">+=</span> <span class="n">reward</span>
<a name="rest_code_89188c86760f4da1bf6f0f2ca889f8c9-14"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">))</span> <span class="o">*</span> <span class="n">average_reward</span>
<a name="rest_code_89188c86760f4da1bf6f0f2ca889f8c9-15"></a>                         <span class="o">+</span> <span class="p">(</span><span class="n">reward</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">)))</span>
<a name="rest_code_89188c86760f4da1bf6f0f2ca889f8c9-16"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="reset">
<h2>10 Reset</h2>
<p>This resets the values so that you can re-use the algorithm. As with the constructor, it sets the <tt class="docutils literal">rewards</tt> to all ones instead of zeros as was the case with the epsilon-greedy algorithm.</p>
<pre class="code python"><a name="rest_code_ce5660285bb149e4be8059b15828b78a-1"></a><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_ce5660285bb149e4be8059b15828b78a-2"></a>    <span class="sd">"""sets the counts, rewards, total_reward to 0s</span>
<a name="rest_code_ce5660285bb149e4be8059b15828b78a-3"></a>
<a name="rest_code_ce5660285bb149e4be8059b15828b78a-4"></a><span class="sd">    This lets you re-used the EpsilonGreedy</span>
<a name="rest_code_ce5660285bb149e4be8059b15828b78a-5"></a><span class="sd">    """</span>
<a name="rest_code_ce5660285bb149e4be8059b15828b78a-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_ce5660285bb149e4be8059b15828b78a-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_reward</span>
<a name="rest_code_ce5660285bb149e4be8059b15828b78a-8"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_ce5660285bb149e4be8059b15828b78a-9"></a>    <span class="k">return</span>
</pre>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/assessing-the-performance/" class="u-url">Assessing the Performance</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/hades/">hades</a>
            </span></p>
            <p class="dateline"><a href="posts/assessing-the-performance/" rel="bookmark"><time class="published dt-published" datetime="2017-08-01T18:46:00-07:00" title="2017-08-01 18:46">2017-08-01 18:46</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="introduction">
<h2>1 Introduction</h2>
<p>As with the Epsilon-Greedy algorithm I'm going to use the Cumulative Reward as the metric. In this case we don't really have a parameter to tune.</p>
</div>
<div class="section" id="imports">
<h2>2 Imports</h2>
<p>The dependencies.</p>
<pre class="code ipython"><a name="rest_code_470478eeeb404670a80ca4a9aa8abf24-1"></a><span class="c1"># python standard library</span>
<a name="rest_code_470478eeeb404670a80ca4a9aa8abf24-2"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<a name="rest_code_470478eeeb404670a80ca4a9aa8abf24-3"></a>
<a name="rest_code_470478eeeb404670a80ca4a9aa8abf24-4"></a><span class="c1"># pypi</span>
<a name="rest_code_470478eeeb404670a80ca4a9aa8abf24-5"></a><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jit</span>
<a name="rest_code_470478eeeb404670a80ca4a9aa8abf24-6"></a><span class="kn">import</span> <span class="nn">numpy</span>
<a name="rest_code_470478eeeb404670a80ca4a9aa8abf24-7"></a><span class="kn">import</span> <span class="nn">pandas</span>
<a name="rest_code_470478eeeb404670a80ca4a9aa8abf24-8"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plot</span>
<a name="rest_code_470478eeeb404670a80ca4a9aa8abf24-9"></a><span class="kn">import</span> <span class="nn">seaborn</span>
<a name="rest_code_470478eeeb404670a80ca4a9aa8abf24-10"></a>
<a name="rest_code_470478eeeb404670a80ca4a9aa8abf24-11"></a><span class="c1"># this project</span>
<a name="rest_code_470478eeeb404670a80ca4a9aa8abf24-12"></a><span class="kn">from</span> <span class="nn">optimistic_initial_values</span> <span class="kn">import</span> <span class="n">OptimisticInitialValues</span>
<a name="rest_code_470478eeeb404670a80ca4a9aa8abf24-13"></a><span class="kn">from</span> <span class="nn">epsilon_greedy_normal</span> <span class="kn">import</span> <span class="n">EpsilonGreedyNormal</span>
</pre>
</div>
<div class="section" id="set-up-the-plotting">
<h2>3 Set-up the Plotting</h2>
<p>This will enable the plotting and set the style.</p>
<pre class="code ipython"><a name="rest_code_36fb7ba1399144aab2f0f2f574dde833-1"></a><span class="o">%</span><span class="k">matplotlib</span> inline
<a name="rest_code_36fb7ba1399144aab2f0f2f574dde833-2"></a><span class="n">seaborn</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="running-the-assessment">
<h2>4 Running the Assessment</h2>
<pre class="code ipython"><a name="rest_code_5088e976d842497498ee0088acf31011-1"></a><span class="nd">@jit</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-2"></a><span class="k">def</span> <span class="nf">cumulative_reward</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">400</span><span class="p">):</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-3"></a>    <span class="sd">"""this generates the cumulative reward as the agent pulls the arms</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-4"></a>
<a name="rest_code_5088e976d842497498ee0088acf31011-5"></a><span class="sd">    Args:</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-6"></a><span class="sd">     agent: implementation that selects and updates the arms</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-7"></a><span class="sd">     trials (int): number of times to train the agent</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-8"></a><span class="sd">     times (int): length of time to train the agent</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-9"></a><span class="sd">    Returns:</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-10"></a><span class="sd">     numpy.array: average cumulative rewards over time</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-11"></a><span class="sd">    """</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-12"></a>    <span class="n">cumulative_rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-13"></a>    <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-14"></a>        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-15"></a>            <span class="n">arm</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">select_arm</span><span class="p">()</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-16"></a>            <span class="n">agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-17"></a>            <span class="n">cumulative_rewards</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">+=</span> <span class="n">agent</span><span class="o">.</span><span class="n">total_reward</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-18"></a>        <span class="n">agent</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a name="rest_code_5088e976d842497498ee0088acf31011-19"></a>    <span class="k">return</span> <span class="n">cumulative_rewards</span><span class="o">/</span><span class="n">trials</span>
</pre>
<pre class="code ipython"><a name="rest_code_e91f155c7ffd4c9b90fc5a183ba36291-1"></a><span class="k">def</span> <span class="nf">plot_cumulative</span><span class="p">(</span><span class="n">cumulative</span><span class="p">):</span>
<a name="rest_code_e91f155c7ffd4c9b90fc5a183ba36291-2"></a>    <span class="sd">"""generates and plots cumulative average</span>
<a name="rest_code_e91f155c7ffd4c9b90fc5a183ba36291-3"></a>
<a name="rest_code_e91f155c7ffd4c9b90fc5a183ba36291-4"></a><span class="sd">    Args:</span>
<a name="rest_code_e91f155c7ffd4c9b90fc5a183ba36291-5"></a><span class="sd">     cumulative (pandas.DataFrame): data to plot</span>
<a name="rest_code_e91f155c7ffd4c9b90fc5a183ba36291-6"></a><span class="sd">    """</span>
<a name="rest_code_e91f155c7ffd4c9b90fc5a183ba36291-7"></a>    <span class="n">figure</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a name="rest_code_e91f155c7ffd4c9b90fc5a183ba36291-8"></a>    <span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<a name="rest_code_e91f155c7ffd4c9b90fc5a183ba36291-9"></a>    <span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Cumulative Reward of the Optimistic Initial Values Algorithm ({} trials)"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TRIALS</span><span class="p">))</span>
<a name="rest_code_e91f155c7ffd4c9b90fc5a183ba36291-10"></a>    <span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Time (number of pulls on the arm)"</span><span class="p">)</span>
<a name="rest_code_e91f155c7ffd4c9b90fc5a183ba36291-11"></a>    <span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Cumulative Reward"</span><span class="p">)</span>
<a name="rest_code_e91f155c7ffd4c9b90fc5a183ba36291-12"></a>    <span class="n">cumulative</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
<a name="rest_code_e91f155c7ffd4c9b90fc5a183ba36291-13"></a>    <span class="k">return</span>
</pre>
<pre class="code ipython"><a name="rest_code_fbe49364bad2422a95c0fd932b8b9e62-1"></a><span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">5000</span>
<a name="rest_code_fbe49364bad2422a95c0fd932b8b9e62-2"></a><span class="n">TIMES</span> <span class="o">=</span> <span class="mi">400</span>
<a name="rest_code_fbe49364bad2422a95c0fd932b8b9e62-3"></a><span class="n">similar_payout_rates</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span>
<a name="rest_code_fbe49364bad2422a95c0fd932b8b9e62-4"></a><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">similar_payout_rates</span><span class="p">)</span>
<a name="rest_code_fbe49364bad2422a95c0fd932b8b9e62-5"></a><span class="n">one_good_arm_rates</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="p">[</span><span class="mf">9.0</span><span class="p">])</span>
<a name="rest_code_fbe49364bad2422a95c0fd932b8b9e62-6"></a><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">one_good_arm_rates</span><span class="p">)</span>
</pre>
<div class="section" id="similar-arms">
<h3>4.1 Similar Arms</h3>
<p>This will create a range where each arm only differs by 0.1</p>
<pre class="code ipython"><a name="rest_code_e4202bf9f9db4ba3b03001746dbe1faa-1"></a><span class="n">optimistic_agent</span> <span class="o">=</span> <span class="n">OptimisticInitialValues</span><span class="p">(</span><span class="n">similar_payout_rates</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
<a name="rest_code_e4202bf9f9db4ba3b03001746dbe1faa-2"></a><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
<a name="rest_code_e4202bf9f9db4ba3b03001746dbe1faa-3"></a><span class="n">data</span><span class="p">[</span><span class="s2">"Optimistic Initial Values"</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative_reward</span><span class="p">(</span><span class="n">optimistic_agent</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">TIMES</span><span class="p">)</span>
<a name="rest_code_e4202bf9f9db4ba3b03001746dbe1faa-4"></a><span class="n">epsilon_agent</span> <span class="o">=</span> <span class="n">EpsilonGreedyNormal</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">similar_payout_rates</span><span class="p">)</span>
<a name="rest_code_e4202bf9f9db4ba3b03001746dbe1faa-5"></a><span class="n">data</span><span class="p">[</span><span class="s2">"Epsilon Greedy (0.1)"</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative_reward</span><span class="p">(</span><span class="n">epsilon_agent</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">TIMES</span><span class="p">)</span>
<a name="rest_code_e4202bf9f9db4ba3b03001746dbe1faa-6"></a><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a name="rest_code_e4202bf9f9db4ba3b03001746dbe1faa-7"></a><span class="n">plot_cumulative</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre>
<img alt="optimistic_similar_cumulative.png" src="posts/assessing-the-performance/optimistic_similar_cumulative.png"><p>The Optimistic Initial Values agent does better than the Epsilon Greedy, as you would expect (since it eventually stops exploring). But it looks suspisciously linear.</p>
</div>
<div class="section" id="one-good-arm">
<h3>4.2 One Good Arm</h3>
<p>Lets see how it goes when one arm dominates the payouts.</p>
<pre class="code ipython"><a name="rest_code_f700a5d944f94d90bfb9dbdffa071196-1"></a><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">one_good_arm_rates</span><span class="p">)</span>
<a name="rest_code_f700a5d944f94d90bfb9dbdffa071196-2"></a><span class="n">optimistic_agent</span> <span class="o">=</span> <span class="n">OptimisticInitialValues</span><span class="p">(</span><span class="n">one_good_arm_rates</span><span class="p">,</span> <span class="mf">10.</span><span class="p">)</span>
<a name="rest_code_f700a5d944f94d90bfb9dbdffa071196-3"></a><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
<a name="rest_code_f700a5d944f94d90bfb9dbdffa071196-4"></a><span class="n">data</span><span class="p">[</span><span class="s2">"Optimistic Initial Values"</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative_reward</span><span class="p">(</span><span class="n">optimistic_agent</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">TIMES</span><span class="p">)</span>
<a name="rest_code_f700a5d944f94d90bfb9dbdffa071196-5"></a><span class="n">epsilon_agent</span> <span class="o">=</span> <span class="n">EpsilonGreedyNormal</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">one_good_arm_rates</span><span class="p">)</span>
<a name="rest_code_f700a5d944f94d90bfb9dbdffa071196-6"></a><span class="n">data</span><span class="p">[</span><span class="s2">"Epsilon Greedy (0.1)"</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative_reward</span><span class="p">(</span><span class="n">epsilon_agent</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">TIMES</span><span class="p">)</span>
<a name="rest_code_f700a5d944f94d90bfb9dbdffa071196-7"></a><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a name="rest_code_f700a5d944f94d90bfb9dbdffa071196-8"></a><span class="n">plot_cumulative</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre>
<img alt="optimistic_cumulative_one_good_arm.png" src="posts/assessing-the-performance/optimistic_cumulative_one_good_arm.png"><p>It looks like the optimistic agent does even better with one dominant arm. Likely because it found it quick enough that always exploiting it gives it a huge advantage over the epsilon greedy, which never stops exploring.</p>
<pre class="code ipython"><a name="rest_code_89ce97f0090245438df0b00ca2a05772-1"></a><span class="nd">@jit</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-2"></a><span class="k">def</span> <span class="nf">average_reward</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-3"></a>    <span class="sd">"""this generates the average reward for the trials over time</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-4"></a>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-5"></a><span class="sd">    Args:</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-6"></a><span class="sd">     trials (int): number of times to train the agent</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-7"></a><span class="sd">     times (int): length of time to train the agent</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-9"></a><span class="sd">     numpy.array: the average reward</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-10"></a><span class="sd">    """</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-11"></a>    <span class="n">average_rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-12"></a>    <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-13"></a>        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-14"></a>            <span class="n">arm</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">select_arm</span><span class="p">()</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-15"></a>            <span class="n">old_reward</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">total_reward</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-16"></a>            <span class="n">agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-17"></a>            <span class="n">average_rewards</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">-</span> <span class="n">old_reward</span><span class="p">)</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-18"></a>        <span class="n">agent</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a name="rest_code_89ce97f0090245438df0b00ca2a05772-19"></a>    <span class="k">return</span> <span class="n">average_rewards</span><span class="o">/</span><span class="n">trials</span>
</pre>
<pre class="code ipython"><a name="rest_code_493ab2bb18e64c8f8dd038db6c1198df-1"></a><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
<a name="rest_code_493ab2bb18e64c8f8dd038db6c1198df-2"></a><span class="n">data</span><span class="p">[</span><span class="s2">"Optimistic Initial Values"</span><span class="p">]</span> <span class="o">=</span> <span class="n">average_reward</span><span class="p">(</span><span class="n">optimistic_agent</span><span class="p">,</span> <span class="n">TIMES</span><span class="p">,</span> <span class="n">TRIALS</span><span class="p">)</span>
<a name="rest_code_493ab2bb18e64c8f8dd038db6c1198df-3"></a><span class="n">data</span><span class="p">[</span><span class="s2">"Epsilon 0.1"</span><span class="p">]</span> <span class="o">=</span> <span class="n">average_reward</span><span class="p">(</span><span class="n">epsilon_agent</span><span class="p">,</span> <span class="n">TIMES</span><span class="p">,</span> <span class="n">TRIALS</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_0d7788727eae4a418a37b68eaf63dd8a-1"></a><span class="n">averages</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_ae6c43cabdb7467fad6f3ec6c15697b0-1"></a><span class="n">figure</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a name="rest_code_ae6c43cabdb7467fad6f3ec6c15697b0-2"></a><span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<a name="rest_code_ae6c43cabdb7467fad6f3ec6c15697b0-3"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Average Reward (One Dominant Arm)"</span><span class="p">)</span>
<a name="rest_code_ae6c43cabdb7467fad6f3ec6c15697b0-4"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Time (number of pulls on the arm)"</span><span class="p">)</span>
<a name="rest_code_ae6c43cabdb7467fad6f3ec6c15697b0-5"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Average Reward"</span><span class="p">)</span>
<a name="rest_code_ae6c43cabdb7467fad6f3ec6c15697b0-6"></a><span class="n">averages</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'.'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">"None"</span><span class="p">)</span>
</pre>
<img alt="optimistic_averages.png" src="posts/assessing-the-performance/optimistic_averages.png"><p>It looks like there was a brief period where the Epsilon Greedy did better, but the Optimistic agent settled in fairly quickly.</p>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/finding-the-best-epsilon/" class="u-url">Finding the Best Epsilon</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/hades/">hades</a>
            </span></p>
            <p class="dateline"><a href="posts/finding-the-best-epsilon/" rel="bookmark"><time class="published dt-published" datetime="2017-07-30T18:41:00-07:00" title="2017-07-30 18:41">2017-07-30 18:41</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="posts/finding-the-best-epsilon/#introduction" id="id1">1 Introduction</a></li>
<li><a class="reference internal" href="posts/finding-the-best-epsilon/#imports" id="id2">2 Imports</a></li>
<li><a class="reference internal" href="posts/finding-the-best-epsilon/#set-up-the-plotting" id="id3">3 Set-up the Plotting</a></li>
<li>
<a class="reference internal" href="posts/finding-the-best-epsilon/#the-probabilities" id="id4">4 The Probabilities</a><ul>
<li><a class="reference internal" href="posts/finding-the-best-epsilon/#generate-the-probabilities" id="id5">4.1 Generate the Probabilities</a></li>
<li><a class="reference internal" href="posts/finding-the-best-epsilon/#inspecting-the-outcome" id="id6">4.2 Inspecting the Outcome</a></li>
</ul>
</li>
<li><a class="reference internal" href="posts/finding-the-best-epsilon/#average-reward" id="id7">5 Average Reward</a></li>
<li>
<a class="reference internal" href="posts/finding-the-best-epsilon/#cumulative-reward" id="id8">6 Cumulative Reward</a><ul>
<li><a class="reference internal" href="posts/finding-the-best-epsilon/#imbalanced-case" id="id9">6.1 Imbalanced Case</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id1">1 Introduction</a></h2>
<p>This is one of the ways to characterize the performance of the <em>Epsilon Greedy</em> agent using our <em>Bernoulli Arm</em>. We are going to look at three ways to evaluate how well the algorithm does.</p>
<ul class="simple">
<li>probability of using the best arm</li>
<li>average reward</li>
<li>cumulative reward</li>
</ul>
</div>
<div class="section" id="imports">
<h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id2">2 Imports</a></h2>
<pre class="code ipython"><a name="rest_code_9566dfce869447e6afc25f6f15c724f8-1"></a><span class="c1"># python standard library</span>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-2"></a><span class="kn">import</span> <span class="nn">random</span>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-3"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-4"></a>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-5"></a><span class="c1"># pypi</span>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-6"></a><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jit</span>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-7"></a><span class="kn">import</span> <span class="nn">numpy</span>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-8"></a><span class="kn">import</span> <span class="nn">pandas</span>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-9"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plot</span>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-10"></a><span class="kn">import</span> <span class="nn">seaborn</span>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-11"></a>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-12"></a><span class="c1"># this project</span>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-13"></a><span class="kn">from</span> <span class="nn">epsilon_greedy</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-14"></a>    <span class="n">EpsilonGreedy</span><span class="p">,</span>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-15"></a>    <span class="n">find_first</span>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-16"></a><span class="p">)</span>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-17"></a><span class="kn">from</span> <span class="nn">epsilon_greedy_optimized</span> <span class="kn">import</span> <span class="n">EpsilonGreedyOptimized</span>
<a name="rest_code_9566dfce869447e6afc25f6f15c724f8-18"></a><span class="kn">from</span> <span class="nn">bernoulli_arm</span> <span class="kn">import</span> <span class="n">BernoulliArm</span>
</pre>
</div>
<div class="section" id="set-up-the-plotting">
<h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id3">3 Set-up the Plotting</a></h2>
<p>This will enable the plotting and set the style.</p>
<pre class="code ipython"><a name="rest_code_2ec146ec395d4c76bd6bcc9d96af1655-1"></a><span class="o">%</span><span class="k">matplotlib</span> inline
<a name="rest_code_2ec146ec395d4c76bd6bcc9d96af1655-2"></a><span class="n">seaborn</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="the-probabilities">
<h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id4">4 The Probabilities</a></h2>
<div class="section" id="generate-the-probabilities">
<h3><a class="toc-backref" href="posts/finding-the-best-epsilon/#id5">4.1 Generate the Probabilities</a></h3>
<p>This code will run generate the probabilities. Although I made it so that using the <tt class="docutils literal">EpsilonGreedy</tt> call method would both choose the arm and update the reward, in this case we need to know which arm was selected so I'm going to do the steps individually.</p>
<pre class="code ipython"><a name="rest_code_2734695ef4a346879a158aaab60f5d01-1"></a><span class="k">def</span> <span class="nf">generate_probabilities</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-2"></a>    <span class="sd">"""this generates the probabilites for finding the best arm</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-3"></a>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-4"></a><span class="sd">    Args:</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-5"></a><span class="sd">     trials (int): number of times to train the agent</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-6"></a><span class="sd">     times (int): length of time to train the agent</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-8"></a><span class="sd">     Dict: the probabilites for each epsilon over time</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-9"></a><span class="sd">     """</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-10"></a>    <span class="n">arm_probabilities</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-11"></a>    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">arm_probabilities</span><span class="p">)</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-12"></a>    <span class="n">best_arm</span> <span class="o">=</span> <span class="n">arm_probabilities</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">arm_probabilities</span><span class="p">))</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-13"></a>    <span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="n">BernoulliArm</span><span class="p">(</span><span class="n">probability</span><span class="p">)</span> <span class="k">for</span> <span class="n">probability</span> <span class="ow">in</span> <span class="n">arm_probabilities</span><span class="p">]</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-14"></a>    <span class="n">epsilons</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-15"></a>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-16"></a>    <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{}</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-17"></a>    <span class="k">for</span> <span class="n">epsilon</span> <span class="ow">in</span> <span class="n">epsilons</span><span class="p">:</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-18"></a>        <span class="n">agent</span> <span class="o">=</span> <span class="n">EpsilonGreedy</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">arms</span><span class="p">)</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-19"></a>        <span class="n">probabilities</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-20"></a>        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-21"></a>            <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-22"></a>                <span class="n">arm</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">select_arm</span><span class="p">()</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-23"></a>                <span class="n">agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-24"></a>                <span class="k">if</span> <span class="n">arm</span> <span class="o">==</span> <span class="n">best_arm</span><span class="p">:</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-25"></a>                    <span class="n">probabilities</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-26"></a>            <span class="n">agent</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-27"></a>        <span class="n">outcomes</span><span class="p">[</span><span class="s2">"Epsilon {:.02f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)]</span> <span class="o">=</span> <span class="n">probabilities</span><span class="o">/</span><span class="n">times</span>
<a name="rest_code_2734695ef4a346879a158aaab60f5d01-28"></a>    <span class="k">return</span> <span class="n">outcomes</span>
</pre>
</div>
<div class="section" id="inspecting-the-outcome">
<h3><a class="toc-backref" href="posts/finding-the-best-epsilon/#id6">4.2 Inspecting the Outcome</a></h3>
<pre class="code ipython"><a name="rest_code_3cd428fbcb7241ed824c26d3f7adbc5b-1"></a><span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">5000</span>
<a name="rest_code_3cd428fbcb7241ed824c26d3f7adbc5b-2"></a><span class="n">TIMES</span> <span class="o">=</span> <span class="mi">400</span>
</pre>
<pre class="code ipython"><a name="rest_code_be9a3375be39424088d622fca6913db3-1"></a><span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a name="rest_code_be9a3375be39424088d622fca6913db3-2"></a><span class="n">probabilities</span> <span class="o">=</span> <span class="n">generate_probabilities</span><span class="p">(</span><span class="n">trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">TIMES</span><span class="p">)</span>
<a name="rest_code_be9a3375be39424088d622fca6913db3-3"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Run Time: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
<a name="rest_code_be9a3375be39424088d622fca6913db3-4"></a><span class="n">probabilities</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">probabilities</span><span class="p">)</span>
<a name="rest_code_be9a3375be39424088d622fca6913db3-5"></a><span class="n">probabilities</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre>
<pre class="literal-block">
       Epsilon 0.05  Epsilon 0.10  Epsilon 0.20  Epsilon 0.30  Epsilon 0.40  \
count    400.000000    400.000000    400.000000    400.000000    400.000000
mean       8.784956      9.971200      9.801344      9.084844      8.235194
std        3.064916      2.523568      1.775677      1.319447      0.998305
min        0.120000      0.275000      0.495000      0.757500      1.050000
25%        7.141875      9.740000     10.264375      9.390000      8.409375
50%        9.937500     11.187500     10.456250      9.475000      8.480000
75%       11.225000     11.457500     10.515000      9.530625      8.545000
max       11.720000     11.605000     10.727500      9.665000      8.712500

       Epsilon 0.50
count    400.000000
mean       7.310087
std        0.763259
min        1.190000
25%        7.406875
50%        7.473750
75%        7.535625
max        7.725000
</pre>
<pre class="code ipython"><a name="rest_code_1b165519ea9d4b47975fd48a911d3b77-1"></a><span class="n">probabilities</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"epsilon_greedy_accuracy.csv"</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_36aff4162ef54dc5a516dd663c0e4a07-1"></a><span class="n">figure</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a name="rest_code_36aff4162ef54dc5a516dd663c0e4a07-2"></a><span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<a name="rest_code_36aff4162ef54dc5a516dd663c0e4a07-3"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Accuracy of the Epsilon Greedy Algorithm ({} trials)"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TRIALS</span><span class="p">))</span>
<a name="rest_code_36aff4162ef54dc5a516dd663c0e4a07-4"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Time (number of pulls on the arm)"</span><span class="p">)</span>
<a name="rest_code_36aff4162ef54dc5a516dd663c0e4a07-5"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Probability of retrieving the best arm"</span><span class="p">)</span>
<a name="rest_code_36aff4162ef54dc5a516dd663c0e4a07-6"></a><span class="n">probabilities</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
</pre>
<img alt="epsilon_greedy_probablilities.png" src="posts/finding-the-best-epsilon/epsilon_greedy_probablilities.png"><p>Looking at the plots, it appears that the epsilons greater than 0.05 converge faster that 0.05 (their curves are steeper at the beginning), as you would expect, but they also don't do as well in the long run, as you might also expect, since they're doing more exploration. In the long run, the more exploitation, the better the profit, but I suppose it depends on the window you have to work with, if you have a short one, then the more aggresive explorers might be better. Anything less than 350 would do better with 0.1 rather than 0.05, for instance.</p>
</div>
</div>
<div class="section" id="average-reward">
<h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id7">5 Average Reward</a></h2>
<p>One of the things to note about the previous trials is that there was one arm that did notably better than all the others. When they are more uniform using the probability of retrieving the best arm might not be as revealing. Instead, using the average reward so far would give us more information.</p>
<pre class="code ipython"><a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-1"></a><span class="nd">@jit</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-2"></a><span class="k">def</span> <span class="nf">average_reward</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-3"></a>    <span class="sd">"""this generates the probabilites for finding the best arm</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-4"></a>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-5"></a><span class="sd">    Args:</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-6"></a><span class="sd">     trials (int): number of times to train the agent</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-7"></a><span class="sd">     times (int): length of time to train the agent</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-9"></a><span class="sd">     Dict: the probabilites for each epsilon over time</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-10"></a><span class="sd">    """</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-11"></a>    <span class="n">arm_probabilities</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-12"></a>    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">arm_probabilities</span><span class="p">)</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-13"></a>    <span class="c1"># arms = [BernoulliArm(probability) for probability in arm_probabilities]</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-14"></a>    <span class="n">epsilons</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-15"></a>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-16"></a>    <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{}</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-17"></a>    <span class="k">for</span> <span class="n">epsilon</span> <span class="ow">in</span> <span class="n">epsilons</span><span class="p">:</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-18"></a>        <span class="n">agent</span> <span class="o">=</span> <span class="n">EpsilonGreedyOptimized</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">arm_probabilities</span><span class="p">)</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-19"></a>        <span class="n">average_rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-20"></a>        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-21"></a>            <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-22"></a>                <span class="n">arm</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">select_arm</span><span class="p">()</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-23"></a>                <span class="n">old_reward</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">total_reward</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-24"></a>                <span class="n">agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-25"></a>                <span class="n">average_rewards</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">-</span> <span class="n">old_reward</span><span class="p">)</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-26"></a>            <span class="n">agent</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-27"></a>        <span class="n">outcomes</span><span class="p">[</span><span class="s2">"Epsilon {0:.02f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)]</span> <span class="o">=</span> <span class="n">average_rewards</span><span class="o">/</span><span class="n">trials</span>
<a name="rest_code_2ec45af74d5448759c2c7f0ff10d2dc8-28"></a>    <span class="k">return</span> <span class="n">outcomes</span>
</pre>
<pre class="code ipython"><a name="rest_code_68ba6aa4345445af8299627bb194084b-1"></a><span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a name="rest_code_68ba6aa4345445af8299627bb194084b-2"></a><span class="n">averages</span> <span class="o">=</span> <span class="n">average_reward</span><span class="p">(</span><span class="n">TIMES</span><span class="p">,</span> <span class="n">TRIALS</span><span class="p">)</span>
<a name="rest_code_68ba6aa4345445af8299627bb194084b-3"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Run Time: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
<a name="rest_code_68ba6aa4345445af8299627bb194084b-4"></a><span class="n">averages</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">averages</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Run Time: 0:01:08.727723
</pre>
<pre class="code ipython"><a name="rest_code_dbc65296c3d647c1bd9745e8113d3ca5-1"></a><span class="n">figure</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a name="rest_code_dbc65296c3d647c1bd9745e8113d3ca5-2"></a><span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<a name="rest_code_dbc65296c3d647c1bd9745e8113d3ca5-3"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Reward of the Epsilon Greedy Algorithm ({} trials)"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TRIALS</span><span class="p">))</span>
<a name="rest_code_dbc65296c3d647c1bd9745e8113d3ca5-4"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Time (number of pulls on the arm)"</span><span class="p">)</span>
<a name="rest_code_dbc65296c3d647c1bd9745e8113d3ca5-5"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Average Reward"</span><span class="p">)</span>
<a name="rest_code_dbc65296c3d647c1bd9745e8113d3ca5-6"></a><span class="n">averages</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'.'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">"None"</span><span class="p">)</span>
</pre>
<img alt="epsilon_averages.png" src="posts/finding-the-best-epsilon/epsilon_averages.png"><p>There's much more variablity and overlap here, as you might expect since I made the probabilities closer. Interestingly, the strongly exploratory agents seem to do worse, even from the beginning, while the more exploitative ones do better.  Although it looks like 0.2 might be doing as well or better than 0.1 once you get over 100.</p>
</div>
<div class="section" id="cumulative-reward">
<h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id8">6 Cumulative Reward</a></h2>
<p>The previous two metrics turn out to be useful, but somewhat unfair to the aggresively exploring models, which we know won't ultimately do as well, but do have an advantage in the initial phase. To better qualify the overall effect of exploration versus exploitation, it's better to use a cumulative sum of the rewards.</p>
<pre class="code ipython"><a name="rest_code_77d77817a1e24d048694565a4c224b41-1"></a><span class="nd">@jit</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-2"></a><span class="k">def</span> <span class="nf">cumulative_reward</span><span class="p">(</span><span class="n">arms</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-3"></a>    <span class="sd">"""this generates the cumulative reward as the agent pulls the arms</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-4"></a>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-5"></a><span class="sd">    Args:</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-6"></a><span class="sd">     arms (numpy.array): array of probabilities that the arm will pay-off</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-7"></a><span class="sd">     trials (int): number of times to train the agent</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-8"></a><span class="sd">     times (int): length of time to train the agent</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-9"></a><span class="sd">    Returns:</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-10"></a><span class="sd">     Dict: the probabilites for each epsilon over time</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-11"></a><span class="sd">    """</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-12"></a>    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">arms</span><span class="p">)</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-13"></a>    <span class="n">epsilons</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-14"></a>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-15"></a>    <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{}</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-16"></a>    <span class="k">for</span> <span class="n">epsilon</span> <span class="ow">in</span> <span class="n">epsilons</span><span class="p">:</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-17"></a>        <span class="n">agent</span> <span class="o">=</span> <span class="n">EpsilonGreedyOptimized</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">arms</span><span class="p">)</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-18"></a>        <span class="n">cumulative_rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-19"></a>        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-20"></a>            <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-21"></a>                <span class="n">arm</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">select_arm</span><span class="p">()</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-22"></a>                <span class="n">agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-23"></a>                <span class="n">cumulative_rewards</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">total_reward</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-24"></a>            <span class="n">agent</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-25"></a>        <span class="n">outcomes</span><span class="p">[</span><span class="s2">"Epsilon {:.02f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cumulative_rewards</span><span class="o">/</span><span class="n">trials</span>
<a name="rest_code_77d77817a1e24d048694565a4c224b41-26"></a>    <span class="k">return</span> <span class="n">outcomes</span>
</pre>
<pre class="code ipython"><a name="rest_code_d08b5e62d2474ec19d47be0155ed3359-1"></a><span class="k">def</span> <span class="nf">generate_cumulative</span><span class="p">(</span><span class="n">arms</span><span class="p">):</span>
<a name="rest_code_d08b5e62d2474ec19d47be0155ed3359-2"></a>    <span class="sd">"""runs the cumulative output function</span>
<a name="rest_code_d08b5e62d2474ec19d47be0155ed3359-3"></a>
<a name="rest_code_d08b5e62d2474ec19d47be0155ed3359-4"></a><span class="sd">    Args:</span>
<a name="rest_code_d08b5e62d2474ec19d47be0155ed3359-5"></a><span class="sd">     arms (numpy.array): probabilities that arms will pay out</span>
<a name="rest_code_d08b5e62d2474ec19d47be0155ed3359-6"></a>
<a name="rest_code_d08b5e62d2474ec19d47be0155ed3359-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_d08b5e62d2474ec19d47be0155ed3359-8"></a><span class="sd">     pandas.DataFrame: the average cumulative rewards</span>
<a name="rest_code_d08b5e62d2474ec19d47be0155ed3359-9"></a><span class="sd">    """</span>
<a name="rest_code_d08b5e62d2474ec19d47be0155ed3359-10"></a>    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a name="rest_code_d08b5e62d2474ec19d47be0155ed3359-11"></a>    <span class="n">cumulative</span> <span class="o">=</span> <span class="n">cumulative_reward</span><span class="p">(</span><span class="n">arms</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">TIMES</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">)</span>
<a name="rest_code_d08b5e62d2474ec19d47be0155ed3359-12"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"Run Time: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
<a name="rest_code_d08b5e62d2474ec19d47be0155ed3359-13"></a>    <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">cumulative</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_cf79435bf2804356b8f31b413b8eff41-1"></a><span class="k">def</span> <span class="nf">plot_cumulative</span><span class="p">(</span><span class="n">cumulative</span><span class="p">):</span>
<a name="rest_code_cf79435bf2804356b8f31b413b8eff41-2"></a>    <span class="sd">"""generates and plots cumulative average</span>
<a name="rest_code_cf79435bf2804356b8f31b413b8eff41-3"></a>
<a name="rest_code_cf79435bf2804356b8f31b413b8eff41-4"></a><span class="sd">    Args:</span>
<a name="rest_code_cf79435bf2804356b8f31b413b8eff41-5"></a><span class="sd">     cumulative (pandas.DataFrame): data to plot</span>
<a name="rest_code_cf79435bf2804356b8f31b413b8eff41-6"></a><span class="sd">    """</span>
<a name="rest_code_cf79435bf2804356b8f31b413b8eff41-7"></a>    <span class="n">figure</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a name="rest_code_cf79435bf2804356b8f31b413b8eff41-8"></a>    <span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<a name="rest_code_cf79435bf2804356b8f31b413b8eff41-9"></a>    <span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Cumulative Reward of the Epsilon Greedy Algorithm ({} trials)"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TRIALS</span><span class="p">))</span>
<a name="rest_code_cf79435bf2804356b8f31b413b8eff41-10"></a>    <span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Time (number of pulls on the arm)"</span><span class="p">)</span>
<a name="rest_code_cf79435bf2804356b8f31b413b8eff41-11"></a>    <span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Cumulative Reward"</span><span class="p">)</span>
<a name="rest_code_cf79435bf2804356b8f31b413b8eff41-12"></a>    <span class="n">cumulative</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
<a name="rest_code_cf79435bf2804356b8f31b413b8eff41-13"></a>    <span class="k">return</span>
</pre>
<pre class="code ipython"><a name="rest_code_e05f0740d0054c6b9b535f386357f840-1"></a><span class="n">cumulative</span> <span class="o">=</span> <span class="n">generate_cumulative</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
<a name="rest_code_e05f0740d0054c6b9b535f386357f840-2"></a><span class="n">plot_cumulative</span><span class="p">(</span><span class="n">cumulative</span><span class="p">)</span>
</pre>
<img alt="epsilon_greedy_cumulative.png" src="posts/finding-the-best-epsilon/epsilon_greedy_cumulative.png"><p>Because of the randomness this will change everytime you run it, but we can see that in this case, the average cumulative reward was better for the 0.3 and 0.5 epsilon values than the more conservative values up until around 275, and the second most conservative case (0.2) actually did worse on average than the more exploratory cases did.</p>
<div class="section" id="imbalanced-case">
<h3><a class="toc-backref" href="posts/finding-the-best-epsilon/#id9">6.1 Imbalanced Case</a></h3>
<p>I'll re-run this again with more arms and a only one clear good arm to see if this changes things.</p>
<pre class="code ipython"><a name="rest_code_a2f72a36ec724a60b22ac0a9554e9b13-1"></a><span class="n">plot_cumulative</span><span class="p">(</span><span class="n">generate_cumulative</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">])))</span>
</pre>
<img alt="epsilon_cumulative_2.png" src="posts/finding-the-best-epsilon/epsilon_cumulative_2.png"><p>In this case, the most exploitive agent did much worse than the other agents. It looks like it didn't find the best arm until around the 240th pull. In this case, when most arms pay off poorly and one arm pays off much better, the exploratory arms accumulate more reward within our time frame. I'm guessing that the 0.10 epsilon would, given enough time, pull ahead, and you can in fact see that the most exploratory agent has already been surpassed by the 0.2 agent, so eventually exploration would probably take a back seat to exploitation, but not in this case. It's important to note, however, that if the most exploitive agent had happened to find the best arm at the start, he would likely have ended up the best, it's just the nature of randomization that you aren't guaranteed that this would be the case.</p>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/A-Bernoulli-Arm/" class="u-url">A Bernoulli Arm</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/hades/">hades</a>
            </span></p>
            <p class="dateline"><a href="posts/A-Bernoulli-Arm/" rel="bookmark"><time class="published dt-published" datetime="2017-07-30T18:37:00-07:00" title="2017-07-30 18:37">2017-07-30 18:37</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="introduction">
<h2>1 Introduction</h2>
<p>This is an implementation of one arm of a <a class="reference external" href="https://en.wikipedia.org/wiki/Multi-armed_bandit">n-armed bandit</a> to test the Epsilon Greedy algorithm. It takes a probability that it will return a reward. It also optionally let's you set the penalty and reward values, but defaults to a reward of 1 and a penalty of 0 (so it's really no reward more than a penalty).</p>
</div>
<div class="section" id="imports">
<h2>2 Imports</h2>
<pre class="code python"><a name="rest_code_4afa4929c961478aa96fe9044e29aa64-1"></a><span class="c1"># python standard library</span>
<a name="rest_code_4afa4929c961478aa96fe9044e29aa64-2"></a><span class="kn">import</span> <span class="nn">random</span>
</pre>
</div>
<div class="section" id="bernoulli-arm">
<h2>3 Bernoulli Arm</h2>
<p>The Bernoulli Arm will generate a value when its arm is pulled at a payout rate specified by the `probability` value.</p>
<pre class="code python"><a name="rest_code_7d2cbd299aab47909ceec8b5336bb20f-1"></a><span class="o">&lt;&lt;</span><span class="n">imports</span><span class="o">&gt;&gt;</span>
<a name="rest_code_7d2cbd299aab47909ceec8b5336bb20f-2"></a>
<a name="rest_code_7d2cbd299aab47909ceec8b5336bb20f-3"></a><span class="k">class</span> <span class="nc">BernoulliArm</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_7d2cbd299aab47909ceec8b5336bb20f-4"></a>    <span class="sd">"""A simulation of one arm of a multi-armed bandit</span>
<a name="rest_code_7d2cbd299aab47909ceec8b5336bb20f-5"></a>
<a name="rest_code_7d2cbd299aab47909ceec8b5336bb20f-6"></a><span class="sd">    Args:</span>
<a name="rest_code_7d2cbd299aab47909ceec8b5336bb20f-7"></a><span class="sd">     probability (float): probability of a reward</span>
<a name="rest_code_7d2cbd299aab47909ceec8b5336bb20f-8"></a><span class="sd">     reward (float): value to return on a win</span>
<a name="rest_code_7d2cbd299aab47909ceec8b5336bb20f-9"></a><span class="sd">     penalty (float): value to return on a loss</span>
<a name="rest_code_7d2cbd299aab47909ceec8b5336bb20f-10"></a><span class="sd">    """</span>
<a name="rest_code_7d2cbd299aab47909ceec8b5336bb20f-11"></a>    <span class="o">&lt;&lt;</span><span class="n">constructor</span><span class="o">&gt;&gt;</span>
<a name="rest_code_7d2cbd299aab47909ceec8b5336bb20f-12"></a>
<a name="rest_code_7d2cbd299aab47909ceec8b5336bb20f-13"></a>    <span class="o">&lt;&lt;</span><span class="n">call</span><span class="o">&gt;&gt;</span>
</pre>
<div class="section" id="constructor">
<h3>3.1 Constructor</h3>
<p>The constructor takes three values:</p>
<ul class="simple">
<li>probability of winning</li>
<li>reward on winning</li>
<li>penalty on losing</li>
</ul>
<p>Because of the way the problem is set up, the reward and penalty are already set at 1 and 0, but I didn't want there to be magic numbers so they can be changed if needed.</p>
<pre class="code python"><a name="rest_code_b00f751f28aa45aeba6b40027979d1fe-1"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">probability</span><span class="p">,</span> <span class="n">reward</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a name="rest_code_b00f751f28aa45aeba6b40027979d1fe-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">probability</span> <span class="o">=</span> <span class="n">probability</span>
<a name="rest_code_b00f751f28aa45aeba6b40027979d1fe-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">reward</span> <span class="o">=</span> <span class="n">reward</span>
<a name="rest_code_b00f751f28aa45aeba6b40027979d1fe-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">penalty</span> <span class="o">=</span> <span class="n">penalty</span>
<a name="rest_code_b00f751f28aa45aeba6b40027979d1fe-5"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="the-call">
<h3>3.2 The Call</h3>
<p>This is called <tt class="docutils literal">pull</tt> in most cases, but I thought it would be more uniform to put it in a call.</p>
<pre class="code python"><a name="rest_code_c3c69341a376401fa843c7f55b194f65-1"></a><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_c3c69341a376401fa843c7f55b194f65-2"></a>    <span class="sd">"""pulls the arm and returns a reward or penalty</span>
<a name="rest_code_c3c69341a376401fa843c7f55b194f65-3"></a>
<a name="rest_code_c3c69341a376401fa843c7f55b194f65-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_c3c69341a376401fa843c7f55b194f65-5"></a><span class="sd">     float: value returned on pulling the arm</span>
<a name="rest_code_c3c69341a376401fa843c7f55b194f65-6"></a><span class="sd">    """</span>
<a name="rest_code_c3c69341a376401fa843c7f55b194f65-7"></a>    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">probability</span><span class="p">:</span>
<a name="rest_code_c3c69341a376401fa843c7f55b194f65-8"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">penalty</span>
<a name="rest_code_c3c69341a376401fa843c7f55b194f65-9"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reward</span>
</pre>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/The-Epsilon-Greedy-Algorithm/" class="u-url">The Epsilon Greedy Algorithm</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/hades/">hades</a>
            </span></p>
            <p class="dateline"><a href="posts/The-Epsilon-Greedy-Algorithm/" rel="bookmark"><time class="published dt-published" datetime="2017-07-30T18:22:00-07:00" title="2017-07-30 18:22">2017-07-30 18:22</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="background">
<h2>1 Background</h2>
<p>This is an implementation of the Epsilon Greedy algorithm to find solutions for the multi-arm-bandit problem.</p>
</div>
<div class="section" id="imports">
<h2>2 Imports</h2>
<pre class="code python"><a name="rest_code_23ac67c6dfdb4854b223d56d80d9d5ac-1"></a><span class="c1"># python</span>
<a name="rest_code_23ac67c6dfdb4854b223d56d80d9d5ac-2"></a><span class="kn">import</span> <span class="nn">random</span>
<a name="rest_code_23ac67c6dfdb4854b223d56d80d9d5ac-3"></a>
<a name="rest_code_23ac67c6dfdb4854b223d56d80d9d5ac-4"></a><span class="c1"># pypi</span>
<a name="rest_code_23ac67c6dfdb4854b223d56d80d9d5ac-5"></a><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jit</span>
<a name="rest_code_23ac67c6dfdb4854b223d56d80d9d5ac-6"></a><span class="kn">import</span> <span class="nn">numpy</span>
</pre>
</div>
<div class="section" id="find-first">
<h2>3 Find First</h2>
<p>This is a helper function to find the first matching item in an array-like collection.</p>
<pre class="code python"><a name="rest_code_b617331fb934406da31b63f681d87441-1"></a><span class="nd">@jit</span>
<a name="rest_code_b617331fb934406da31b63f681d87441-2"></a><span class="k">def</span> <span class="nf">find_first</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">vector</span><span class="p">):</span>
<a name="rest_code_b617331fb934406da31b63f681d87441-3"></a>    <span class="sd">"""find the first item in the vector</span>
<a name="rest_code_b617331fb934406da31b63f681d87441-4"></a>
<a name="rest_code_b617331fb934406da31b63f681d87441-5"></a><span class="sd">    Args:</span>
<a name="rest_code_b617331fb934406da31b63f681d87441-6"></a><span class="sd">     item: thing to match</span>
<a name="rest_code_b617331fb934406da31b63f681d87441-7"></a><span class="sd">     vector: thing to search</span>
<a name="rest_code_b617331fb934406da31b63f681d87441-8"></a>
<a name="rest_code_b617331fb934406da31b63f681d87441-9"></a><span class="sd">    Returns:</span>
<a name="rest_code_b617331fb934406da31b63f681d87441-10"></a><span class="sd">     value: index of first matching item, -1 if not found</span>
<a name="rest_code_b617331fb934406da31b63f681d87441-11"></a><span class="sd">    """</span>
<a name="rest_code_b617331fb934406da31b63f681d87441-12"></a>    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="p">)):</span>
<a name="rest_code_b617331fb934406da31b63f681d87441-13"></a>        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">vector</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
<a name="rest_code_b617331fb934406da31b63f681d87441-14"></a>            <span class="k">return</span> <span class="n">index</span>
<a name="rest_code_b617331fb934406da31b63f681d87441-15"></a>    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</pre>
</div>
<div class="section" id="epsilon-greedy">
<h2>4 Epsilon Greedy</h2>
<p>The <em>epsilon-greedy</em> algorithm tries to solve the exploitation-exploration dilemna by exploring a fraction of the time (set by <em>epsilon</em>) and using the best solution found so far the rest of the time. This implementation is based on the one in Bandit Algorithms for Website Optimization <a class="footnote-reference" href="posts/The-Epsilon-Greedy-Algorithm/#id5" id="id1">[1]</a> .</p>
<pre class="code python"><a name="rest_code_ee0a9045898c4e999014a90dcea50649-1"></a><span class="o">&lt;&lt;</span><span class="n">imports</span><span class="o">&gt;&gt;</span>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-2"></a>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-3"></a><span class="o">&lt;&lt;</span><span class="n">find</span><span class="o">-</span><span class="n">first</span><span class="o">&gt;&gt;</span>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-4"></a><span class="k">class</span> <span class="nc">EpsilonGreedy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-5"></a>    <span class="sd">"""The Epsilon Greedy Algorithm</span>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-6"></a>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-7"></a><span class="sd">    Args:</span>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-8"></a><span class="sd">     epsilon (float): fraction of the time to explore</span>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-9"></a><span class="sd">     arms (list): collection of bandits to pull</span>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-10"></a><span class="sd">    """</span>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-11"></a>    <span class="o">&lt;&lt;</span><span class="n">constructor</span><span class="o">&gt;&gt;</span>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-12"></a>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-13"></a>    <span class="o">&lt;&lt;</span><span class="n">best</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-14"></a>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-15"></a>    <span class="o">&lt;&lt;</span><span class="n">counts</span><span class="o">&gt;&gt;</span>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-16"></a>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-17"></a>    <span class="o">&lt;&lt;</span><span class="n">rewards</span><span class="o">&gt;&gt;</span>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-18"></a>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-19"></a>    <span class="o">&lt;&lt;</span><span class="n">select</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-20"></a>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-21"></a>    <span class="o">&lt;&lt;</span><span class="n">update</span><span class="o">&gt;&gt;</span>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-22"></a>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-23"></a>    <span class="o">&lt;&lt;</span><span class="n">reset</span><span class="o">&gt;&gt;</span>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-24"></a>
<a name="rest_code_ee0a9045898c4e999014a90dcea50649-25"></a>    <span class="o">&lt;&lt;</span><span class="n">call</span><span class="o">&gt;&gt;</span>
</pre>
<div class="section" id="the-constructor">
<h3>4.1 The Constructor</h3>
<p>The constructor takes two arguments - <em>epsilon</em> and <em>arms</em>. The <em>arms</em> list should contain bandits that return a reward or penalty when pulled (called).</p>
<pre class="code python"><a name="rest_code_fbd9f908667d42dc8c75999805b8eb38-1"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">arms</span><span class="p">):</span>
<a name="rest_code_fbd9f908667d42dc8c75999805b8eb38-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
<a name="rest_code_fbd9f908667d42dc8c75999805b8eb38-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="n">arms</span>
<a name="rest_code_fbd9f908667d42dc8c75999805b8eb38-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_fbd9f908667d42dc8c75999805b8eb38-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_rewards</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_fbd9f908667d42dc8c75999805b8eb38-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_fbd9f908667d42dc8c75999805b8eb38-7"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="best-arm">
<h3>4.2 Best Arm</h3>
<p>The <tt class="docutils literal">best_arm</tt> property returns the index of the arm that has the highest average reward so far. It returns the index instead of the arm itself because it's used to get the matching counts and rewards in the <tt class="docutils literal">update</tt> method.</p>
<pre class="code python"><a name="rest_code_458ed2d7ec8547529703d5c5aa7e719f-1"></a><span class="nd">@property</span>
<a name="rest_code_458ed2d7ec8547529703d5c5aa7e719f-2"></a><span class="k">def</span> <span class="nf">best_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_458ed2d7ec8547529703d5c5aa7e719f-3"></a>    <span class="sd">"""Index of the arm with the most reward"""</span>
<a name="rest_code_458ed2d7ec8547529703d5c5aa7e719f-4"></a>    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<a name="rest_code_458ed2d7ec8547529703d5c5aa7e719f-5"></a>    <span class="k">return</span> <span class="n">find_first</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="counts">
<h3>4.3 Counts</h3>
<p>The `counts` keeps track of the number of times each arm is pulled.</p>
<pre class="code python"><a name="rest_code_a5b9d10334664527a10b1cb29c80b28b-1"></a><span class="nd">@property</span>
<a name="rest_code_a5b9d10334664527a10b1cb29c80b28b-2"></a><span class="k">def</span> <span class="nf">counts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_a5b9d10334664527a10b1cb29c80b28b-3"></a>    <span class="sd">"""counts of times each arm is pulled</span>
<a name="rest_code_a5b9d10334664527a10b1cb29c80b28b-4"></a>
<a name="rest_code_a5b9d10334664527a10b1cb29c80b28b-5"></a><span class="sd">    Returns:</span>
<a name="rest_code_a5b9d10334664527a10b1cb29c80b28b-6"></a><span class="sd">     numpy.array: array of counts</span>
<a name="rest_code_a5b9d10334664527a10b1cb29c80b28b-7"></a><span class="sd">    """</span>
<a name="rest_code_a5b9d10334664527a10b1cb29c80b28b-8"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<a name="rest_code_a5b9d10334664527a10b1cb29c80b28b-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a name="rest_code_a5b9d10334664527a10b1cb29c80b28b-10"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span>
</pre>
</div>
<div class="section" id="rewards">
<h3>4.4 Rewards</h3>
<p>The <tt class="docutils literal">rewards</tt> attributes holds the running average reward that each arm has returned.</p>
<pre class="code python"><a name="rest_code_a63c0d0e666e490caec6127b66507495-1"></a><span class="nd">@property</span>
<a name="rest_code_a63c0d0e666e490caec6127b66507495-2"></a><span class="k">def</span> <span class="nf">rewards</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_a63c0d0e666e490caec6127b66507495-3"></a>    <span class="sd">"""array of running average of rewards for each arms</span>
<a name="rest_code_a63c0d0e666e490caec6127b66507495-4"></a>
<a name="rest_code_a63c0d0e666e490caec6127b66507495-5"></a><span class="sd">    Returns:</span>
<a name="rest_code_a63c0d0e666e490caec6127b66507495-6"></a><span class="sd">     numpy.array: running averages</span>
<a name="rest_code_a63c0d0e666e490caec6127b66507495-7"></a><span class="sd">    """</span>
<a name="rest_code_a63c0d0e666e490caec6127b66507495-8"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rewards</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<a name="rest_code_a63c0d0e666e490caec6127b66507495-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_a63c0d0e666e490caec6127b66507495-10"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rewards</span>
</pre>
</div>
<div class="section" id="reset">
<h3>4.5 Reset</h3>
<pre class="code python"><a name="rest_code_5a8af36ae7fb4496b99b5fe524616be3-1"></a><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_5a8af36ae7fb4496b99b5fe524616be3-2"></a>    <span class="sd">"""sets the counts and rewards to None</span>
<a name="rest_code_5a8af36ae7fb4496b99b5fe524616be3-3"></a>
<a name="rest_code_5a8af36ae7fb4496b99b5fe524616be3-4"></a><span class="sd">    This lets you re-used the EpsilonGreedy without re-constructing</span>
<a name="rest_code_5a8af36ae7fb4496b99b5fe524616be3-5"></a><span class="sd">    the arms</span>
<a name="rest_code_5a8af36ae7fb4496b99b5fe524616be3-6"></a><span class="sd">    """</span>
<a name="rest_code_5a8af36ae7fb4496b99b5fe524616be3-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_5a8af36ae7fb4496b99b5fe524616be3-8"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_rewards</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_5a8af36ae7fb4496b99b5fe524616be3-9"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_5a8af36ae7fb4496b99b5fe524616be3-10"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="select-arm">
<h3>4.6 Select Arm</h3>
<p>The <em>select_arm</em> method will choose either the best arm or a random one based on a randomly drawn value and how it compares to epsilon.</p>
<pre class="code python"><a name="rest_code_2d724ae6b1ea4cf1bb9af459dfce8620-1"></a><span class="k">def</span> <span class="nf">select_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_2d724ae6b1ea4cf1bb9af459dfce8620-2"></a>    <span class="sd">"""chooses the next arm to update</span>
<a name="rest_code_2d724ae6b1ea4cf1bb9af459dfce8620-3"></a>
<a name="rest_code_2d724ae6b1ea4cf1bb9af459dfce8620-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_2d724ae6b1ea4cf1bb9af459dfce8620-5"></a><span class="sd">     int: index of the next arm to pull</span>
<a name="rest_code_2d724ae6b1ea4cf1bb9af459dfce8620-6"></a><span class="sd">    """</span>
<a name="rest_code_2d724ae6b1ea4cf1bb9af459dfce8620-7"></a>    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">:</span>
<a name="rest_code_2d724ae6b1ea4cf1bb9af459dfce8620-8"></a>        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_2d724ae6b1ea4cf1bb9af459dfce8620-9"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_arm</span>
</pre>
</div>
<div class="section" id="update">
<h3>4.7 Update</h3>
<p>The update method pulls the arm whose index it is given and then updates the count and reward.</p>
<pre class="code python"><a name="rest_code_439f7a7e4f8e495d8cdfd6c2cfe06e16-1"></a><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">):</span>
<a name="rest_code_439f7a7e4f8e495d8cdfd6c2cfe06e16-2"></a>    <span class="sd">"""pulls the arm and updates the value</span>
<a name="rest_code_439f7a7e4f8e495d8cdfd6c2cfe06e16-3"></a>
<a name="rest_code_439f7a7e4f8e495d8cdfd6c2cfe06e16-4"></a><span class="sd">    Args:</span>
<a name="rest_code_439f7a7e4f8e495d8cdfd6c2cfe06e16-5"></a><span class="sd">     arm (int): index of the arm to pull</span>
<a name="rest_code_439f7a7e4f8e495d8cdfd6c2cfe06e16-6"></a><span class="sd">    """</span>
<a name="rest_code_439f7a7e4f8e495d8cdfd6c2cfe06e16-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a name="rest_code_439f7a7e4f8e495d8cdfd6c2cfe06e16-8"></a>    <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
<a name="rest_code_439f7a7e4f8e495d8cdfd6c2cfe06e16-9"></a>    <span class="n">average_reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
<a name="rest_code_439f7a7e4f8e495d8cdfd6c2cfe06e16-10"></a>    <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">arm</span><span class="p">]()</span>
<a name="rest_code_439f7a7e4f8e495d8cdfd6c2cfe06e16-11"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">+=</span> <span class="n">reward</span>
<a name="rest_code_439f7a7e4f8e495d8cdfd6c2cfe06e16-12"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">))</span> <span class="o">*</span> <span class="n">average_reward</span>
<a name="rest_code_439f7a7e4f8e495d8cdfd6c2cfe06e16-13"></a>                        <span class="o">+</span> <span class="p">(</span><span class="n">reward</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">)))</span>
<a name="rest_code_439f7a7e4f8e495d8cdfd6c2cfe06e16-14"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="call">
<h3>4.8 Call</h3>
<p>The <em>__call__</em> method will be the main update method that unifies the naming conventions found in the books.</p>
<pre class="code python"><a name="rest_code_b0b6cad0b781434283b5728c379a863f-1"></a><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_b0b6cad0b781434283b5728c379a863f-2"></a>    <span class="sd">"""chooses an arm and updates the rewards"""</span>
<a name="rest_code_b0b6cad0b781434283b5728c379a863f-3"></a>    <span class="n">arm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_arm</span><span class="p">()</span>
<a name="rest_code_b0b6cad0b781434283b5728c379a863f-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
<a name="rest_code_b0b6cad0b781434283b5728c379a863f-5"></a>    <span class="k">return</span>
</pre>
</div>
</div>
<div class="section" id="epsilon-greedy-optimized">
<h2>5 Epsilon Greedy Optimized</h2>
<p>It turns out that while the implementation above works correctly, it can be rather slow, given that we need to train it thousands of times to get meaningful results. This is a numba-compatible version that drops the testing time from around 11 minutes to a minute or less. One of the restrictions of using classes in numba is that you have to declare the types of all the attributes of the class (this happens in the <cite>spec</cite> passed to the <cite>jitclass</cite> decorator). This means that I can't pass in <cite>BernoulliArm</cite> objects to the constructor, because <cite>numba</cite> has no idea what they are, so this solution is a hybrid greedy algorithm and bandit arm mashed together.</p>
<p>The documentation for <cite>numba</cite> states that you have to initialize the attributes in the <cite>__init__</cite> method so I'm getting rid of the properties that build the numpy arrays and moving their creation to the constructor. In addition, the code that no longer expects the =BernoulliArm= objects will have to be re-implemented. In the tangle code anything with the <cite>optimized-</cite> prefix is re-implemented (other than the <cite>spec</cite>), otherwise the code is being pulled in from the original <cite>EpsilonGreedy</cite> implementation.</p>
<pre class="code python"><a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-1"></a><span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-2"></a>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-3"></a><span class="o">&lt;&lt;</span><span class="n">spec</span><span class="o">&gt;&gt;</span>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-4"></a>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-5"></a><span class="o">&lt;&lt;</span><span class="n">find</span><span class="o">-</span><span class="n">first</span><span class="o">&gt;&gt;</span>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-6"></a><span class="nd">@jitclass</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-7"></a><span class="k">class</span> <span class="nc">EpsilonGreedyOptimized</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-8"></a>    <span class="sd">"""The Epsilon Greedy Algorithm</span>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-9"></a>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-10"></a><span class="sd">    Args:</span>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-11"></a><span class="sd">     epsilon (float): fraction of the time to explore</span>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-12"></a><span class="sd">     arms (list): collection of probabilities for bandit arm</span>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-13"></a><span class="sd">    """</span>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-14"></a>    <span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">constructor</span><span class="o">&gt;&gt;</span>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-15"></a>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-16"></a>    <span class="o">&lt;&lt;</span><span class="n">best</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-17"></a>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-18"></a>    <span class="o">&lt;&lt;</span><span class="n">select</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-19"></a>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-20"></a>    <span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">pull</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-21"></a>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-22"></a>    <span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">update</span><span class="o">&gt;&gt;</span>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-23"></a>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-24"></a>    <span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">reset</span><span class="o">&gt;&gt;</span>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-25"></a>
<a name="rest_code_d6e222b28b39496abedc2ff3f8a2035c-26"></a>    <span class="o">&lt;&lt;</span><span class="n">call</span><span class="o">&gt;&gt;</span>
</pre>
<div class="section" id="optimized-imports">
<h3>5.1 Optimized Imports</h3>
<pre class="code python"><a name="rest_code_635a8bb3b1de46f2853f27c04771ca55-1"></a><span class="c1"># python</span>
<a name="rest_code_635a8bb3b1de46f2853f27c04771ca55-2"></a><span class="kn">import</span> <span class="nn">random</span>
<a name="rest_code_635a8bb3b1de46f2853f27c04771ca55-3"></a>
<a name="rest_code_635a8bb3b1de46f2853f27c04771ca55-4"></a><span class="c1"># pypi</span>
<a name="rest_code_635a8bb3b1de46f2853f27c04771ca55-5"></a><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_635a8bb3b1de46f2853f27c04771ca55-6"></a>    <span class="n">jit</span><span class="p">,</span>
<a name="rest_code_635a8bb3b1de46f2853f27c04771ca55-7"></a>    <span class="n">jitclass</span><span class="p">,</span>
<a name="rest_code_635a8bb3b1de46f2853f27c04771ca55-8"></a>    <span class="p">)</span>
<a name="rest_code_635a8bb3b1de46f2853f27c04771ca55-9"></a><span class="kn">import</span> <span class="nn">numba</span>
<a name="rest_code_635a8bb3b1de46f2853f27c04771ca55-10"></a><span class="kn">import</span> <span class="nn">numpy</span>
</pre>
</div>
<div class="section" id="the-spec">
<h3>5.2 The Spec</h3>
<p>This is how you tell numba what attributes the class will have. This is where most of the errors were when I first tried this. The error-messages aren't particularly helpful. Just be aware that this is the first place you should look if things crash.</p>
<pre class="code python"><a name="rest_code_2222291ed1c34e9e9851c1b8296ca79b-1"></a><span class="n">spec</span> <span class="o">=</span> <span class="p">[</span>
<a name="rest_code_2222291ed1c34e9e9851c1b8296ca79b-2"></a>    <span class="p">(</span><span class="s2">"epsilon"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">),</span>
<a name="rest_code_2222291ed1c34e9e9851c1b8296ca79b-3"></a>    <span class="p">(</span><span class="s2">"arms"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a name="rest_code_2222291ed1c34e9e9851c1b8296ca79b-4"></a>    <span class="p">(</span><span class="s2">"counts"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a name="rest_code_2222291ed1c34e9e9851c1b8296ca79b-5"></a>    <span class="p">(</span><span class="s2">"rewards"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a name="rest_code_2222291ed1c34e9e9851c1b8296ca79b-6"></a>    <span class="p">(</span><span class="s2">"total_reward"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
<a name="rest_code_2222291ed1c34e9e9851c1b8296ca79b-7"></a><span class="p">]</span>
</pre>
</div>
<div class="section" id="id2">
<h3>5.3 The Constructor</h3>
<p>The constructor takes two arguments - <em>epsilon</em> and <em>arms</em>. The <em>arms</em> list should contain probabilities that a reward or penalty will be returned when pulled.</p>
<pre class="code python"><a name="rest_code_3480462edc804ebbac168c996942ee28-1"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">arms</span><span class="p">):</span>
<a name="rest_code_3480462edc804ebbac168c996942ee28-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
<a name="rest_code_3480462edc804ebbac168c996942ee28-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="n">arms</span>
<a name="rest_code_3480462edc804ebbac168c996942ee28-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_3480462edc804ebbac168c996942ee28-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_3480462edc804ebbac168c996942ee28-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_3480462edc804ebbac168c996942ee28-7"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="id3">
<h3>5.4 Reset</h3>
<pre class="code python"><a name="rest_code_c59ad6082ae04030a5b4627bf2b4179e-1"></a><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_c59ad6082ae04030a5b4627bf2b4179e-2"></a>    <span class="sd">"""sets the counts, rewards, total_reward to 0s</span>
<a name="rest_code_c59ad6082ae04030a5b4627bf2b4179e-3"></a>
<a name="rest_code_c59ad6082ae04030a5b4627bf2b4179e-4"></a><span class="sd">    This lets you re-used the EpsilonGreedy</span>
<a name="rest_code_c59ad6082ae04030a5b4627bf2b4179e-5"></a><span class="sd">    """</span>
<a name="rest_code_c59ad6082ae04030a5b4627bf2b4179e-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_c59ad6082ae04030a5b4627bf2b4179e-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_c59ad6082ae04030a5b4627bf2b4179e-8"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_c59ad6082ae04030a5b4627bf2b4179e-9"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="pull-arm">
<h3>5.5 Pull Arm</h3>
<p>Since we can't give user-defined objects as attributes of the class, this version will be both algorithm and bandit.</p>
<pre class="code python"><a name="rest_code_eb2d902dbb5e4daebc8b4bc2086f2489-1"></a><span class="k">def</span> <span class="nf">pull_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">):</span>
<a name="rest_code_eb2d902dbb5e4daebc8b4bc2086f2489-2"></a>    <span class="sd">"""gets the reward</span>
<a name="rest_code_eb2d902dbb5e4daebc8b4bc2086f2489-3"></a>
<a name="rest_code_eb2d902dbb5e4daebc8b4bc2086f2489-4"></a><span class="sd">    Args:</span>
<a name="rest_code_eb2d902dbb5e4daebc8b4bc2086f2489-5"></a><span class="sd">     arm (int): index for the arm-probability array</span>
<a name="rest_code_eb2d902dbb5e4daebc8b4bc2086f2489-6"></a><span class="sd">    Returns:</span>
<a name="rest_code_eb2d902dbb5e4daebc8b4bc2086f2489-7"></a><span class="sd">     int: reward or no reward</span>
<a name="rest_code_eb2d902dbb5e4daebc8b4bc2086f2489-8"></a><span class="sd">    """</span>
<a name="rest_code_eb2d902dbb5e4daebc8b4bc2086f2489-9"></a>    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">arm</span><span class="p">]:</span>
<a name="rest_code_eb2d902dbb5e4daebc8b4bc2086f2489-10"></a>        <span class="k">return</span> <span class="mi">0</span>
<a name="rest_code_eb2d902dbb5e4daebc8b4bc2086f2489-11"></a>    <span class="k">return</span> <span class="mi">1</span>
</pre>
</div>
<div class="section" id="id4">
<h3>5.6 Update</h3>
<p>The update method pulls the arm whose index it is given and then updates the count and reward. Here we're calling the <tt class="docutils literal">pull_arm</tt> method instead of using a <tt class="docutils literal">BernoulliArm</tt> so we can't re-use the original method.</p>
<pre class="code python"><a name="rest_code_c6ab5cff46c44626a5fe274ef28fd0b2-1"></a><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">):</span>
<a name="rest_code_c6ab5cff46c44626a5fe274ef28fd0b2-2"></a>    <span class="sd">"""pulls the arm and updates the value</span>
<a name="rest_code_c6ab5cff46c44626a5fe274ef28fd0b2-3"></a>
<a name="rest_code_c6ab5cff46c44626a5fe274ef28fd0b2-4"></a><span class="sd">    Args:</span>
<a name="rest_code_c6ab5cff46c44626a5fe274ef28fd0b2-5"></a><span class="sd">     arm (int): index of the arm to pull</span>
<a name="rest_code_c6ab5cff46c44626a5fe274ef28fd0b2-6"></a><span class="sd">    """</span>
<a name="rest_code_c6ab5cff46c44626a5fe274ef28fd0b2-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a name="rest_code_c6ab5cff46c44626a5fe274ef28fd0b2-8"></a>    <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
<a name="rest_code_c6ab5cff46c44626a5fe274ef28fd0b2-9"></a>    <span class="n">average_reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
<a name="rest_code_c6ab5cff46c44626a5fe274ef28fd0b2-10"></a>    <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_arm</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
<a name="rest_code_c6ab5cff46c44626a5fe274ef28fd0b2-11"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">+=</span> <span class="n">reward</span>
<a name="rest_code_c6ab5cff46c44626a5fe274ef28fd0b2-12"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">))</span> <span class="o">*</span> <span class="n">average_reward</span>
<a name="rest_code_c6ab5cff46c44626a5fe274ef28fd0b2-13"></a>                        <span class="o">+</span> <span class="p">(</span><span class="n">reward</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">)))</span>
<a name="rest_code_c6ab5cff46c44626a5fe274ef28fd0b2-14"></a>    <span class="k">return</span>
</pre>
</div>
</div>
<div class="section" id="references">
<h2>6 References</h2>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup>
<col class="label">
<col>
</colgroup>
<tbody valign="top"><tr>
<td class="label"><a class="fn-backref" href="posts/The-Epsilon-Greedy-Algorithm/#id1">[1]</a></td>
<td>Bandit Algorithms for Website Optimization by John Myles White. Copyright 2013 John Myles White, 978-1-449-34133-6</td>
</tr></tbody>
</table>
</div>
</div>
    </div>
    </article>
</div>







        </div>
        <!--End of body content-->

        <footer id="footer">
            Contents  2018         <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a><br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
