<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Notes while learning reinforcement learning.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bandits &amp; Pigeon Bombs</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/Bandits-and-Pigeon-Bombs/">
<link rel="next" href="index-1.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script><link rel="prefetch" href="posts/reference-reinforcement-learning/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-light
bg-light
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href=".">

            <span id="blog-title">Bandits &amp; Pigeon Bombs</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="rss.xml" class="nav-link">RSS feed</a>
                </li>
<li class="nav-item">
<a href="sphinx/index.html" class="nav-link">Documentation</a>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="https://necromuralist.github.io/Bandits-and-Pigeon-Bombs/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Searchâ€¦" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->


            <ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/reference-reinforcement-learning/" class="u-url">Reference: Reinforcement Learning</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/cloistered-monkey/">Cloistered Monkey</a>
            </span></p>
            <p class="dateline">
            <a href="posts/reference-reinforcement-learning/" rel="bookmark">
            <time class="published dt-published" datetime="2021-07-16T15:20:02-07:00" itemprop="datePublished" title="2021-07-16 15:20">2021-07-16 15:20</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
Sutton RS, Barto AG. Reinforcement learning: an introduction. Second edition. Cambridge, Massachusetts: The MIT Press; 2018. 526 p. (Adaptive computation and machine learning series). 
</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/openai-retro-introduction/" class="u-url">OpenAI Retro Introduction</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/cloistered-monkey/">Cloistered Monkey</a>
            </span></p>
            <p class="dateline">
            <a href="posts/openai-retro-introduction/" rel="bookmark">
            <time class="published dt-published" datetime="2018-07-08T19:27:27-07:00" itemprop="datePublished" title="2018-07-08 19:27">2018-07-08 19:27</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-orgdb2e84a" class="outline-2">
<h2 id="orgdb2e84a">Introduction</h2>
<div class="outline-text-2" id="text-orgdb2e84a">
<p>
<a href="https://github.com/openai/retro">OpenAI Retro</a> turns video game emulators into gym environments. This allows you to train a learner using video games from supported consoles (like the Atari 2600).
</p>
</div>
</div>

<div id="outline-container-org5ca3070" class="outline-2">
<h2 id="org5ca3070">Imports</h2>
<div class="outline-text-2" id="text-org5ca3070">
<p>
Instead of importing <code>gym</code> in this case you import <code>retro</code>.
</p>

<div class="highlight"><pre><span></span><span class="c1"># from pypi</span>
<span class="kn">import</span> <span class="nn">retro</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge6817e8" class="outline-2">
<h2 id="orge6817e8">The Environment</h2>
<div class="outline-text-2" id="text-orge6817e8">
<p>
It looks a lot like the way you run <code>gym</code>. First you make the environment and reset it.
</p>

<div class="highlight"><pre><span></span><span class="n">environment</span> <span class="o">=</span> <span class="n">retro</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">game</span><span class="o">=</span><span class="s2">"Airstriker-Genesis"</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">"Level1"</span><span class="p">)</span>
<span class="n">observation</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</pre></div>

<p>
You can see all the available games using <code>retro.list_games()</code>.
</p>

<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">game</span> <span class="ow">in</span> <span class="n">retro</span><span class="o">.</span><span class="n">list_games</span><span class="p">()[:</span><span class="mi">5</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">game</span><span class="p">)</span>
</pre></div>

<pre class="example">
: BankHeist-Atari2600
: SuperThunderBlade-Genesis
: DynamiteHeaddy-Genesis
: GalaxyForceII-Genesis
: SonicTheHedgehog-Genesis
</pre>

<p>
To see the available initial states you use <code>retro.list_states</code>.
</p>

<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">retro</span><span class="o">.</span><span class="n">list_states</span><span class="p">(</span><span class="s2">"Airstriker-Genesis"</span><span class="p">))</span>
</pre></div>

<pre class="example">
: ['Level1']
</pre>

<p>
So in this case there's only one option for us.
</p>
</div>
</div>

<div id="outline-container-orgf343a4b" class="outline-2">
<h2 id="orgf343a4b">Running It</h2>
<div class="outline-text-2" id="text-orgf343a4b">
<p>
As with the <code>gym</code> environments, with retro you sample the environment to get the next action and then pass it to the <code>step</code> method.
</p>

<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">environment</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
    <span class="n">observation</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="s2">"It took </span><span class="si">{}</span><span class="s2"> steps to finish this episode"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
	<span class="k">break</span>
</pre></div>

<p>
When you run it it will pop up a screen showing the game being played (sped up four times).
</p>


<div class="figure">
<p><img src="airstriker-genesis.png" alt="nil"></p>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/teaching-a-robot-to-walk/" class="u-url">Teaching A Robot To Walk</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/cloistered-monkey/">Cloistered Monkey</a>
            </span></p>
            <p class="dateline">
            <a href="posts/teaching-a-robot-to-walk/" rel="bookmark">
            <time class="published dt-published" datetime="2018-07-07T13:42:15-07:00" itemprop="datePublished" title="2018-07-07 13:42">2018-07-07 13:42</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org5283c1c" class="outline-2">
<h2 id="org5283c1c">Imports</h2>
<div class="outline-text-2" id="text-org5283c1c">
<p>
We need to import <a href="https://gym.openai.com/">openai-gym</a> (as gym).
</p>

<div class="highlight"><pre><span></span><span class="c1"># from pypi</span>
<span class="kn">import</span> <span class="nn">gym</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgc21b949" class="outline-2">
<h2 id="orgc21b949">Setting Up the Environment</h2>
<div class="outline-text-2" id="text-orgc21b949">
<p>
You build the environment with <code>gym.make</code>. In this case we're going to use the <a href="https://gym.openai.com/envs/BipedalWalker-v2/">BipedalWalker-v2</a>, which the documentation describes like this:
</p>

<blockquote>
<p>
Reward is given for moving forward, total 300+ points up to the far end. If the robot falls, it gets -100. Applying motor torque costs a small amount of points, more optimal agent will get better score. State consists of hull angle speed, angular velocity, horizontal speed, vertical speed, position of joints and joints angular speed, legs contact with ground, and 10 lidar rangefinder measurements. There's no coordinates in the state vector.
</p>
</blockquote>

<div class="highlight"><pre><span></span><span class="n">environment</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">"BipedalWalker-v2"</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgce8dbbb" class="outline-2">
<h2 id="orgce8dbbb">Running It</h2>
<div class="outline-text-2" id="text-orgce8dbbb">
<p>
We're going to run this for 10 episodes (each run from start to finish is an episode), resetting the environment for each episode. Then within an episode we're going to have the environment run up to 1,000 steps (a time-step that updates the environment). If it falls down or walks off screen the environment will indicate that it's done.
</p>

<div class="highlight"><pre><span></span><span class="n">EPISODES</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">STEPS</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="n">EPISODES</span><span class="p">:</span>
    <span class="n">observation</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">STEPS</span><span class="p">):</span>
	<span class="n">environment</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
	<span class="n">action</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
	<span class="n">observation</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">done</span><span class="p">:</span>
	    <span class="nb">print</span><span class="p">(</span><span class="s2">"It took </span><span class="si">{}</span><span class="s2"> steps to finish this episode."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
	    <span class="k">break</span>
</pre></div>

<p>
It only finished five out of the ten times, probably by falling down each time. Note that I didn't implement any logic to teach the robot to walk, this is all run with built-in functionality.
</p>

<p>
When you run it it will open a window so you can see what's happening.
</p>


<div class="figure">
<p><img src="robot-walker.png" alt="nil"></p>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/one-dimensional-world/" class="u-url">One-Dimensional World</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/cloistered-monkey/">Cloistered Monkey</a>
            </span></p>
            <p class="dateline">
            <a href="posts/one-dimensional-world/" rel="bookmark">
            <time class="published dt-published" datetime="2018-01-19T11:38:59-08:00" itemprop="datePublished" title="2018-01-19 11:38">2018-01-19 11:38</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org4f5a93a" class="outline-2">
<h2 id="org4f5a93a">Background</h2>
<div class="outline-text-2" id="text-org4f5a93a">
<p>
This is take from MorvanZhou's <a href="https://github.com/MorvanZhou/Reinforcement-learning-with-tensorflow">github repository</a>. It uses Q-learning to train an agent to explore a one-dimensional world that has the reward-state at the end of the world.
</p>
</div>
</div>

<div id="outline-container-orgae45c52" class="outline-2">
<h2 id="orgae45c52">Tangle</h2>
<div class="outline-text-2" id="text-orgae45c52">
<p>
This is the no-web tangle block. It shows how the code is organized.
</p>

<div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">constants</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">Q</span><span class="o">-</span><span class="n">Learner</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">episodes</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">terminal</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">q</span><span class="o">-</span><span class="n">environment</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">q</span><span class="o">-</span><span class="n">agent</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">q</span><span class="o">-</span><span class="n">call</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">environment</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">evaluate</span><span class="o">-</span><span class="n">action</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">update</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">goal</span><span class="o">-</span><span class="n">reached</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">reset</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">agent</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">q</span><span class="o">-</span><span class="n">table</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">action</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">act</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">main</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
</div>

<div id="outline-container-org58ea4dd" class="outline-2">
<h2 id="org58ea4dd">Imports</h2>
<div class="outline-text-2" id="text-org58ea4dd">
<p>
The only non-python-standard library requirements are numpy and pandas.
</p>
<div class="highlight"><pre><span></span><span class="c1"># python standard library</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># from pypi</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgf6fc704" class="outline-2">
<h2 id="orgf6fc704">Constants</h2>
<div class="outline-text-2" id="text-orgf6fc704">
<p>
The <code>Actions</code> class holds the strings used for the choice of actions. I tend to change my mind about names so I made a central object to store the strings.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Actions</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Left'</span><span class="p">,</span> <span class="s1">'Right'</span><span class="p">]</span>
    <span class="n">move_left</span> <span class="o">=</span> <span class="s1">'Left'</span>
    <span class="n">move_right</span> <span class="o">=</span> <span class="s1">'Right'</span>
</pre></div>
</div>
</div>
<div id="outline-container-org39efd0d" class="outline-2">
<h2 id="org39efd0d">Q-Learner</h2>
<div class="outline-text-2" id="text-org39efd0d">
<p>
This is what will run the reinforcement learning.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">QLearner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""Runs the reinforcement learning</span>

<span class="sd">    Args:</span>
<span class="sd">     episodes: Number of time to repeat training</span>
<span class="sd">     start_state (int): where to start the agent</span>
<span class="sd">     states (int): total size for the environment</span>
<span class="sd">     terminal (int): where the goal state is</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episodes</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">start_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">terminal</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">episodes</span> <span class="o">=</span> <span class="n">episodes</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">start_state</span> <span class="o">=</span> <span class="n">start_state</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="n">states</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_terminal</span> <span class="o">=</span> <span class="n">terminal</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_environment</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_agent</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="k">return</span>
</pre></div>
</div>
<div id="outline-container-orgc4858e4" class="outline-3">
<h3 id="orgc4858e4">Terminal</h3>
<div class="outline-text-3" id="text-orgc4858e4">
<p>
This is the goal state. If it isn't set then it will default to being the rightmost state.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">terminal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Goal state</span>

<span class="sd">    Returns:</span>
<span class="sd">     int: zero-based index of the goal-state</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terminal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_terminal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terminal</span>
</pre></div>
</div>
</div>
<div id="outline-container-org5ac7f62" class="outline-3">
<h3 id="org5ac7f62">Episodes</h3>
<div class="outline-text-3" id="text-org5ac7f62">
<p>
An 'episode' is a single session that is run until the agent reaches the goal. To improve its performance, you can run it over multiple episodes so it can keep learning.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">episodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""the episodes iterator</span>

<span class="sd">    Returns:</span>
<span class="sd">     range: (1, episodes + 1)</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span>

<span class="nd">@episodes</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">episodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_count</span><span class="p">):</span>
    <span class="sd">"""creates the episodes iterator</span>

<span class="sd">    Args:</span>
<span class="sd">     episode_count(int): number of episodes to train the agent</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">episode_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge1da135" class="outline-3">
<h3 id="orge1da135">The Q-Environment</h3>
<div class="outline-text-3" id="text-orge1da135">
<p>
I couldn't decide who should build the agent and the environment so I had the Q-Learner do it.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">environment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""The Environment for the agent</span>

<span class="sd">    Returns:</span>
<span class="sd">     Environment: one-dimensional environment</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_environment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_environment</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_state</span><span class="p">,</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">,</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">terminal</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_environment</span>
</pre></div>
</div>
</div>

<div id="outline-container-org3c754db" class="outline-3">
<h3 id="org3c754db">The Q-Agent</h3>
<div class="outline-text-3" id="text-org3c754db">
<p>
Since the Q-Learner is building the environment I'm going to make it build the Agent too.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">agent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""The agent that explores the environment</span>

<span class="sd">    Returns:</span>
<span class="sd">     Agent: agent built for the environment</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span>
</pre></div>
</div>
</div>

<div id="outline-container-org0680bde" class="outline-3">
<h3 id="org0680bde">Call</h3>
<div class="outline-text-3" id="text-org0680bde">
<p>
This runs the episodes.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""runs the episodes to train the agent in the environment</span>

<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">episodes</span><span class="p">:</span>
	<span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">episode</span><span class="p">,</span> <span class="n">counter</span><span class="p">)</span>
	<span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">goal_reached</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">act</span><span class="p">()</span>
	    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">episode</span><span class="p">,</span> <span class="n">counter</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-orgd4a0fc4" class="outline-2">
<h2 id="orgd4a0fc4">The Environment</h2>
<div class="outline-text-2" id="text-orgd4a0fc4">
<p>
This will hold the environment for the agent to explore.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Environment</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""The environment to explore</span>

<span class="sd">    Args:</span>
<span class="sd">     start_state(int): where the agent will start</span>
<span class="sd">     states (int): the size of the world</span>
<span class="sd">     terminal (int): where the target state is</span>
<span class="sd">     output_pause (float): seconds to sleep after printing to the screen</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_state</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">terminal</span><span class="p">,</span> <span class="n">output_pause</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">start_state</span> <span class="o">=</span> <span class="n">start_state</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">start_state</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">next_state</span> <span class="o">=</span> <span class="n">start_state</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="n">states</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="n">terminal</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">output_pause</span> <span class="o">=</span> <span class="n">output_pause</span>
	<span class="k">return</span>
</pre></div>
</div>

<div id="outline-container-org75e1ff7" class="outline-3">
<h3 id="org75e1ff7">Goal Reached</h3>
<div class="outline-text-3" id="text-org75e1ff7">
<p>
This is used both to update the q-table and to decide whether to quit the episode. Because updating the q-table requires both the current and next states, it is based on the next state, with the assumption that it will be updated before the next episode
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">goal_reached</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Checks if the next-state is the goal</span>

<span class="sd">    Returns:</span>
<span class="sd">     bool: True if next-state is the goal</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_state</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminal</span>
</pre></div>
</div>
</div>

<div id="outline-container-org6de59f7" class="outline-3">
<h3 id="org6de59f7">Evaluate Action</h3>
<div class="outline-text-3" id="text-org6de59f7">
<p>
This will check if the <code>action</code> will lead to the goal and decide the reward to give for the action. It also sets the <code>next_state</code> property based on the current <code>state</code> and the chosen <code>action</code>.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="sd">"""Checks if the action will lead to the goal</span>

<span class="sd">    Args:</span>
<span class="sd">     action (str): one of the actions to explore the environment</span>

<span class="sd">    Returns:</span>
<span class="sd">     int: 1 if this will lead to the goal, 0 otherwise</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="n">Actions</span><span class="o">.</span><span class="n">move_right</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">next_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">next_state</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">reward</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_state</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminal</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">reward</span>
</pre></div>
</div>
</div>

<div id="outline-container-org6287144" class="outline-3">
<h3 id="org6287144">Update the Environment</h3>
<div class="outline-text-3" id="text-org6287144">
<p>
This prints out the environment for the user and updates the state.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
    <span class="sd">"""Emits the updated environment to the user</span>

<span class="sd">    also sets the state to the next state</span>

<span class="sd">    Args:</span>
<span class="sd">     episode (int): what episode we're in</span>
<span class="sd">     step (int): how long we've been running this episode</span>
<span class="sd">    """</span>
    <span class="n">environment</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'-'</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">'T'</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal_reached</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Episode </span><span class="si">{}</span><span class="s2">: Total Steps = </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">episode</span><span class="p">,</span> <span class="n">step</span><span class="p">))</span>
	<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_pause</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
	<span class="n">environment</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">next_state</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'O'</span>
	<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">environment</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_state</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-org70e4539" class="outline-3">
<h3 id="org70e4539">Reset the environment</h3>
<div class="outline-text-3" id="text-org70e4539">
<p>
This sets the current <code>state</code> and the <code>next-state</code> to the <code>start state</code> so the environment can be re-used in different episodes.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Resets the states to the start state"""</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">next_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_state</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org7d7f134" class="outline-2">
<h2 id="org7d7f134">The Agent</h2>
<div class="outline-text-2" id="text-org7d7f134">
<p>
This is the agent that will learn to find the reward.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Agent</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""This is the agent that will learn to find the treasure</span>

<span class="sd">    Args:</span>
<span class="sd">     environment: The environment to explore</span>
<span class="sd">     exploitation_rate: Fraction of the time to exploit (epsilon)</span>
<span class="sd">     discount_factor: Discount factor (gamma)</span>
<span class="sd">     learning_rate: how much to change the reward (alpha)</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">,</span> <span class="n">exploitation_rate</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">discount_factor</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
		 <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">environment</span> <span class="o">=</span> <span class="n">environment</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">exploitation_rate</span> <span class="o">=</span> <span class="n">exploitation_rate</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">discount_factor</span> <span class="o">=</span> <span class="n">discount_factor</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_q_table</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="k">return</span>
</pre></div>

<p>
Other than the environment, these are the values the <code>Agent</code> needs:
</p>

<ul class="org-ul">
<li>
<code>exploitation_rate</code>: What fraction of the time to use the best known action so far. Setting it to 0 means always use a random action, 1 means only use the best known action.</li>
<li>
<code>discount_factor</code>: The amount to discount the previously discovered reward. Setting it to less than 1 prevents infinite loops.</li>
<li>
<code>learning_rate</code>: How much to update the values in the table. 0 means don't update. 1 means use all of the new information.</li>
</ul>
</div>

<div id="outline-container-org39cb3fd" class="outline-3">
<h3 id="org39cb3fd">The Q-Table</h3>
<div class="outline-text-3" id="text-org39cb3fd">
<p>
The agent learns by building a table of 'Quality' estimates for any action chosen for the current state. Each state is a row in the table and each column is a possible action that can be taken. Initially the table is set to all zeros.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">q_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""The Quality Estimate table</span>

<span class="sd">    Each cell is the quality-estimate for a given state, action pair</span>

<span class="sd">    Returns:</span>
<span class="sd">     DataFrame: rows are states, columns are actions</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_q_table</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
	    <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">states</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Actions</span><span class="o">.</span><span class="n">actions</span><span class="p">))),</span>
	    <span class="n">columns</span><span class="o">=</span><span class="n">Actions</span><span class="o">.</span><span class="n">actions</span><span class="p">,</span>
	<span class="p">)</span>
	<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_table</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">states</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Actions</span><span class="o">.</span><span class="n">actions</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q_table</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgd0a0f31" class="outline-3">
<h3 id="orgd0a0f31">Action</h3>
<div class="outline-text-3" id="text-orgd0a0f31">
<p>
Generates an action based on the current state. This is using an epsilon-greedy algorithm so it will explore if the value is above a certain threshold, otherwise it will exploit the best solution so far. It also will explore if the state has never lead to reaching the goal. This was confusing at first, but the updated reward for the current state is calculated based on the next state that this action leads to, so as the episodes continue, the rewards will fill in from the goal-state back to the start state.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return the next chosen action</span>

<span class="sd">    Returns:</span>
<span class="sd">     str: the next action to take</span>
<span class="sd">    """</span>
    <span class="c1"># get the row in the q-table matching the current state</span>
    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="p">:]</span>

    <span class="c1"># only explore if we generate a value over epsilon</span>
    <span class="c1"># or none of the actions have a reward</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">exploitation_rate</span> <span class="ow">or</span> <span class="n">state</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
	<span class="n">action</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">Actions</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># exploit</span>
	<span class="c1"># get the column-name of the cell with the largest value</span>
	<span class="n">action</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">action</span>
</pre></div>
</div>
</div>
<div id="outline-container-orgc810a9f" class="outline-3">
<h3 id="orgc810a9f">Act</h3>
<div class="outline-text-3" id="text-orgc810a9f">
<p>
This gets the next action to take, queries the environment for the reward (which also triggers storing the next state in the environment), then updates the q-table.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">act</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Updates the Q-table based on the reward from the last action"""</span>
    <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span>
    <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="n">previous_quality</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">goal_reached</span><span class="p">:</span>
	<span class="n">new_quality</span> <span class="o">=</span> <span class="n">reward</span>
    <span class="k">else</span><span class="p">:</span>
	<span class="n">new_quality</span> <span class="o">=</span> <span class="n">reward</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">discount_factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">next_state</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">q_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="p">(</span><span class="n">new_quality</span> <span class="o">-</span> <span class="n">previous_quality</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org567c3e2" class="outline-2">
<h2 id="org567c3e2">Main</h2>
<div class="outline-text-2" id="text-org567c3e2">
<p>
Runs the simulation.
</p>

<div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">learner</span> <span class="o">=</span> <span class="n">QLearner</span><span class="p">(</span><span class="n">states</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">learner</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">q_table</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">learned-model with only exploitation set"</span><span class="p">)</span>
    <span class="n">learner</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">exploitation_rate</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">learner</span><span class="o">.</span><span class="n">episodes</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">learner</span><span class="p">()</span>
</pre></div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/PyBrain-Optimization-Example/" class="u-url">PyBrain Optimization Example</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/necromuralist/">necromuralist</a>
            </span></p>
            <p class="dateline">
            <a href="posts/PyBrain-Optimization-Example/" rel="bookmark">
            <time class="published dt-published" datetime="2018-01-12T16:16:00-08:00" itemprop="datePublished" title="2018-01-12 16:16">2018-01-12 16:16</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>This is the <a class="reference external" href="http://www.pybrain.org/docs/tutorial/optimization.html#general-optimization-using-evolvable">general optimization example</a> from the pybrain documentation.</p>
<section id="imports"><h2>1 Imports</h2>
<pre class="code python"><a id="rest_code_198a39bbbee640a285669f894571b024-1" name="rest_code_198a39bbbee640a285669f894571b024-1"></a><span class="c1"># python standard library</span>
<a id="rest_code_198a39bbbee640a285669f894571b024-2" name="rest_code_198a39bbbee640a285669f894571b024-2"></a><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span>
<a id="rest_code_198a39bbbee640a285669f894571b024-3" name="rest_code_198a39bbbee640a285669f894571b024-3"></a>
<a id="rest_code_198a39bbbee640a285669f894571b024-4" name="rest_code_198a39bbbee640a285669f894571b024-4"></a><span class="c1"># pypi</span>
<a id="rest_code_198a39bbbee640a285669f894571b024-5" name="rest_code_198a39bbbee640a285669f894571b024-5"></a><span class="kn">from</span> <span class="nn">pybrain.structure.evolvables.evolvable</span> <span class="kn">import</span> <span class="n">Evolvable</span>
<a id="rest_code_198a39bbbee640a285669f894571b024-6" name="rest_code_198a39bbbee640a285669f894571b024-6"></a><span class="kn">from</span> <span class="nn">pybrain.optimization</span> <span class="kn">import</span> <span class="n">HillClimber</span>
</pre></section><section id="the-evolvable"><h2>2 The Evolvable</h2>
<p>To make an optimization that can take arbitrary values (not just continuous numbers), you can implement a sub-class of the PyBrain <a class="reference external" href="http://www.pybrain.org/docs/api/structure/evolvables.html">Evolvable</a> class.</p>
<section id="the-constructor"><h3>2.1 The Constructor</h3>
<p>The <code class="docutils literal">Evolvable</code> class doesn't implement a constructor so you can create one with any parameters you need.</p>
</section><section id="the-mutate-method"><h3>2.2 The Mutate Method</h3>
<p>This is the method that is called after each round to change the parameters a little (a <cite>tweak</cite>). It takes positional arguments, but I think it's called by the Hill Climber so I don't know where it gets passed in.</p>
</section><section id="the-copy-method"><h3>2.3 The Copy Method</h3>
<p>The tutorial says this is a required method, but the documentation for the API says it should default to a deep-copy. Anyway, I think this is only used if you use something like a Genetic Algorithm.</p>
</section><section id="the-randomize-method"><h3>2.4 The Randomize Method</h3>
<p>This is used to initialize the parameters to a random value. This is required but I'm pretty sure it doesn't get used in this case.</p>
<pre class="code python"><a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-1" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-1"></a><span class="k">class</span> <span class="nc">Mutant</span><span class="p">(</span><span class="n">Evolvable</span><span class="p">):</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-2" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-2"></a>    <span class="sd">"""A simple evolvable class</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-3" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-3"></a>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-4" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-4"></a><span class="sd">    Args:</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-5" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-5"></a><span class="sd">     x: a starting value to mimic the fitness of the model</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-6" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-6"></a><span class="sd">     mininmum: smallest allowed value</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-7" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-7"></a><span class="sd">     maximum: biggest allowed value</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-8" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-8"></a><span class="sd">    """</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-9" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-9"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-10" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="n">minimum</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-11" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="n">maximum</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-12" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-12"></a>        <span class="c1"># minimum &lt;= x &lt;= maximum</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-13" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="kc">None</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-14" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-15" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-15"></a>        <span class="k">return</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-16" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-16"></a>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-17" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-17"></a>    <span class="nd">@property</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-18" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-18"></a>    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-19" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-19"></a>        <span class="sd">"""The value to optimize</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-20" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-20"></a>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-21" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-21"></a><span class="sd">        Returns:</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-22" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-22"></a><span class="sd">         x (float): value to optimize</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-23" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-23"></a><span class="sd">        """</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-24" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-24"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-25" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-25"></a>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-26" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-26"></a>    <span class="nd">@x</span><span class="o">.</span><span class="n">setter</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-27" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-27"></a>    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_x</span><span class="p">):</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-28" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-28"></a>        <span class="sd">"""sets x, constraining the value</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-29" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-29"></a>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-30" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-30"></a><span class="sd">        Args:</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-31" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-31"></a><span class="sd">         new_x: float from minimum to maximum</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-32" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-32"></a><span class="sd">        """</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-33" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-33"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">new_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span><span class="p">))</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-34" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-34"></a>        <span class="k">return</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-35" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-35"></a>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-36" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-36"></a>    <span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-37" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-37"></a>        <span class="sd">"""Updates x with a random change</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-38" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-38"></a>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-39" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-39"></a><span class="sd">        Maintains the constraint of the value</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-40" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-40"></a><span class="sd">        """</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-41" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="p">(</span><span class="n">random</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">)</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-42" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-42"></a>        <span class="k">return</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-43" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-43"></a>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-44" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-44"></a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-45" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-45"></a>        <span class="sd">"""Returns a new instance with the same x-value</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-46" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-46"></a>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-47" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-47"></a><span class="sd">        Returns:</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-48" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-48"></a><span class="sd">         Mutant: copy of this instance</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-49" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-49"></a><span class="sd">        """</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-50" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-50"></a>        <span class="k">return</span> <span class="n">Mutant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-51" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-51"></a>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-52" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-52"></a>    <span class="k">def</span> <span class="nf">randomize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-53" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-53"></a>        <span class="sd">"""A method to randomize the x-value"""</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-54" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-54"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span> <span class="o">*</span> <span class="n">random</span><span class="p">()</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-55" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-55"></a>        <span class="k">return</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-56" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-56"></a>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-57" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-57"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-58" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-58"></a>        <span class="sd">"""String representation</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-59" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-59"></a>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-60" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-60"></a><span class="sd">        Returns:</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-61" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-61"></a><span class="sd">         str: formatted version of x</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-62" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-62"></a><span class="sd">        """</span>
<a id="rest_code_4783a5189ac945f0a461fbbd95f4b42a-63" name="rest_code_4783a5189ac945f0a461fbbd95f4b42a-63"></a>        <span class="k">return</span> <span class="s2">"&lt; </span><span class="si">{:.2f}</span><span class="s2"> (Maximized=</span><span class="si">{}</span><span class="s2">)&gt;"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span>
</pre></section></section><section id="hill-climbing"><h2>3 Hill Climbing</h2>
<p>The <a class="reference external" href="http://www.pybrain.org/docs/api/optimization/optimization.html#module-pybrain.optimization">HillClimber</a> is the simplest search - it assumes the first minima or maxima it finds is the global one. By default it tries to maximize the outcome. None of the arguments are required at instantiation, but in this case we're setting:</p>
<ul class="simple">
<li><p>an <code class="docutils literal">evaluator</code>: a callable that outputs how well the object to be evaluated did</p></li>
<li><p>an <code class="docutils literal">evaluable</code>: the object to be evaluated in this case our <code class="docutils literal">Mutant</code></p></li>
<li><p><code class="docutils literal">maxEvaluations</code>: The maximum number of times the <code class="docutils literal">evaluable</code> is evaluated</p></li>
<li><p><code class="docutils literal">verbose</code>: print each step</p></li>
<li><p><code class="docutils literal">desiredEvaluation</code>: the value that is good enough so the climber can stop</p></li>
</ul>
<section id="the-evaluator-function"><h3>3.1 The Evaluator Function</h3>
<p>In this case we're just going to return the x value of the object.</p>
<pre class="code python"><a id="rest_code_6f9d99aef19a43a2a4ab6217c0363980-1" name="rest_code_6f9d99aef19a43a2a4ab6217c0363980-1"></a><span class="k">def</span> <span class="nf">evaluator</span><span class="p">(</span><span class="n">mutant</span><span class="p">):</span>
<a id="rest_code_6f9d99aef19a43a2a4ab6217c0363980-2" name="rest_code_6f9d99aef19a43a2a4ab6217c0363980-2"></a>    <span class="k">return</span> <span class="n">mutant</span><span class="o">.</span><span class="n">x</span>
</pre></section><section id="the-instances"><h3>3.2 The Instances</h3>
<pre class="code python"><a id="rest_code_5d425abe88a8442e8d68def148f29082-1" name="rest_code_5d425abe88a8442e8d68def148f29082-1"></a><span class="n">mutant</span> <span class="o">=</span> <span class="n">Mutant</span><span class="p">(</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
<a id="rest_code_5d425abe88a8442e8d68def148f29082-2" name="rest_code_5d425abe88a8442e8d68def148f29082-2"></a><span class="n">climber</span> <span class="o">=</span> <span class="n">HillClimber</span><span class="p">(</span><span class="n">evaluator</span><span class="p">,</span> <span class="n">mutant</span><span class="p">,</span> <span class="n">maxEvaluations</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desiredEvaluation</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></section><section id="the-optimization"><h3>3.3 The Optimization</h3>
<p>The optimization classes get run using their <code class="docutils literal">learn</code> methods.</p>
<pre class="code python"><a id="rest_code_cb50adf5b59f4fcca5a112bc62fe7e65-1" name="rest_code_cb50adf5b59f4fcca5a112bc62fe7e65-1"></a><span class="n">outcome</span> <span class="o">=</span> <span class="n">climber</span><span class="o">.</span><span class="n">learn</span><span class="p">()</span>
<a id="rest_code_cb50adf5b59f4fcca5a112bc62fe7e65-2" name="rest_code_cb50adf5b59f4fcca5a112bc62fe7e65-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre>
<pre class="literal-block">('Step:', 0, 'best:', 6.780765339892317)
('Step:', 1, 'best:', 6.780765339892317)
('Step:', 2, 'best:', 6.807553650921801)
('Step:', 3, 'best:', 7.282574697921699)
('Step:', 4, 'best:', 7.45592511459156)
('Step:', 5, 'best:', 7.533694376079802)
('Step:', 6, 'best:', 7.751507552794123)
('Step:', 7, 'best:', 8.184303418505593)
('Step:', 8, 'best:', 8.184303418505593)
('Step:', 9, 'best:', 8.224264996606221)
('Step:', 10, 'best:', 8.4835021736195)
('Step:', 11, 'best:', 9.153976071682798)
('Step:', 12, 'best:', 9.55795557780446)
('Step:', 13, 'best:', 10)
(&lt; 10.00 (Maximized=True)&gt;, 10)</pre>
<p>It managed to find the maximum in 13 steps.</p>
</section></section>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/Epsilon-Greedy-with-Normal-Distribution-Payouts/" class="u-url">Epsilon Greedy with Normal-Distribution Payouts</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/brunhilde/">Brunhilde</a>
            </span></p>
            <p class="dateline">
            <a href="posts/Epsilon-Greedy-with-Normal-Distribution-Payouts/" rel="bookmark">
            <time class="published dt-published" datetime="2017-08-01T18:48:00-07:00" itemprop="datePublished" title="2017-08-01 18:48">2017-08-01 18:48</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <section id="epsilon-greedy"><h2>1 Epsilon Greedy</h2>
<p>Since the Optimistic Initial Values agent can't use the Bernoulli Arm, I'm creating a version of the Epsilon Greedy Optimized that expects the <code class="docutils literal">arms</code> to be the population-mean for their payouts and the <code class="docutils literal">pull_arm</code> will return a set of normally-distributed around that mean.</p>
<pre class="code python"><a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-1" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-1"></a><span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-2" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-2"></a>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-3" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-3"></a><span class="o">&lt;&lt;</span><span class="n">spec</span><span class="o">&gt;&gt;</span>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-4" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-4"></a>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-5" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-5"></a><span class="o">&lt;&lt;</span><span class="n">find</span><span class="o">-</span><span class="n">first</span><span class="o">&gt;&gt;</span>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-6" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-6"></a><span class="nd">@jitclass</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-7" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-7"></a><span class="k">class</span> <span class="nc">EpsilonGreedyNormal</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-8" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-8"></a>    <span class="sd">"""The Epsilon Greedy Algorithm With Normal Arm</span>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-9" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-9"></a>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-10" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-10"></a><span class="sd">    Args:</span>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-11" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-11"></a><span class="sd">     epsilon (float): fraction of the time to explore</span>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-12" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-12"></a><span class="sd">     arms (list): collection of probabilities for bandit arm</span>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-13" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-13"></a><span class="sd">    """</span>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-14" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-14"></a>    <span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">constructor</span><span class="o">&gt;&gt;</span>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-15" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-15"></a>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-16" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-16"></a>    <span class="o">&lt;&lt;</span><span class="n">best</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-17" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-17"></a>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-18" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-18"></a>    <span class="o">&lt;&lt;</span><span class="n">select</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-19" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-19"></a>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-20" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-20"></a>    <span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">pull</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-21" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-21"></a>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-22" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-22"></a>    <span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">update</span><span class="o">&gt;&gt;</span>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-23" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-23"></a>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-24" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-24"></a>    <span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">reset</span><span class="o">&gt;&gt;</span>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-25" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-25"></a>
<a id="rest_code_3a4e5a2888f34bc9a3654cd549b36747-26" name="rest_code_3a4e5a2888f34bc9a3654cd549b36747-26"></a>    <span class="o">&lt;&lt;</span><span class="n">call</span><span class="o">&gt;&gt;</span>
</pre>
<section id="optimized-imports"><h3>1.1 Optimized Imports</h3>
<pre class="code python"><a id="rest_code_873ac6cfb1f745398e6223c6e876cd70-1" name="rest_code_873ac6cfb1f745398e6223c6e876cd70-1"></a><span class="c1"># pypi</span>
<a id="rest_code_873ac6cfb1f745398e6223c6e876cd70-2" name="rest_code_873ac6cfb1f745398e6223c6e876cd70-2"></a><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="p">(</span>
<a id="rest_code_873ac6cfb1f745398e6223c6e876cd70-3" name="rest_code_873ac6cfb1f745398e6223c6e876cd70-3"></a>    <span class="n">jit</span><span class="p">,</span>
<a id="rest_code_873ac6cfb1f745398e6223c6e876cd70-4" name="rest_code_873ac6cfb1f745398e6223c6e876cd70-4"></a>    <span class="n">jitclass</span><span class="p">,</span>
<a id="rest_code_873ac6cfb1f745398e6223c6e876cd70-5" name="rest_code_873ac6cfb1f745398e6223c6e876cd70-5"></a>    <span class="p">)</span>
<a id="rest_code_873ac6cfb1f745398e6223c6e876cd70-6" name="rest_code_873ac6cfb1f745398e6223c6e876cd70-6"></a><span class="kn">import</span> <span class="nn">numba</span>
<a id="rest_code_873ac6cfb1f745398e6223c6e876cd70-7" name="rest_code_873ac6cfb1f745398e6223c6e876cd70-7"></a><span class="kn">import</span> <span class="nn">numpy</span>
</pre></section><section id="the-spec"><h3>1.2 The Spec</h3>
<p>This is how you tell numba what attributes the class will have.</p>
<pre class="code python"><a id="rest_code_791250c3d7e04dcf8834928c956d573d-1" name="rest_code_791250c3d7e04dcf8834928c956d573d-1"></a><span class="n">spec</span> <span class="o">=</span> <span class="p">[</span>
<a id="rest_code_791250c3d7e04dcf8834928c956d573d-2" name="rest_code_791250c3d7e04dcf8834928c956d573d-2"></a>    <span class="p">(</span><span class="s2">"epsilon"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">),</span>
<a id="rest_code_791250c3d7e04dcf8834928c956d573d-3" name="rest_code_791250c3d7e04dcf8834928c956d573d-3"></a>    <span class="p">(</span><span class="s2">"arms"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a id="rest_code_791250c3d7e04dcf8834928c956d573d-4" name="rest_code_791250c3d7e04dcf8834928c956d573d-4"></a>    <span class="p">(</span><span class="s2">"counts"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a id="rest_code_791250c3d7e04dcf8834928c956d573d-5" name="rest_code_791250c3d7e04dcf8834928c956d573d-5"></a>    <span class="p">(</span><span class="s2">"rewards"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a id="rest_code_791250c3d7e04dcf8834928c956d573d-6" name="rest_code_791250c3d7e04dcf8834928c956d573d-6"></a>    <span class="p">(</span><span class="s2">"total_reward"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
<a id="rest_code_791250c3d7e04dcf8834928c956d573d-7" name="rest_code_791250c3d7e04dcf8834928c956d573d-7"></a><span class="p">]</span>
</pre></section><section id="the-constructor"><h3>1.3 The Constructor</h3>
<p>The constructor takes two arguments - <em>epsilon</em> and <em>arms</em>. The <em>arms</em> list should contain the mean payout for each arm.</p>
<pre class="code python"><a id="rest_code_5e6e2d9c49b845aa80e625ca237cdf77-1" name="rest_code_5e6e2d9c49b845aa80e625ca237cdf77-1"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">arms</span><span class="p">):</span>
<a id="rest_code_5e6e2d9c49b845aa80e625ca237cdf77-2" name="rest_code_5e6e2d9c49b845aa80e625ca237cdf77-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
<a id="rest_code_5e6e2d9c49b845aa80e625ca237cdf77-3" name="rest_code_5e6e2d9c49b845aa80e625ca237cdf77-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="n">arms</span>
<a id="rest_code_5e6e2d9c49b845aa80e625ca237cdf77-4" name="rest_code_5e6e2d9c49b845aa80e625ca237cdf77-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arms</span><span class="p">))</span>
<a id="rest_code_5e6e2d9c49b845aa80e625ca237cdf77-5" name="rest_code_5e6e2d9c49b845aa80e625ca237cdf77-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arms</span><span class="p">))</span>
<a id="rest_code_5e6e2d9c49b845aa80e625ca237cdf77-6" name="rest_code_5e6e2d9c49b845aa80e625ca237cdf77-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
<a id="rest_code_5e6e2d9c49b845aa80e625ca237cdf77-7" name="rest_code_5e6e2d9c49b845aa80e625ca237cdf77-7"></a>    <span class="k">return</span>
</pre></section><section id="reset"><h3>1.4 Reset</h3>
<pre class="code python"><a id="rest_code_9a32cc1ac8374d3da26f678e2257e446-1" name="rest_code_9a32cc1ac8374d3da26f678e2257e446-1"></a><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="rest_code_9a32cc1ac8374d3da26f678e2257e446-2" name="rest_code_9a32cc1ac8374d3da26f678e2257e446-2"></a>    <span class="sd">"""sets the counts, rewards, total_reward to 0s</span>
<a id="rest_code_9a32cc1ac8374d3da26f678e2257e446-3" name="rest_code_9a32cc1ac8374d3da26f678e2257e446-3"></a>
<a id="rest_code_9a32cc1ac8374d3da26f678e2257e446-4" name="rest_code_9a32cc1ac8374d3da26f678e2257e446-4"></a><span class="sd">    This lets you re-used the EpsilonGreedy</span>
<a id="rest_code_9a32cc1ac8374d3da26f678e2257e446-5" name="rest_code_9a32cc1ac8374d3da26f678e2257e446-5"></a><span class="sd">    """</span>
<a id="rest_code_9a32cc1ac8374d3da26f678e2257e446-6" name="rest_code_9a32cc1ac8374d3da26f678e2257e446-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
<a id="rest_code_9a32cc1ac8374d3da26f678e2257e446-7" name="rest_code_9a32cc1ac8374d3da26f678e2257e446-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
<a id="rest_code_9a32cc1ac8374d3da26f678e2257e446-8" name="rest_code_9a32cc1ac8374d3da26f678e2257e446-8"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
<a id="rest_code_9a32cc1ac8374d3da26f678e2257e446-9" name="rest_code_9a32cc1ac8374d3da26f678e2257e446-9"></a>    <span class="k">return</span>
</pre></section><section id="best-arm"><h3>1.5 Best Arm</h3>
<p>The <code class="docutils literal">best_arm</code> property returns the index of the arm that has the highest average reward so far. It returns the index instead of the arm itself because it's used to get the matching counts and rewards in the <code class="docutils literal">update</code> method. Since I'm using the <code class="docutils literal">jitclass</code> decorator I'm going to get rid of <code class="docutils literal">first_find</code>.</p>
<pre class="code python"><a id="rest_code_58ec7b44d24a4f4e8f115f6cfcdf175e-1" name="rest_code_58ec7b44d24a4f4e8f115f6cfcdf175e-1"></a><span class="nd">@property</span>
<a id="rest_code_58ec7b44d24a4f4e8f115f6cfcdf175e-2" name="rest_code_58ec7b44d24a4f4e8f115f6cfcdf175e-2"></a><span class="k">def</span> <span class="nf">best_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="rest_code_58ec7b44d24a4f4e8f115f6cfcdf175e-3" name="rest_code_58ec7b44d24a4f4e8f115f6cfcdf175e-3"></a>    <span class="sd">"""Index of the arm with the most reward"""</span>
<a id="rest_code_58ec7b44d24a4f4e8f115f6cfcdf175e-4" name="rest_code_58ec7b44d24a4f4e8f115f6cfcdf175e-4"></a>    <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<a id="rest_code_58ec7b44d24a4f4e8f115f6cfcdf175e-5" name="rest_code_58ec7b44d24a4f4e8f115f6cfcdf175e-5"></a>    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">)):</span>
<a id="rest_code_58ec7b44d24a4f4e8f115f6cfcdf175e-6" name="rest_code_58ec7b44d24a4f4e8f115f6cfcdf175e-6"></a>        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
<a id="rest_code_58ec7b44d24a4f4e8f115f6cfcdf175e-7" name="rest_code_58ec7b44d24a4f4e8f115f6cfcdf175e-7"></a>            <span class="k">return</span> <span class="n">index</span>
<a id="rest_code_58ec7b44d24a4f4e8f115f6cfcdf175e-8" name="rest_code_58ec7b44d24a4f4e8f115f6cfcdf175e-8"></a>    <span class="k">return</span>
</pre></section><section id="select-arm"><h3>1.6 Select Arm</h3>
<p>This differs from the other Epsilon Greedy code only in that I'm using numpy instead of python for the random function.</p>
<pre class="code python"><a id="rest_code_2178f974d4524e0ab8b9d2d7e496125c-1" name="rest_code_2178f974d4524e0ab8b9d2d7e496125c-1"></a><span class="k">def</span> <span class="nf">select_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="rest_code_2178f974d4524e0ab8b9d2d7e496125c-2" name="rest_code_2178f974d4524e0ab8b9d2d7e496125c-2"></a>    <span class="sd">"""chooses the next arm to update</span>
<a id="rest_code_2178f974d4524e0ab8b9d2d7e496125c-3" name="rest_code_2178f974d4524e0ab8b9d2d7e496125c-3"></a>
<a id="rest_code_2178f974d4524e0ab8b9d2d7e496125c-4" name="rest_code_2178f974d4524e0ab8b9d2d7e496125c-4"></a><span class="sd">    Returns:</span>
<a id="rest_code_2178f974d4524e0ab8b9d2d7e496125c-5" name="rest_code_2178f974d4524e0ab8b9d2d7e496125c-5"></a><span class="sd">     int: index of the next arm to pull</span>
<a id="rest_code_2178f974d4524e0ab8b9d2d7e496125c-6" name="rest_code_2178f974d4524e0ab8b9d2d7e496125c-6"></a><span class="sd">    """</span>
<a id="rest_code_2178f974d4524e0ab8b9d2d7e496125c-7" name="rest_code_2178f974d4524e0ab8b9d2d7e496125c-7"></a>    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">:</span>
<a id="rest_code_2178f974d4524e0ab8b9d2d7e496125c-8" name="rest_code_2178f974d4524e0ab8b9d2d7e496125c-8"></a>        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
<a id="rest_code_2178f974d4524e0ab8b9d2d7e496125c-9" name="rest_code_2178f974d4524e0ab8b9d2d7e496125c-9"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_arm</span>
</pre></section><section id="pull-arm"><h3>1.7 Pull Arm</h3>
<p>Since we can't give user-defined objects as attributes of the class, this version will be both algorithm and bandit. This is what's different from the other Epsilon Greedy algorithms in that we're returning the arm's mean plus a random number from the normal distribution. If numba allowed us to pass in objects maybe we could have just switched out bandits. I need to look into how to make that work.</p>
<pre class="code python"><a id="rest_code_c27c7cbd42174f5e9fa7974b4680b822-1" name="rest_code_c27c7cbd42174f5e9fa7974b4680b822-1"></a><span class="k">def</span> <span class="nf">pull_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">):</span>
<a id="rest_code_c27c7cbd42174f5e9fa7974b4680b822-2" name="rest_code_c27c7cbd42174f5e9fa7974b4680b822-2"></a>    <span class="sd">"""gets the reward</span>
<a id="rest_code_c27c7cbd42174f5e9fa7974b4680b822-3" name="rest_code_c27c7cbd42174f5e9fa7974b4680b822-3"></a>
<a id="rest_code_c27c7cbd42174f5e9fa7974b4680b822-4" name="rest_code_c27c7cbd42174f5e9fa7974b4680b822-4"></a><span class="sd">    Args:</span>
<a id="rest_code_c27c7cbd42174f5e9fa7974b4680b822-5" name="rest_code_c27c7cbd42174f5e9fa7974b4680b822-5"></a><span class="sd">     arm (int): index for the arm-probability array</span>
<a id="rest_code_c27c7cbd42174f5e9fa7974b4680b822-6" name="rest_code_c27c7cbd42174f5e9fa7974b4680b822-6"></a><span class="sd">    Returns:</span>
<a id="rest_code_c27c7cbd42174f5e9fa7974b4680b822-7" name="rest_code_c27c7cbd42174f5e9fa7974b4680b822-7"></a><span class="sd">     float: reward</span>
<a id="rest_code_c27c7cbd42174f5e9fa7974b4680b822-8" name="rest_code_c27c7cbd42174f5e9fa7974b4680b822-8"></a><span class="sd">    """</span>
<a id="rest_code_c27c7cbd42174f5e9fa7974b4680b822-9" name="rest_code_c27c7cbd42174f5e9fa7974b4680b822-9"></a>    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
</pre></section><section id="update"><h3>1.8 Update</h3>
<p>The update method pulls the arm whose index it is given and then updates the count and reward. Here we're calling the <code class="docutils literal">pull_arm</code> method instead of using a <code class="docutils literal">BernoulliArm</code> so we can't re-use the original method.</p>
<pre class="code python"><a id="rest_code_d63429c056ca4a82bef2cf5adab38f77-1" name="rest_code_d63429c056ca4a82bef2cf5adab38f77-1"></a><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">):</span>
<a id="rest_code_d63429c056ca4a82bef2cf5adab38f77-2" name="rest_code_d63429c056ca4a82bef2cf5adab38f77-2"></a>    <span class="sd">"""pulls the arm and updates the value</span>
<a id="rest_code_d63429c056ca4a82bef2cf5adab38f77-3" name="rest_code_d63429c056ca4a82bef2cf5adab38f77-3"></a>
<a id="rest_code_d63429c056ca4a82bef2cf5adab38f77-4" name="rest_code_d63429c056ca4a82bef2cf5adab38f77-4"></a><span class="sd">    Args:</span>
<a id="rest_code_d63429c056ca4a82bef2cf5adab38f77-5" name="rest_code_d63429c056ca4a82bef2cf5adab38f77-5"></a><span class="sd">     arm (int): index of the arm to pull</span>
<a id="rest_code_d63429c056ca4a82bef2cf5adab38f77-6" name="rest_code_d63429c056ca4a82bef2cf5adab38f77-6"></a><span class="sd">    """</span>
<a id="rest_code_d63429c056ca4a82bef2cf5adab38f77-7" name="rest_code_d63429c056ca4a82bef2cf5adab38f77-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="rest_code_d63429c056ca4a82bef2cf5adab38f77-8" name="rest_code_d63429c056ca4a82bef2cf5adab38f77-8"></a>    <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
<a id="rest_code_d63429c056ca4a82bef2cf5adab38f77-9" name="rest_code_d63429c056ca4a82bef2cf5adab38f77-9"></a>    <span class="n">average_reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
<a id="rest_code_d63429c056ca4a82bef2cf5adab38f77-10" name="rest_code_d63429c056ca4a82bef2cf5adab38f77-10"></a>    <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_arm</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
<a id="rest_code_d63429c056ca4a82bef2cf5adab38f77-11" name="rest_code_d63429c056ca4a82bef2cf5adab38f77-11"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">+=</span> <span class="n">reward</span>
<a id="rest_code_d63429c056ca4a82bef2cf5adab38f77-12" name="rest_code_d63429c056ca4a82bef2cf5adab38f77-12"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">))</span> <span class="o">*</span> <span class="n">average_reward</span>
<a id="rest_code_d63429c056ca4a82bef2cf5adab38f77-13" name="rest_code_d63429c056ca4a82bef2cf5adab38f77-13"></a>                        <span class="o">+</span> <span class="p">(</span><span class="n">reward</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">)))</span>
<a id="rest_code_d63429c056ca4a82bef2cf5adab38f77-14" name="rest_code_d63429c056ca4a82bef2cf5adab38f77-14"></a>    <span class="k">return</span>
</pre></section></section>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/Optimistic-Initial-Values/" class="u-url">Optimistic Initial Values</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/brunhilde/">Brunhilde</a>
            </span></p>
            <p class="dateline">
            <a href="posts/Optimistic-Initial-Values/" rel="bookmark">
            <time class="published dt-published" datetime="2017-08-01T18:47:00-07:00" itemprop="datePublished" title="2017-08-01 18:47">2017-08-01 18:47</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<section id="introduction"><h2>1 Introduction</h2>
<p>This is one possible to the n-armed bandit problem. It is similar to the <em>Epsilon Greedy</em> algorithm except that instead of using a conditional to decide whether to explore or exploit, the algorithm sets the estimated (mean) payout for each arm to 1 (the theoretical maximum for our case) and then always exploits. As things proceed, the arms will settle down to their actual payoff-rates and those that haven't been explored will be chosen because they are still too high.</p>
</section><section id="the-tangle"><h2>2 The Tangle</h2>
<p>This is the no-web template to build the final file.</p>
<pre class="code python"><a id="rest_code_f33bc97a0cae4da8ac677783e9174c9f-1" name="rest_code_f33bc97a0cae4da8ac677783e9174c9f-1"></a><span class="o">&lt;&lt;</span><span class="n">imports</span><span class="o">&gt;&gt;</span>
<a id="rest_code_f33bc97a0cae4da8ac677783e9174c9f-2" name="rest_code_f33bc97a0cae4da8ac677783e9174c9f-2"></a>
<a id="rest_code_f33bc97a0cae4da8ac677783e9174c9f-3" name="rest_code_f33bc97a0cae4da8ac677783e9174c9f-3"></a><span class="o">&lt;&lt;</span><span class="n">spec</span><span class="o">&gt;&gt;</span>
<a id="rest_code_f33bc97a0cae4da8ac677783e9174c9f-4" name="rest_code_f33bc97a0cae4da8ac677783e9174c9f-4"></a>
<a id="rest_code_f33bc97a0cae4da8ac677783e9174c9f-5" name="rest_code_f33bc97a0cae4da8ac677783e9174c9f-5"></a><span class="o">&lt;&lt;</span><span class="n">class</span><span class="o">-</span><span class="n">declaration</span><span class="o">&gt;&gt;</span>
<a id="rest_code_f33bc97a0cae4da8ac677783e9174c9f-6" name="rest_code_f33bc97a0cae4da8ac677783e9174c9f-6"></a>
<a id="rest_code_f33bc97a0cae4da8ac677783e9174c9f-7" name="rest_code_f33bc97a0cae4da8ac677783e9174c9f-7"></a>    <span class="o">&lt;&lt;</span><span class="n">constructor</span><span class="o">&gt;&gt;</span>
<a id="rest_code_f33bc97a0cae4da8ac677783e9174c9f-8" name="rest_code_f33bc97a0cae4da8ac677783e9174c9f-8"></a>
<a id="rest_code_f33bc97a0cae4da8ac677783e9174c9f-9" name="rest_code_f33bc97a0cae4da8ac677783e9174c9f-9"></a>    <span class="o">&lt;&lt;</span><span class="n">select</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a id="rest_code_f33bc97a0cae4da8ac677783e9174c9f-10" name="rest_code_f33bc97a0cae4da8ac677783e9174c9f-10"></a>
<a id="rest_code_f33bc97a0cae4da8ac677783e9174c9f-11" name="rest_code_f33bc97a0cae4da8ac677783e9174c9f-11"></a>    <span class="o">&lt;&lt;</span><span class="n">pull</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a id="rest_code_f33bc97a0cae4da8ac677783e9174c9f-12" name="rest_code_f33bc97a0cae4da8ac677783e9174c9f-12"></a>
<a id="rest_code_f33bc97a0cae4da8ac677783e9174c9f-13" name="rest_code_f33bc97a0cae4da8ac677783e9174c9f-13"></a>    <span class="o">&lt;&lt;</span><span class="n">update</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a id="rest_code_f33bc97a0cae4da8ac677783e9174c9f-14" name="rest_code_f33bc97a0cae4da8ac677783e9174c9f-14"></a>
<a id="rest_code_f33bc97a0cae4da8ac677783e9174c9f-15" name="rest_code_f33bc97a0cae4da8ac677783e9174c9f-15"></a>    <span class="o">&lt;&lt;</span><span class="n">reset</span><span class="o">&gt;&gt;</span>
</pre></section><section id="imports"><h2>3 Imports</h2>
<p>These are our external dependencies.</p>
<pre class="code python"><a id="rest_code_b108e5fc89504addbe32fd80f97dc73a-1" name="rest_code_b108e5fc89504addbe32fd80f97dc73a-1"></a><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jitclass</span>
<a id="rest_code_b108e5fc89504addbe32fd80f97dc73a-2" name="rest_code_b108e5fc89504addbe32fd80f97dc73a-2"></a><span class="kn">import</span> <span class="nn">numba</span>
<a id="rest_code_b108e5fc89504addbe32fd80f97dc73a-3" name="rest_code_b108e5fc89504addbe32fd80f97dc73a-3"></a><span class="kn">import</span> <span class="nn">numpy</span>
</pre></section><section id="the-spec"><h2>4 The Spec</h2>
<p>In order to use numba with the <code class="docutils literal">OptimisticInitialValues</code> class you have to create a 'spec' that tells numba what the data-types are for each of its fields.</p>
<pre class="code python"><a id="rest_code_ae9a87a28cb7425ebfdb7ca95608eac6-1" name="rest_code_ae9a87a28cb7425ebfdb7ca95608eac6-1"></a><span class="n">SPEC</span> <span class="o">=</span> <span class="p">[</span>
<a id="rest_code_ae9a87a28cb7425ebfdb7ca95608eac6-2" name="rest_code_ae9a87a28cb7425ebfdb7ca95608eac6-2"></a>    <span class="p">(</span><span class="s2">"arms"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a id="rest_code_ae9a87a28cb7425ebfdb7ca95608eac6-3" name="rest_code_ae9a87a28cb7425ebfdb7ca95608eac6-3"></a>    <span class="p">(</span><span class="s2">"counts"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a id="rest_code_ae9a87a28cb7425ebfdb7ca95608eac6-4" name="rest_code_ae9a87a28cb7425ebfdb7ca95608eac6-4"></a>    <span class="p">(</span><span class="s2">"rewards"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a id="rest_code_ae9a87a28cb7425ebfdb7ca95608eac6-5" name="rest_code_ae9a87a28cb7425ebfdb7ca95608eac6-5"></a>    <span class="p">(</span><span class="s2">"total_reward"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
<a id="rest_code_ae9a87a28cb7425ebfdb7ca95608eac6-6" name="rest_code_ae9a87a28cb7425ebfdb7ca95608eac6-6"></a>    <span class="p">(</span><span class="s2">"initial_reward"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">),</span>
<a id="rest_code_ae9a87a28cb7425ebfdb7ca95608eac6-7" name="rest_code_ae9a87a28cb7425ebfdb7ca95608eac6-7"></a><span class="p">]</span>
</pre></section><section id="the-class-declaration"><h2>5 The Class Declaration</h2>
<pre class="code python"><a id="rest_code_e4dd2e7aa0bb48c680f8e6a4dc2abc6d-1" name="rest_code_e4dd2e7aa0bb48c680f8e6a4dc2abc6d-1"></a><span class="nd">@jitclass</span><span class="p">(</span><span class="n">SPEC</span><span class="p">)</span>
<a id="rest_code_e4dd2e7aa0bb48c680f8e6a4dc2abc6d-2" name="rest_code_e4dd2e7aa0bb48c680f8e6a4dc2abc6d-2"></a><span class="k">class</span> <span class="nc">OptimisticInitialValues</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="rest_code_e4dd2e7aa0bb48c680f8e6a4dc2abc6d-3" name="rest_code_e4dd2e7aa0bb48c680f8e6a4dc2abc6d-3"></a>    <span class="sd">"""Optimistic Initial Values greedy algorithm</span>
<a id="rest_code_e4dd2e7aa0bb48c680f8e6a4dc2abc6d-4" name="rest_code_e4dd2e7aa0bb48c680f8e6a4dc2abc6d-4"></a>
<a id="rest_code_e4dd2e7aa0bb48c680f8e6a4dc2abc6d-5" name="rest_code_e4dd2e7aa0bb48c680f8e6a4dc2abc6d-5"></a><span class="sd">    Args:</span>
<a id="rest_code_e4dd2e7aa0bb48c680f8e6a4dc2abc6d-6" name="rest_code_e4dd2e7aa0bb48c680f8e6a4dc2abc6d-6"></a><span class="sd">     numpy.array[float]: payout-probabilities for each arm</span>
<a id="rest_code_e4dd2e7aa0bb48c680f8e6a4dc2abc6d-7" name="rest_code_e4dd2e7aa0bb48c680f8e6a4dc2abc6d-7"></a><span class="sd">    """</span>
</pre></section><section id="the-constructor"><h2>6 The Constructor</h2>
<p>Here's our first change from the epsilon-greedy algorithm. We no longer have an <code class="docutils literal">epsilon</code> value and instead of initializing the <code class="docutils literal">rewards</code> as zeros we initialize them with an 'initial' reward. Also, although you can't see it here, the arms have to be a list of mean payout values (see the <code class="docutils literal">pull_arm</code> method below).</p>
<pre class="code python"><a id="rest_code_ce595577468542b38b9d910247910ece-1" name="rest_code_ce595577468542b38b9d910247910ece-1"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arms</span><span class="p">,</span> <span class="n">initial_reward</span><span class="p">):</span>
<a id="rest_code_ce595577468542b38b9d910247910ece-2" name="rest_code_ce595577468542b38b9d910247910ece-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="n">arms</span>
<a id="rest_code_ce595577468542b38b9d910247910ece-3" name="rest_code_ce595577468542b38b9d910247910ece-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arms</span><span class="p">))</span>
<a id="rest_code_ce595577468542b38b9d910247910ece-4" name="rest_code_ce595577468542b38b9d910247910ece-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arms</span><span class="p">))</span> <span class="o">+</span> <span class="n">initial_reward</span>
<a id="rest_code_ce595577468542b38b9d910247910ece-5" name="rest_code_ce595577468542b38b9d910247910ece-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
<a id="rest_code_ce595577468542b38b9d910247910ece-6" name="rest_code_ce595577468542b38b9d910247910ece-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">initial_reward</span> <span class="o">=</span> <span class="n">initial_reward</span>
<a id="rest_code_ce595577468542b38b9d910247910ece-7" name="rest_code_ce595577468542b38b9d910247910ece-7"></a>    <span class="k">return</span>
</pre></section><section id="select-arm"><h2>7 Select Arm</h2>
<p>This chooses the next arm. Unlike the epsilon-greedy algorithm it will always pick the 'best' arm, choosing the first if there is a tie. Since the whole class is in the jit I'm also not using the external <code class="docutils literal">find_first</code> method.</p>
<pre class="code python"><a id="rest_code_3430137df6a847e082d7d823c0713f26-1" name="rest_code_3430137df6a847e082d7d823c0713f26-1"></a><span class="k">def</span> <span class="nf">select_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="rest_code_3430137df6a847e082d7d823c0713f26-2" name="rest_code_3430137df6a847e082d7d823c0713f26-2"></a>    <span class="sd">"""Index of the arm with the most reward</span>
<a id="rest_code_3430137df6a847e082d7d823c0713f26-3" name="rest_code_3430137df6a847e082d7d823c0713f26-3"></a>
<a id="rest_code_3430137df6a847e082d7d823c0713f26-4" name="rest_code_3430137df6a847e082d7d823c0713f26-4"></a><span class="sd">    Returns:</span>
<a id="rest_code_3430137df6a847e082d7d823c0713f26-5" name="rest_code_3430137df6a847e082d7d823c0713f26-5"></a><span class="sd">     integer: index of arm with highest average reward</span>
<a id="rest_code_3430137df6a847e082d7d823c0713f26-6" name="rest_code_3430137df6a847e082d7d823c0713f26-6"></a><span class="sd">    """</span>
<a id="rest_code_3430137df6a847e082d7d823c0713f26-7" name="rest_code_3430137df6a847e082d7d823c0713f26-7"></a>    <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<a id="rest_code_3430137df6a847e082d7d823c0713f26-8" name="rest_code_3430137df6a847e082d7d823c0713f26-8"></a>    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">)):</span>
<a id="rest_code_3430137df6a847e082d7d823c0713f26-9" name="rest_code_3430137df6a847e082d7d823c0713f26-9"></a>        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
<a id="rest_code_3430137df6a847e082d7d823c0713f26-10" name="rest_code_3430137df6a847e082d7d823c0713f26-10"></a>            <span class="k">return</span> <span class="n">index</span>
</pre></section><section id="pull-arm"><h2>8 Pull Arm</h2>
<p>This gets the reward for the arm. with a Bernoulli arm, there's a chance that an arm will be set to 0 on its first pull, at which point you will never explore it (since there's no exploration), so even the best arm might get wiped out. To fix this you need a different scheme. This one uses a population mean (selected <code class="docutils literal">from self.arms</code>) which has noise added by selecting from the standard normal distribution.</p>
<pre class="code python"><a id="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-1" name="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-1"></a><span class="k">def</span> <span class="nf">pull_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">):</span>
<a id="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-2" name="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-2"></a>    <span class="sd">"""gets the reward</span>
<a id="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-3" name="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-3"></a>
<a id="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-4" name="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-4"></a><span class="sd">    Args:</span>
<a id="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-5" name="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-5"></a><span class="sd">     arm (int): index for the arm population-mean array</span>
<a id="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-6" name="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-6"></a><span class="sd">    Returns:</span>
<a id="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-7" name="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-7"></a><span class="sd">     float: payout for the arm</span>
<a id="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-8" name="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-8"></a><span class="sd">    """</span>
<a id="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-9" name="rest_code_82cd3f89623c4c8d81fe6725cc9b53df-9"></a>    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
</pre></section><section id="update-arm"><h2>9 Update Arm</h2>
<p>This pulls the arm and updates the reward. This works the same as the <code class="docutils literal"><span class="pre">epsilon-greedy</span></code> version does.</p>
<pre class="code python"><a id="rest_code_edb0e045250248a59da8175eaa464895-1" name="rest_code_edb0e045250248a59da8175eaa464895-1"></a><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">):</span>
<a id="rest_code_edb0e045250248a59da8175eaa464895-2" name="rest_code_edb0e045250248a59da8175eaa464895-2"></a>    <span class="sd">"""pulls the arm and updates the average reward</span>
<a id="rest_code_edb0e045250248a59da8175eaa464895-3" name="rest_code_edb0e045250248a59da8175eaa464895-3"></a>
<a id="rest_code_edb0e045250248a59da8175eaa464895-4" name="rest_code_edb0e045250248a59da8175eaa464895-4"></a><span class="sd">    also updates the total_reward the algorithm has earned so far</span>
<a id="rest_code_edb0e045250248a59da8175eaa464895-5" name="rest_code_edb0e045250248a59da8175eaa464895-5"></a>
<a id="rest_code_edb0e045250248a59da8175eaa464895-6" name="rest_code_edb0e045250248a59da8175eaa464895-6"></a><span class="sd">    Args:</span>
<a id="rest_code_edb0e045250248a59da8175eaa464895-7" name="rest_code_edb0e045250248a59da8175eaa464895-7"></a><span class="sd">     arm (int): index of the arm to pull</span>
<a id="rest_code_edb0e045250248a59da8175eaa464895-8" name="rest_code_edb0e045250248a59da8175eaa464895-8"></a><span class="sd">    """</span>
<a id="rest_code_edb0e045250248a59da8175eaa464895-9" name="rest_code_edb0e045250248a59da8175eaa464895-9"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="rest_code_edb0e045250248a59da8175eaa464895-10" name="rest_code_edb0e045250248a59da8175eaa464895-10"></a>    <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
<a id="rest_code_edb0e045250248a59da8175eaa464895-11" name="rest_code_edb0e045250248a59da8175eaa464895-11"></a>    <span class="n">average_reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
<a id="rest_code_edb0e045250248a59da8175eaa464895-12" name="rest_code_edb0e045250248a59da8175eaa464895-12"></a>    <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_arm</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
<a id="rest_code_edb0e045250248a59da8175eaa464895-13" name="rest_code_edb0e045250248a59da8175eaa464895-13"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">+=</span> <span class="n">reward</span>
<a id="rest_code_edb0e045250248a59da8175eaa464895-14" name="rest_code_edb0e045250248a59da8175eaa464895-14"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">))</span> <span class="o">*</span> <span class="n">average_reward</span>
<a id="rest_code_edb0e045250248a59da8175eaa464895-15" name="rest_code_edb0e045250248a59da8175eaa464895-15"></a>                         <span class="o">+</span> <span class="p">(</span><span class="n">reward</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">)))</span>
<a id="rest_code_edb0e045250248a59da8175eaa464895-16" name="rest_code_edb0e045250248a59da8175eaa464895-16"></a>    <span class="k">return</span>
</pre></section><section id="reset"><h2>10 Reset</h2>
<p>This resets the values so that you can re-use the algorithm. As with the constructor, it sets the <code class="docutils literal">rewards</code> to all ones instead of zeros as was the case with the epsilon-greedy algorithm.</p>
<pre class="code python"><a id="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-1" name="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-1"></a><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-2" name="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-2"></a>    <span class="sd">"""sets the counts, rewards, total_reward to 0s</span>
<a id="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-3" name="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-3"></a>
<a id="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-4" name="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-4"></a><span class="sd">    This lets you re-used the EpsilonGreedy</span>
<a id="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-5" name="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-5"></a><span class="sd">    """</span>
<a id="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-6" name="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
<a id="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-7" name="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_reward</span>
<a id="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-8" name="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-8"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
<a id="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-9" name="rest_code_dd4f26630ef145d4a8fa43a2217d41eb-9"></a>    <span class="k">return</span>
</pre></section>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/assessing-the-performance/" class="u-url">Assessing the Performance</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/hades/">hades</a>
            </span></p>
            <p class="dateline">
            <a href="posts/assessing-the-performance/" rel="bookmark">
            <time class="published dt-published" datetime="2017-08-01T18:46:00-07:00" itemprop="datePublished" title="2017-08-01 18:46">2017-08-01 18:46</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<section id="introduction"><h2>1 Introduction</h2>
<p>As with the Epsilon-Greedy algorithm I'm going to use the Cumulative Reward as the metric. In this case we don't really have a parameter to tune.</p>
</section><section id="imports"><h2>2 Imports</h2>
<p>The dependencies.</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 13)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    # python standard library
    from datetime import datetime

    # pypi
    from numba import jit
    import numpy
    import pandas
    import matplotlib.pyplot as plot
    import seaborn

    # this project
    from optimistic_initial_values import OptimisticInitialValues
    from epsilon_greedy_normal import EpsilonGreedyNormal
</pre>
</div>
</section><section id="set-up-the-plotting"><h2>3 Set-up the Plotting</h2>
<p>This will enable the plotting and set the style.</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 34)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    %matplotlib inline
    seaborn.set_style("whitegrid")
</pre>
</div>
</section><section id="running-the-assessment"><h2>4 Running the Assessment</h2>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 42)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    @jit
    def cumulative_reward(agent, times=5000, trials=400):
        """this generates the cumulative reward as the agent pulls the arms

        Args:
         agent: implementation that selects and updates the arms
         trials (int): number of times to train the agent
         times (int): length of time to train the agent
        Returns:
         numpy.array: average cumulative rewards over time
        """
        cumulative_rewards = numpy.zeros(times)
        for trial in range(trials):
            for time in range(times):
                arm = agent.select_arm()
                agent.update(arm)
                cumulative_rewards[time] += agent.total_reward
            agent.reset()
        return cumulative_rewards/trials
</pre>
</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 64)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    def plot_cumulative(cumulative):
        """generates and plots cumulative average

        Args:
         cumulative (pandas.DataFrame): data to plot
        """
        figure = plot.figure(figsize=(10, 6))
        axe = figure.gca()
        axe.set_title("Cumulative Reward of the Optimistic Initial Values Algorithm ({} trials)".format(TRIALS))
        axe.set_xlabel("Time (number of pulls on the arm)")
        axe.set_ylabel("Cumulative Reward")
        cumulative.plot(ax=axe)
        return
</pre>
</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 80)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    TRIALS = 5000
    TIMES = 400
    similar_payout_rates = numpy.arange(1.0, 6.0)
    numpy.random.shuffle(similar_payout_rates)
    one_good_arm_rates = numpy.array([1.0] * 10 + [9.0])
    numpy.random.shuffle(one_good_arm_rates)
</pre>
</div>
<section id="similar-arms"><h3>4.1 Similar Arms</h3>
<p>This will create a range where each arm only differs by 0.1</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 94)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    optimistic_agent = OptimisticInitialValues(similar_payout_rates, 10.0)
    data = {}
    data["Optimistic Initial Values"] = cumulative_reward(optimistic_agent, trials=TRIALS, times=TIMES)
    epsilon_agent = EpsilonGreedyNormal(0.1, similar_payout_rates)
    data["Epsilon Greedy (0.1)"] = cumulative_reward(epsilon_agent, trials=TRIALS, times=TIMES)
    data = pandas.DataFrame.from_dict(data)
    plot_cumulative(data)
</pre>
</div>
<img alt="optimistic_similar_cumulative.png" src="posts/assessing-the-performance/optimistic_similar_cumulative.png"><p>The Optimistic Initial Values agent does better than the Epsilon Greedy, as you would expect (since it eventually stops exploring). But it looks suspisciously linear.</p>
</section><section id="one-good-arm"><h3>4.2 One Good Arm</h3>
<p>Lets see how it goes when one arm dominates the payouts.</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 113)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    numpy.random.shuffle(one_good_arm_rates)
    optimistic_agent = OptimisticInitialValues(one_good_arm_rates, 10.)
    data = {}
    data["Optimistic Initial Values"] = cumulative_reward(optimistic_agent, trials=TRIALS, times=TIMES)
    epsilon_agent = EpsilonGreedyNormal(0.1, one_good_arm_rates)
    data["Epsilon Greedy (0.1)"] = cumulative_reward(epsilon_agent, trials=TRIALS, times=TIMES)
    data = pandas.DataFrame.from_dict(data)
    plot_cumulative(data)
</pre>
</div>
<img alt="optimistic_cumulative_one_good_arm.png" src="posts/assessing-the-performance/optimistic_cumulative_one_good_arm.png"><p>It looks like the optimistic agent does even better with one dominant arm. Likely because it found it quick enough that always exploiting it gives it a huge advantage over the epsilon greedy, which never stops exploring.</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 128)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    @jit
    def average_reward(agent, times=1000, trials=100):
        """this generates the average reward for the trials over time

        Args:
         trials (int): number of times to train the agent
         times (int): length of time to train the agent
        Returns:
         numpy.array: the average reward
        """
        average_rewards = numpy.zeros(times)
        for trial in range(trials):
            for time in range(times):
                arm = agent.select_arm()
                old_reward = agent.total_reward
                agent.update(arm)
                average_rewards[time] += (agent.total_reward - old_reward)
            agent.reset()
        return average_rewards/trials
</pre>
</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 150)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    data = {}
    data["Optimistic Initial Values"] = average_reward(optimistic_agent, TIMES, TRIALS)
    data["Epsilon 0.1"] = average_reward(epsilon_agent, TIMES, TRIALS)
</pre>
</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 156)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    averages = pandas.DataFrame.from_dict(data)
</pre>
</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 160)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    figure = plot.figure(figsize=(10, 6))
    axe = figure.gca()
    axe.set_title("Average Reward (One Dominant Arm)")
    axe.set_xlabel("Time (number of pulls on the arm)")
    axe.set_ylabel("Average Reward")
    averages.plot(ax=axe, marker='.', linestyle="None")
</pre>
</div>
<img alt="optimistic_averages.png" src="posts/assessing-the-performance/optimistic_averages.png"><p>It looks like there was a brief period where the Epsilon Greedy did better, but the Optimistic agent settled in fairly quickly.</p>
</section></section>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/finding-the-best-epsilon/" class="u-url">Finding the Best Epsilon</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/hades/">hades</a>
            </span></p>
            <p class="dateline">
            <a href="posts/finding-the-best-epsilon/" rel="bookmark">
            <time class="published dt-published" datetime="2017-07-30T18:41:00-07:00" itemprop="datePublished" title="2017-07-30 18:41">2017-07-30 18:41</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="posts/finding-the-best-epsilon/#introduction" id="id1">1 Introduction</a></p></li>
<li><p><a class="reference internal" href="posts/finding-the-best-epsilon/#imports" id="id2">2 Imports</a></p></li>
<li><p><a class="reference internal" href="posts/finding-the-best-epsilon/#set-up-the-plotting" id="id3">3 Set-up the Plotting</a></p></li>
<li>
<p><a class="reference internal" href="posts/finding-the-best-epsilon/#the-probabilities" id="id4">4 The Probabilities</a></p>
<ul>
<li><p><a class="reference internal" href="posts/finding-the-best-epsilon/#generate-the-probabilities" id="id5">4.1 Generate the Probabilities</a></p></li>
<li><p><a class="reference internal" href="posts/finding-the-best-epsilon/#inspecting-the-outcome" id="id6">4.2 Inspecting the Outcome</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="posts/finding-the-best-epsilon/#average-reward" id="id7">5 Average Reward</a></p></li>
<li>
<p><a class="reference internal" href="posts/finding-the-best-epsilon/#cumulative-reward" id="id8">6 Cumulative Reward</a></p>
<ul>
<li><p><a class="reference internal" href="posts/finding-the-best-epsilon/#imbalanced-case" id="id9">6.1 Imbalanced Case</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="introduction"><h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id1">1 Introduction</a></h2>
<p>This is one of the ways to characterize the performance of the <em>Epsilon Greedy</em> agent using our <em>Bernoulli Arm</em>. We are going to look at three ways to evaluate how well the algorithm does.</p>
<ul class="simple">
<li><p>probability of using the best arm</p></li>
<li><p>average reward</p></li>
<li><p>cumulative reward</p></li>
</ul></section><section id="imports"><h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id2">2 Imports</a></h2>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 19)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    # python standard library
    import random
    from datetime import datetime

    # pypi
    from numba import jit
    import numpy
    import pandas
    import matplotlib.pyplot as plot
    import seaborn

    # this project
    from epsilon_greedy import (
        EpsilonGreedy,
        find_first
    )
    from epsilon_greedy_optimized import EpsilonGreedyOptimized
    from bernoulli_arm import BernoulliArm
</pre>
</div>
</section><section id="set-up-the-plotting"><h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id3">3 Set-up the Plotting</a></h2>
<p>This will enable the plotting and set the style.</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 45)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    %matplotlib inline
    seaborn.set_style("whitegrid")
</pre>
</div>
</section><section id="the-probabilities"><h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id4">4 The Probabilities</a></h2>
<section id="generate-the-probabilities"><h3><a class="toc-backref" href="posts/finding-the-best-epsilon/#id5">4.1 Generate the Probabilities</a></h3>
<p>This code will run generate the probabilities. Although I made it so that using the <code class="docutils literal">EpsilonGreedy</code> call method would both choose the arm and update the reward, in this case we need to know which arm was selected so I'm going to do the steps individually.</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 58)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    def generate_probabilities(times=1000, trials=100):
        """this generates the probabilites for finding the best arm

        Args:
         trials (int): number of times to train the agent
         times (int): length of time to train the agent
        Returns:
         Dict: the probabilites for each epsilon over time
         """
        arm_probabilities = [0.1, 0.1, 0.1, 0.9, 0.1]
        random.shuffle(arm_probabilities)
        best_arm = arm_probabilities.index(max(arm_probabilities))
        arms = [BernoulliArm(probability) for probability in arm_probabilities]
        epsilons = numpy.array([0.05, 0.1, 0.2, 0.3, 0.4, 0.5])

        outcomes = {}
        for epsilon in epsilons:
            agent = EpsilonGreedy(epsilon, arms)
            probabilities = numpy.zeros(times)
            for trial in range(trials):
                for time in range(times):
                    arm = agent.select_arm()
                    agent.update(arm)
                    if arm == best_arm:
                        probabilities[time] += 1
                agent.reset()
            outcomes["Epsilon {:.02f}".format(epsilon)] = probabilities/times
        return outcomes
</pre>
</div>
</section><section id="inspecting-the-outcome"><h3><a class="toc-backref" href="posts/finding-the-best-epsilon/#id6">4.2 Inspecting the Outcome</a></h3>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 92)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    TRIALS = 5000
    TIMES = 400
</pre>
</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 97)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    start = datetime.now()
    probabilities = generate_probabilities(trials=TRIALS, times=TIMES)
    print("Run Time: {0}".format(datetime.now() - start))
    probabilities = pandas.DataFrame.from_dict(probabilities)
    probabilities.describe()
</pre>
</div>
<pre class="literal-block">       Epsilon 0.05  Epsilon 0.10  Epsilon 0.20  Epsilon 0.30  Epsilon 0.40  \
count    400.000000    400.000000    400.000000    400.000000    400.000000
mean       8.784956      9.971200      9.801344      9.084844      8.235194
std        3.064916      2.523568      1.775677      1.319447      0.998305
min        0.120000      0.275000      0.495000      0.757500      1.050000
25%        7.141875      9.740000     10.264375      9.390000      8.409375
50%        9.937500     11.187500     10.456250      9.475000      8.480000
75%       11.225000     11.457500     10.515000      9.530625      8.545000
max       11.720000     11.605000     10.727500      9.665000      8.712500

       Epsilon 0.50
count    400.000000
mean       7.310087
std        0.763259
min        1.190000
25%        7.406875
50%        7.473750
75%        7.535625
max        7.725000</pre>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 127)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    probabilities.to_csv("epsilon_greedy_accuracy.csv")
</pre>
</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 131)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    figure = plot.figure(figsize=(10, 6))
    axe = figure.gca()
    axe.set_title("Accuracy of the Epsilon Greedy Algorithm ({} trials)".format(TRIALS))
    axe.set_xlabel("Time (number of pulls on the arm)")
    axe.set_ylabel("Probability of retrieving the best arm")
    probabilities.plot(ax=axe)
</pre>
</div>
<img alt="epsilon_greedy_probablilities.png" src="posts/finding-the-best-epsilon/epsilon_greedy_probablilities.png"><p>Looking at the plots, it appears that the epsilons greater than 0.05 converge faster that 0.05 (their curves are steeper at the beginning), as you would expect, but they also don't do as well in the long run, as you might also expect, since they're doing more exploration. In the long run, the more exploitation, the better the profit, but I suppose it depends on the window you have to work with, if you have a short one, then the more aggresive explorers might be better. Anything less than 350 would do better with 0.1 rather than 0.05, for instance.</p>
</section></section><section id="average-reward"><h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id7">5 Average Reward</a></h2>
<p>One of the things to note about the previous trials is that there was one arm that did notably better than all the others. When they are more uniform using the probability of retrieving the best arm might not be as revealing. Instead, using the average reward so far would give us more information.</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 149)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    @jit
    def average_reward(times=1000, trials=100):
        """this generates the probabilites for finding the best arm

        Args:
         trials (int): number of times to train the agent
         times (int): length of time to train the agent
        Returns:
         Dict: the probabilites for each epsilon over time
        """
        arm_probabilities = numpy.array([0.1, 0.2, 0.3, 0.4, 0.5])
        random.shuffle(arm_probabilities)
        # arms = [BernoulliArm(probability) for probability in arm_probabilities]
        epsilons = numpy.array([0.1, 0.2, 0.3, 0.4, 0.5])

        outcomes = {}
        for epsilon in epsilons:
            agent = EpsilonGreedyOptimized(epsilon, arm_probabilities)
            average_rewards = numpy.zeros(times)
            for trial in range(trials):
                for time in range(times):
                    arm = agent.select_arm()
                    old_reward = agent.total_reward
                    agent.update(arm)
                    average_rewards[time] += (agent.total_reward - old_reward)
                agent.reset()
            outcomes["Epsilon {0:.02f}".format(epsilon)] = average_rewards/trials
        return outcomes
</pre>
</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 180)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    start = datetime.now()
    averages = average_reward(TIMES, TRIALS)
    print("Run Time: {0}".format(datetime.now() - start))
    averages = pandas.DataFrame.from_dict(averages)
</pre>
</div>
<pre class="literal-block">Run Time: 0:01:08.727723</pre>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 191)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    figure = plot.figure(figsize=(10, 6))
    axe = figure.gca()
    axe.set_title("Reward of the Epsilon Greedy Algorithm ({} trials)".format(TRIALS))
    axe.set_xlabel("Time (number of pulls on the arm)")
    axe.set_ylabel("Average Reward")
    averages.plot(ax=axe, marker='.', linestyle="None")
</pre>
</div>
<img alt="epsilon_averages.png" src="posts/finding-the-best-epsilon/epsilon_averages.png"><p>There's much more variablity and overlap here, as you might expect since I made the probabilities closer. Interestingly, the strongly exploratory agents seem to do worse, even from the beginning, while the more exploitative ones do better.  Although it looks like 0.2 might be doing as well or better than 0.1 once you get over 100.</p>
</section><section id="cumulative-reward"><h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id8">6 Cumulative Reward</a></h2>
<p>The previous two metrics turn out to be useful, but somewhat unfair to the aggresively exploring models, which we know won't ultimately do as well, but do have an advantage in the initial phase. To better qualify the overall effect of exploration versus exploitation, it's better to use a cumulative sum of the rewards.</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 209)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    @jit
    def cumulative_reward(arms, times=1000, trials=100):
        """this generates the cumulative reward as the agent pulls the arms

        Args:
         arms (numpy.array): array of probabilities that the arm will pay-off
         trials (int): number of times to train the agent
         times (int): length of time to train the agent
        Returns:
         Dict: the probabilites for each epsilon over time
        """
        random.shuffle(arms)
        epsilons = numpy.array([0.1, 0.2, 0.3, 0.4, 0.5])

        outcomes = {}
        for epsilon in epsilons:
            agent = EpsilonGreedyOptimized(epsilon, arms)
            cumulative_rewards = numpy.zeros(times)
            for trial in range(trials):
                for time in range(times):
                    arm = agent.select_arm()
                    agent.update(arm)
                    cumulative_rewards[time] = agent.total_reward
                agent.reset()
            outcomes["Epsilon {:.02f}".format(epsilon)] = cumulative_rewards/trials
        return outcomes
</pre>
</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 238)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    def generate_cumulative(arms):
        """runs the cumulative output function

        Args:
         arms (numpy.array): probabilities that arms will pay out

        Returns:
         pandas.DataFrame: the average cumulative rewards
        """
        start = datetime.now()
        cumulative = cumulative_reward(arms, times=TIMES, trials=TRIALS)
        print("Run Time: {0}".format(datetime.now() - start))
        return pandas.DataFrame.from_dict(cumulative)
</pre>
</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 254)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    def plot_cumulative(cumulative):
        """generates and plots cumulative average

        Args:
         cumulative (pandas.DataFrame): data to plot
        """
        figure = plot.figure(figsize=(10, 6))
        axe = figure.gca()
        axe.set_title("Cumulative Reward of the Epsilon Greedy Algorithm ({} trials)".format(TRIALS))
        axe.set_xlabel("Time (number of pulls on the arm)")
        axe.set_ylabel("Cumulative Reward")
        cumulative.plot(ax=axe)
        return
</pre>
</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 270)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    cumulative = generate_cumulative(numpy.arange(0.1, 0.6, 0.1))
    plot_cumulative(cumulative)
</pre>
</div>
<img alt="epsilon_greedy_cumulative.png" src="posts/finding-the-best-epsilon/epsilon_greedy_cumulative.png"><p>Because of the randomness this will change everytime you run it, but we can see that in this case, the average cumulative reward was better for the 0.3 and 0.5 epsilon values than the more conservative values up until around 275, and the second most conservative case (0.2) actually did worse on average than the more exploratory cases did.</p>
<section id="imbalanced-case"><h3><a class="toc-backref" href="posts/finding-the-best-epsilon/#id9">6.1 Imbalanced Case</a></h3>
<p>I'll re-run this again with more arms and a only one clear good arm to see if this changes things.</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 284)</p>
<p>Cannot find pygments lexer for language "ipython"</p>
<pre class="literal-block">.. code:: ipython

    plot_cumulative(generate_cumulative(numpy.array([0.1] * 10 + [0.9])))
</pre>
</div>
<img alt="epsilon_cumulative_2.png" src="posts/finding-the-best-epsilon/epsilon_cumulative_2.png"><p>In this case, the most exploitive agent did much worse than the other agents. It looks like it didn't find the best arm until around the 240th pull. In this case, when most arms pay off poorly and one arm pays off much better, the exploratory arms accumulate more reward within our time frame. I'm guessing that the 0.10 epsilon would, given enough time, pull ahead, and you can in fact see that the most exploratory agent has already been surpassed by the 0.2 agent, so eventually exploration would probably take a back seat to exploitation, but not in this case. It's important to note, however, that if the most exploitive agent had happened to find the best arm at the start, he would likely have ended up the best, it's just the nature of randomization that you aren't guaranteed that this would be the case.</p>
</section></section>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/A-Bernoulli-Arm/" class="u-url">A Bernoulli Arm</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/hades/">hades</a>
            </span></p>
            <p class="dateline">
            <a href="posts/A-Bernoulli-Arm/" rel="bookmark">
            <time class="published dt-published" datetime="2017-07-30T18:37:00-07:00" itemprop="datePublished" title="2017-07-30 18:37">2017-07-30 18:37</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<section id="introduction"><h2>1 Introduction</h2>
<p>This is an implementation of one arm of a <a class="reference external" href="https://en.wikipedia.org/wiki/Multi-armed_bandit">n-armed bandit</a> to test the Epsilon Greedy algorithm. It takes a probability that it will return a reward. It also optionally let's you set the penalty and reward values, but defaults to a reward of 1 and a penalty of 0 (so it's really no reward more than a penalty).</p>
</section><section id="imports"><h2>2 Imports</h2>
<pre class="code python"><a id="rest_code_59c23e93ff73428f8d6772e3a4df0317-1" name="rest_code_59c23e93ff73428f8d6772e3a4df0317-1"></a><span class="c1"># python standard library</span>
<a id="rest_code_59c23e93ff73428f8d6772e3a4df0317-2" name="rest_code_59c23e93ff73428f8d6772e3a4df0317-2"></a><span class="kn">import</span> <span class="nn">random</span>
</pre></section><section id="bernoulli-arm"><h2>3 Bernoulli Arm</h2>
<p>The Bernoulli Arm will generate a value when its arm is pulled at a payout rate specified by the `probability` value.</p>
<pre class="code python"><a id="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-1" name="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-1"></a><span class="o">&lt;&lt;</span><span class="n">imports</span><span class="o">&gt;&gt;</span>
<a id="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-2" name="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-2"></a>
<a id="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-3" name="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-3"></a><span class="k">class</span> <span class="nc">BernoulliArm</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-4" name="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-4"></a>    <span class="sd">"""A simulation of one arm of a multi-armed bandit</span>
<a id="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-5" name="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-5"></a>
<a id="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-6" name="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-6"></a><span class="sd">    Args:</span>
<a id="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-7" name="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-7"></a><span class="sd">     probability (float): probability of a reward</span>
<a id="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-8" name="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-8"></a><span class="sd">     reward (float): value to return on a win</span>
<a id="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-9" name="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-9"></a><span class="sd">     penalty (float): value to return on a loss</span>
<a id="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-10" name="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-10"></a><span class="sd">    """</span>
<a id="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-11" name="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-11"></a>    <span class="o">&lt;&lt;</span><span class="n">constructor</span><span class="o">&gt;&gt;</span>
<a id="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-12" name="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-12"></a>
<a id="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-13" name="rest_code_e364a3b548814ee2b708d2ccf0d4e03d-13"></a>    <span class="o">&lt;&lt;</span><span class="n">call</span><span class="o">&gt;&gt;</span>
</pre>
<section id="constructor"><h3>3.1 Constructor</h3>
<p>The constructor takes three values:</p>
<ul class="simple">
<li><p>probability of winning</p></li>
<li><p>reward on winning</p></li>
<li><p>penalty on losing</p></li>
</ul>
<p>Because of the way the problem is set up, the reward and penalty are already set at 1 and 0, but I didn't want there to be magic numbers so they can be changed if needed.</p>
<pre class="code python"><a id="rest_code_27d7828a65af493f9f91fb65915e59f3-1" name="rest_code_27d7828a65af493f9f91fb65915e59f3-1"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">probability</span><span class="p">,</span> <span class="n">reward</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="rest_code_27d7828a65af493f9f91fb65915e59f3-2" name="rest_code_27d7828a65af493f9f91fb65915e59f3-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">probability</span> <span class="o">=</span> <span class="n">probability</span>
<a id="rest_code_27d7828a65af493f9f91fb65915e59f3-3" name="rest_code_27d7828a65af493f9f91fb65915e59f3-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">reward</span> <span class="o">=</span> <span class="n">reward</span>
<a id="rest_code_27d7828a65af493f9f91fb65915e59f3-4" name="rest_code_27d7828a65af493f9f91fb65915e59f3-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">penalty</span> <span class="o">=</span> <span class="n">penalty</span>
<a id="rest_code_27d7828a65af493f9f91fb65915e59f3-5" name="rest_code_27d7828a65af493f9f91fb65915e59f3-5"></a>    <span class="k">return</span>
</pre></section><section id="the-call"><h3>3.2 The Call</h3>
<p>This is called <code class="docutils literal">pull</code> in most cases, but I thought it would be more uniform to put it in a call.</p>
<pre class="code python"><a id="rest_code_cf02803d1a3649b4a4f5b98acd742754-1" name="rest_code_cf02803d1a3649b4a4f5b98acd742754-1"></a><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="rest_code_cf02803d1a3649b4a4f5b98acd742754-2" name="rest_code_cf02803d1a3649b4a4f5b98acd742754-2"></a>    <span class="sd">"""pulls the arm and returns a reward or penalty</span>
<a id="rest_code_cf02803d1a3649b4a4f5b98acd742754-3" name="rest_code_cf02803d1a3649b4a4f5b98acd742754-3"></a>
<a id="rest_code_cf02803d1a3649b4a4f5b98acd742754-4" name="rest_code_cf02803d1a3649b4a4f5b98acd742754-4"></a><span class="sd">    Returns:</span>
<a id="rest_code_cf02803d1a3649b4a4f5b98acd742754-5" name="rest_code_cf02803d1a3649b4a4f5b98acd742754-5"></a><span class="sd">     float: value returned on pulling the arm</span>
<a id="rest_code_cf02803d1a3649b4a4f5b98acd742754-6" name="rest_code_cf02803d1a3649b4a4f5b98acd742754-6"></a><span class="sd">    """</span>
<a id="rest_code_cf02803d1a3649b4a4f5b98acd742754-7" name="rest_code_cf02803d1a3649b4a4f5b98acd742754-7"></a>    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">probability</span><span class="p">:</span>
<a id="rest_code_cf02803d1a3649b4a4f5b98acd742754-8" name="rest_code_cf02803d1a3649b4a4f5b98acd742754-8"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">penalty</span>
<a id="rest_code_cf02803d1a3649b4a4f5b98acd742754-9" name="rest_code_cf02803d1a3649b4a4f5b98acd742754-9"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reward</span>
</pre></section></section>
</div>
    </div>
    </article>
</div>

        <ul class="pager postindexpager clearfix">
<li class="next"><a href="index-1.html" rel="next">Older posts</a></li>
        </ul>
<!--End of body content--><footer id="footer">
            Contents Â© 2021         <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a><br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
            
            
        </footer>
</div>
</div>


        <script src="assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
