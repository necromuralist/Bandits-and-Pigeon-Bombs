<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Trying out the pybrain Hill Climbing optimization with Evolvable.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PyBrain Optimization Example | Reinforcement Learning</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/data_science/posts/PyBrain-Optimization-Example/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script><meta name="author" content="necromuralist">
<link rel="prev" href="../Epsilon-Greedy-with-Normal-Distribution-Payouts/" title="Epsilon Greedy with Normal-Distribution Payouts" type="text/html">
<link rel="next" href="../one-dimensional-world/" title="One-Dimensional World" type="text/html">
<meta property="og:site_name" content="Reinforcement Learning">
<meta property="og:title" content="PyBrain Optimization Example">
<meta property="og:url" content="https://necromuralist.github.io/data_science/posts/PyBrain-Optimization-Example/">
<meta property="og:description" content="Trying out the pybrain Hill Climbing optimization with Evolvable.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-01-12T16:16:00-08:00">
<meta property="article:tag" content="pybrain optimization">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://necromuralist.github.io/data_science/">

                <span id="blog-title">Reinforcement Learning</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>
                </li>
<li>
<a href="../../rss.xml">RSS feed</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form
 navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<button type="submit" class="btn btn-primary">
<span class="glyphicon glyphicon-search"></span>
</button>
<input type="hidden" name="sitesearch" value="https://necromuralist.github.io/data_science/">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.rst" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">PyBrain Optimization Example</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    <a href="../../authors/necromuralist/">necromuralist</a>
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2018-01-12T16:16:00-08:00" itemprop="datePublished" title="2018-01-12 16:16">2018-01-12 16:16</time></a></p>
            
        <p class="sourceline"><a href="index.rst" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>This is the <a class="reference external" href="http://www.pybrain.org/docs/tutorial/optimization.html#general-optimization-using-evolvable">general optimization example</a> from the pybrain documentation.</p>
<div class="section" id="imports">
<h2>1 Imports</h2>
<pre class="code ipython"><a name="rest_code_5279abfd37a54e5192b58d979a1b259b-1"></a><span class="c1"># python standard library</span>
<a name="rest_code_5279abfd37a54e5192b58d979a1b259b-2"></a><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span>
<a name="rest_code_5279abfd37a54e5192b58d979a1b259b-3"></a>
<a name="rest_code_5279abfd37a54e5192b58d979a1b259b-4"></a><span class="c1"># pypi</span>
<a name="rest_code_5279abfd37a54e5192b58d979a1b259b-5"></a><span class="kn">from</span> <span class="nn">pybrain.structure.evolvables.evolvable</span> <span class="kn">import</span> <span class="n">Evolvable</span>
<a name="rest_code_5279abfd37a54e5192b58d979a1b259b-6"></a><span class="kn">from</span> <span class="nn">pybrain.optimization</span> <span class="kn">import</span> <span class="n">HillClimber</span>
</pre>
</div>
<div class="section" id="the-evolvable">
<h2>2 The Evolvable</h2>
<p>To make an optimization that can take arbitrary values (not just continuous numbers), you can implement a sub-class of the PyBrain <a class="reference external" href="http://www.pybrain.org/docs/api/structure/evolvables.html">Evolvable</a> class.</p>
<div class="section" id="the-constructor">
<h3>2.1 The Constructor</h3>
<p>The <tt class="docutils literal">Evolvable</tt> class doesn't implement a constructor so you can create one with any parameters you need.</p>
</div>
<div class="section" id="the-mutate-method">
<h3>2.2 The Mutate Method</h3>
<p>This is the method that is called after each round to change the parameters a little (a <cite>tweak</cite>). It takes positional arguments, but I think it's called by the Hill Climber so I don't know where it gets passed in.</p>
</div>
<div class="section" id="the-copy-method">
<h3>2.3 The Copy Method</h3>
<p>The tutorial says this is a required method, but the documentation for the API says it should default to a deep-copy. Anyway, I think this is only used if you use something like a Genetic Algorithm.</p>
</div>
<div class="section" id="the-randomize-method">
<h3>2.4 The Randomize Method</h3>
<p>This is used to initialize the parameters to a random value. This is required but I'm pretty sure it doesn't get used in this case.</p>
<pre class="code ipython"><a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-1"></a><span class="k">class</span> <span class="nc">Mutant</span><span class="p">(</span><span class="n">Evolvable</span><span class="p">):</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-2"></a>    <span class="sd">"""A simple evolvable class</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-3"></a>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-4"></a><span class="sd">    Args:</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-5"></a><span class="sd">     x: a starting value to mimic the fitness of the model</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-6"></a><span class="sd">     mininmum: smallest allowed value</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-7"></a><span class="sd">     maximum: biggest allowed value</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-8"></a><span class="sd">    """</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-9"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="n">minimum</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="n">maximum</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-12"></a>        <span class="c1"># minimum &lt;= x &lt;= maximum</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-15"></a>        <span class="k">return</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-16"></a>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-17"></a>    <span class="nd">@property</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-18"></a>    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-19"></a>        <span class="sd">"""The value to optimize</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-20"></a>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-21"></a><span class="sd">        Returns:</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-22"></a><span class="sd">         x (float): value to optimize</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-23"></a><span class="sd">        """</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-24"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-25"></a>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-26"></a>    <span class="nd">@x.setter</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-27"></a>    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_x</span><span class="p">):</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-28"></a>        <span class="sd">"""sets x, constraining the value</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-29"></a>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-30"></a><span class="sd">        Args:</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-31"></a><span class="sd">         new_x: float from minimum to maximum</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-32"></a><span class="sd">        """</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-33"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">new_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span><span class="p">))</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-34"></a>        <span class="k">return</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-35"></a>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-36"></a>    <span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-37"></a>        <span class="sd">"""Updates x with a random change</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-38"></a>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-39"></a><span class="sd">        Maintains the constraint of the value</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-40"></a><span class="sd">        """</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="p">(</span><span class="n">random</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">)</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-42"></a>        <span class="k">return</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-43"></a>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-44"></a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-45"></a>        <span class="sd">"""Returns a new instance with the same x-value</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-46"></a>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-47"></a><span class="sd">        Returns:</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-48"></a><span class="sd">         Mutant: copy of this instance</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-49"></a><span class="sd">        """</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-50"></a>        <span class="k">return</span> <span class="n">Mutant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-51"></a>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-52"></a>    <span class="k">def</span> <span class="nf">randomize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-53"></a>        <span class="sd">"""A method to randomize the x-value"""</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-54"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span> <span class="o">*</span> <span class="n">random</span><span class="p">()</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-55"></a>        <span class="k">return</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-56"></a>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-57"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-58"></a>        <span class="sd">"""String representation</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-59"></a>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-60"></a><span class="sd">        Returns:</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-61"></a><span class="sd">         str: formatted version of x</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-62"></a><span class="sd">        """</span>
<a name="rest_code_551424c180cb472f8b8c391aa8e6ada3-63"></a>        <span class="k">return</span> <span class="s2">"&lt; {:.2f} (Maximized={})&gt;"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span>
</pre>
</div>
</div>
<div class="section" id="hill-climbing">
<h2>3 Hill Climbing</h2>
<p>The <a class="reference external" href="http://www.pybrain.org/docs/api/optimization/optimization.html#module-pybrain.optimization">HillClimber</a> is the simplest search - it assumes the first minima or maxima it finds is the global one. By default it tries to maximize the outcome. None of the arguments are required at instantiation, but in this case we're setting:</p>
<ul class="simple">
<li>an <tt class="docutils literal">evaluator</tt>: a callable that outputs how well the object to be evaluated did</li>
<li>an <tt class="docutils literal">evaluable</tt>: the object to be evaluated in this case our <tt class="docutils literal">Mutant</tt>
</li>
<li>
<tt class="docutils literal">maxEvaluations</tt>: The maximum number of times the <tt class="docutils literal">evaluable</tt> is evaluated</li>
<li>
<tt class="docutils literal">verbose</tt>: print each step</li>
<li>
<tt class="docutils literal">desiredEvaluation</tt>: the value that is good enough so the climber can stop</li>
</ul>
<div class="section" id="the-evaluator-function">
<h3>3.1 The Evaluator Function</h3>
<p>In this case we're just going to return the x value of the object.</p>
<pre class="code ipython"><a name="rest_code_52144fa5e6b740dca28cf4230d343630-1"></a><span class="k">def</span> <span class="nf">evaluator</span><span class="p">(</span><span class="n">mutant</span><span class="p">):</span>
<a name="rest_code_52144fa5e6b740dca28cf4230d343630-2"></a>    <span class="k">return</span> <span class="n">mutant</span><span class="o">.</span><span class="n">x</span>
</pre>
</div>
<div class="section" id="the-instances">
<h3>3.2 The Instances</h3>
<pre class="code ipython"><a name="rest_code_4e3addb230664a2ca7a92bb72f404363-1"></a><span class="n">mutant</span> <span class="o">=</span> <span class="n">Mutant</span><span class="p">(</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
<a name="rest_code_4e3addb230664a2ca7a92bb72f404363-2"></a><span class="n">climber</span> <span class="o">=</span> <span class="n">HillClimber</span><span class="p">(</span><span class="n">evaluator</span><span class="p">,</span> <span class="n">mutant</span><span class="p">,</span> <span class="n">maxEvaluations</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">desiredEvaluation</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="the-optimization">
<h3>3.3 The Optimization</h3>
<p>The optimization classes get run using their <tt class="docutils literal">learn</tt> methods.</p>
<pre class="code ipython"><a name="rest_code_8e1b940077f64c6984b996b78906b71b-1"></a><span class="n">outcome</span> <span class="o">=</span> <span class="n">climber</span><span class="o">.</span><span class="n">learn</span><span class="p">()</span>
<a name="rest_code_8e1b940077f64c6984b996b78906b71b-2"></a><span class="k">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre>
<pre class="literal-block">
('Step:', 0, 'best:', 6.780765339892317)
('Step:', 1, 'best:', 6.780765339892317)
('Step:', 2, 'best:', 6.807553650921801)
('Step:', 3, 'best:', 7.282574697921699)
('Step:', 4, 'best:', 7.45592511459156)
('Step:', 5, 'best:', 7.533694376079802)
('Step:', 6, 'best:', 7.751507552794123)
('Step:', 7, 'best:', 8.184303418505593)
('Step:', 8, 'best:', 8.184303418505593)
('Step:', 9, 'best:', 8.224264996606221)
('Step:', 10, 'best:', 8.4835021736195)
('Step:', 11, 'best:', 9.153976071682798)
('Step:', 12, 'best:', 9.55795557780446)
('Step:', 13, 'best:', 10)
(&lt; 10.00 (Maximized=True)&gt;, 10)
</pre>
<p>It managed to find the maximum in 13 steps.</p>
</div>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/pybrain-optimization/" rel="tag">pybrain optimization</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../Epsilon-Greedy-with-Normal-Distribution-Payouts/" rel="prev" title="Epsilon Greedy with Normal-Distribution Payouts">Previous post</a>
            </li>
            <li class="next">
                <a href="../one-dimensional-world/" rel="next" title="One-Dimensional World">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2018         <a href="mailto:necromuralist@gmail.com">necromuralist</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a>
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
