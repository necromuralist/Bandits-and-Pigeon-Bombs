<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Reinforcement Learning studies.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Reinforcement Learning</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/data_science/">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script><link rel="prefetch" href="posts/finding-the-best-epsilon/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://necromuralist.github.io/data_science/">

                <span id="blog-title">Reinforcement Learning</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form
 navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<button type="submit" class="btn btn-primary">
<span class="glyphicon glyphicon-search"></span>
</button>
<input type="hidden" name="sitesearch" value="https://necromuralist.github.io/data_science/">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/finding-the-best-epsilon/" class="u-url">Finding the Best Epsilon</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                hades
            </span></p>
            <p class="dateline"><a href="posts/finding-the-best-epsilon/" rel="bookmark"><time class="published dt-published" datetime="2017-07-30T18:41:00-07:00" title="2017-07-30 18:41">2017-07-30 18:41</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="posts/finding-the-best-epsilon/#introduction" id="id1">1 Introduction</a></li>
<li><a class="reference internal" href="posts/finding-the-best-epsilon/#imports" id="id2">2 Imports</a></li>
<li><a class="reference internal" href="posts/finding-the-best-epsilon/#set-up-the-plotting" id="id3">3 Set-up the Plotting</a></li>
<li>
<a class="reference internal" href="posts/finding-the-best-epsilon/#the-probabilities" id="id4">4 The Probabilities</a><ul>
<li><a class="reference internal" href="posts/finding-the-best-epsilon/#generate-the-probabilities" id="id5">4.1 Generate the Probabilities</a></li>
<li><a class="reference internal" href="posts/finding-the-best-epsilon/#inspecting-the-outcome" id="id6">4.2 Inspecting the Outcome</a></li>
</ul>
</li>
<li><a class="reference internal" href="posts/finding-the-best-epsilon/#average-reward" id="id7">5 Average Reward</a></li>
<li>
<a class="reference internal" href="posts/finding-the-best-epsilon/#cumulative-reward" id="id8">6 Cumulative Reward</a><ul>
<li><a class="reference internal" href="posts/finding-the-best-epsilon/#imbalanced-case" id="id9">6.1 Imbalanced Case</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id1">1 Introduction</a></h2>
<p>This is one of the ways to characterize the performance of the <em>Epsilon Greedy</em> agent using our <em>Bernoulli Arm</em>. We are going to look at three ways to evaluate how well the algorithm does.</p>
<ul class="simple">
<li>probability of using the best arm</li>
<li>average reward</li>
<li>cumulative reward</li>
</ul>
</div>
<div class="section" id="imports">
<h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id2">2 Imports</a></h2>
<pre class="code ipython"><a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-1"></a><span class="c1"># python standard library</span>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-2"></a><span class="kn">import</span> <span class="nn">random</span>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-3"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-4"></a>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-5"></a><span class="c1"># pypi</span>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-6"></a><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jit</span>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-7"></a><span class="kn">import</span> <span class="nn">numpy</span>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-8"></a><span class="kn">import</span> <span class="nn">pandas</span>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-9"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plot</span>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-10"></a><span class="kn">import</span> <span class="nn">seaborn</span>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-11"></a>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-12"></a><span class="c1"># this project</span>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-13"></a><span class="kn">from</span> <span class="nn">epsilon_greedy</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-14"></a>    <span class="n">EpsilonGreedy</span><span class="p">,</span>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-15"></a>    <span class="n">find_first</span>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-16"></a><span class="p">)</span>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-17"></a><span class="kn">from</span> <span class="nn">epsilon_greedy_optimized</span> <span class="kn">import</span> <span class="n">EpsilonGreedyOptimized</span>
<a name="rest_code_842d8d744c964e7fb47671b77d0eb90c-18"></a><span class="kn">from</span> <span class="nn">bernoulli_arm</span> <span class="kn">import</span> <span class="n">BernoulliArm</span>
</pre>
</div>
<div class="section" id="set-up-the-plotting">
<h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id3">3 Set-up the Plotting</a></h2>
<p>This will enable the plotting and set the style.</p>
<pre class="code ipython"><a name="rest_code_b8559ac8c1f64d7a9ccc73b48f5efa60-1"></a><span class="o">%</span><span class="k">matplotlib</span> inline
<a name="rest_code_b8559ac8c1f64d7a9ccc73b48f5efa60-2"></a><span class="n">seaborn</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="the-probabilities">
<h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id4">4 The Probabilities</a></h2>
<div class="section" id="generate-the-probabilities">
<h3><a class="toc-backref" href="posts/finding-the-best-epsilon/#id5">4.1 Generate the Probabilities</a></h3>
<p>This code will run generate the probabilities. Although I made it so that using the <tt class="docutils literal">EpsilonGreedy</tt> call method would both choose the arm and update the reward, in this case we need to know which arm was selected so I'm going to do the steps individually.</p>
<pre class="code ipython"><a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-1"></a><span class="k">def</span> <span class="nf">generate_probabilities</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-2"></a>    <span class="sd">"""this generates the probabilites for finding the best arm</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-3"></a>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-4"></a><span class="sd">    Args:</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-5"></a><span class="sd">     trials (int): number of times to train the agent</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-6"></a><span class="sd">     times (int): length of time to train the agent</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-8"></a><span class="sd">     Dict: the probabilites for each epsilon over time</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-9"></a><span class="sd">     """</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-10"></a>    <span class="n">arm_probabilities</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-11"></a>    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">arm_probabilities</span><span class="p">)</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-12"></a>    <span class="n">best_arm</span> <span class="o">=</span> <span class="n">arm_probabilities</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">arm_probabilities</span><span class="p">))</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-13"></a>    <span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="n">BernoulliArm</span><span class="p">(</span><span class="n">probability</span><span class="p">)</span> <span class="k">for</span> <span class="n">probability</span> <span class="ow">in</span> <span class="n">arm_probabilities</span><span class="p">]</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-14"></a>    <span class="n">epsilons</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-15"></a>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-16"></a>    <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{}</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-17"></a>    <span class="k">for</span> <span class="n">epsilon</span> <span class="ow">in</span> <span class="n">epsilons</span><span class="p">:</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-18"></a>        <span class="n">agent</span> <span class="o">=</span> <span class="n">EpsilonGreedy</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">arms</span><span class="p">)</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-19"></a>        <span class="n">probabilities</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-20"></a>        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-21"></a>            <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-22"></a>                <span class="n">arm</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">select_arm</span><span class="p">()</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-23"></a>                <span class="n">agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-24"></a>                <span class="k">if</span> <span class="n">arm</span> <span class="o">==</span> <span class="n">best_arm</span><span class="p">:</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-25"></a>                    <span class="n">probabilities</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-26"></a>            <span class="n">agent</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-27"></a>        <span class="n">outcomes</span><span class="p">[</span><span class="s2">"Epsilon {:.02f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)]</span> <span class="o">=</span> <span class="n">probabilities</span><span class="o">/</span><span class="n">times</span>
<a name="rest_code_238f478030fc4d048d6ba8a4afc0a692-28"></a>    <span class="k">return</span> <span class="n">outcomes</span>
</pre>
</div>
<div class="section" id="inspecting-the-outcome">
<h3><a class="toc-backref" href="posts/finding-the-best-epsilon/#id6">4.2 Inspecting the Outcome</a></h3>
<pre class="code ipython"><a name="rest_code_20af9eb454004c5095a278bcc8d3102a-1"></a><span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">5000</span>
<a name="rest_code_20af9eb454004c5095a278bcc8d3102a-2"></a><span class="n">TIMES</span> <span class="o">=</span> <span class="mi">400</span>
</pre>
<pre class="code ipython"><a name="rest_code_3719a2305a4e4c819811f519de24fc1a-1"></a><span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a name="rest_code_3719a2305a4e4c819811f519de24fc1a-2"></a><span class="n">probabilities</span> <span class="o">=</span> <span class="n">generate_probabilities</span><span class="p">(</span><span class="n">trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">TIMES</span><span class="p">)</span>
<a name="rest_code_3719a2305a4e4c819811f519de24fc1a-3"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Run Time: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
<a name="rest_code_3719a2305a4e4c819811f519de24fc1a-4"></a><span class="n">probabilities</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">probabilities</span><span class="p">)</span>
<a name="rest_code_3719a2305a4e4c819811f519de24fc1a-5"></a><span class="n">probabilities</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre>
<pre class="literal-block">
       Epsilon 0.05  Epsilon 0.10  Epsilon 0.20  Epsilon 0.30  Epsilon 0.40  \
count    400.000000    400.000000    400.000000    400.000000    400.000000
mean       8.784956      9.971200      9.801344      9.084844      8.235194
std        3.064916      2.523568      1.775677      1.319447      0.998305
min        0.120000      0.275000      0.495000      0.757500      1.050000
25%        7.141875      9.740000     10.264375      9.390000      8.409375
50%        9.937500     11.187500     10.456250      9.475000      8.480000
75%       11.225000     11.457500     10.515000      9.530625      8.545000
max       11.720000     11.605000     10.727500      9.665000      8.712500

       Epsilon 0.50
count    400.000000
mean       7.310087
std        0.763259
min        1.190000
25%        7.406875
50%        7.473750
75%        7.535625
max        7.725000
</pre>
<pre class="code ipython"><a name="rest_code_2be0449551b84ecba5cd12c16acc7190-1"></a><span class="n">probabilities</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"epsilon_greedy_accuracy.csv"</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_ea16d81e05c946dfba5634dc80d617e7-1"></a><span class="n">figure</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a name="rest_code_ea16d81e05c946dfba5634dc80d617e7-2"></a><span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<a name="rest_code_ea16d81e05c946dfba5634dc80d617e7-3"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Accuracy of the Epsilon Greedy Algorithm ({} trials)"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TRIALS</span><span class="p">))</span>
<a name="rest_code_ea16d81e05c946dfba5634dc80d617e7-4"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Time (number of pulls on the arm)"</span><span class="p">)</span>
<a name="rest_code_ea16d81e05c946dfba5634dc80d617e7-5"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Probability of retrieving the best arm"</span><span class="p">)</span>
<a name="rest_code_ea16d81e05c946dfba5634dc80d617e7-6"></a><span class="n">probabilities</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
</pre>
<img alt="epsilon_greedy_probablilities.png" src="posts/finding-the-best-epsilon/epsilon_greedy_probablilities.png"><p>Looking at the plots, it appears that the epsilons greater than 0.05 converge faster that 0.05 (their curves are steeper at the beginning), as you would expect, but they also don't do as well in the long run, as you might also expect, since they're doing more exploration. In the long run, the more exploitation, the better the profit, but I suppose it depends on the window you have to work with, if you have a short one, then the more aggresive explorers might be better. Anything less than 350 would do better with 0.1 rather than 0.05, for instance.</p>
</div>
</div>
<div class="section" id="average-reward">
<h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id7">5 Average Reward</a></h2>
<p>One of the things to note about the previous trials is that there was one arm that did notably better than all the others. When they are more uniform using the probability of retrieving the best arm might not be as revealing. Instead, using the average reward so far would give us more information.</p>
<pre class="code ipython"><a name="rest_code_832685b26783430788086575214384a8-1"></a><span class="nd">@jit</span>
<a name="rest_code_832685b26783430788086575214384a8-2"></a><span class="k">def</span> <span class="nf">average_reward</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<a name="rest_code_832685b26783430788086575214384a8-3"></a>    <span class="sd">"""this generates the probabilites for finding the best arm</span>
<a name="rest_code_832685b26783430788086575214384a8-4"></a>
<a name="rest_code_832685b26783430788086575214384a8-5"></a><span class="sd">    Args:</span>
<a name="rest_code_832685b26783430788086575214384a8-6"></a><span class="sd">     trials (int): number of times to train the agent</span>
<a name="rest_code_832685b26783430788086575214384a8-7"></a><span class="sd">     times (int): length of time to train the agent</span>
<a name="rest_code_832685b26783430788086575214384a8-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_832685b26783430788086575214384a8-9"></a><span class="sd">     Dict: the probabilites for each epsilon over time</span>
<a name="rest_code_832685b26783430788086575214384a8-10"></a><span class="sd">    """</span>
<a name="rest_code_832685b26783430788086575214384a8-11"></a>    <span class="n">arm_probabilities</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<a name="rest_code_832685b26783430788086575214384a8-12"></a>    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">arm_probabilities</span><span class="p">)</span>
<a name="rest_code_832685b26783430788086575214384a8-13"></a>    <span class="c1"># arms = [BernoulliArm(probability) for probability in arm_probabilities]</span>
<a name="rest_code_832685b26783430788086575214384a8-14"></a>    <span class="n">epsilons</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<a name="rest_code_832685b26783430788086575214384a8-15"></a>
<a name="rest_code_832685b26783430788086575214384a8-16"></a>    <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{}</span>
<a name="rest_code_832685b26783430788086575214384a8-17"></a>    <span class="k">for</span> <span class="n">epsilon</span> <span class="ow">in</span> <span class="n">epsilons</span><span class="p">:</span>
<a name="rest_code_832685b26783430788086575214384a8-18"></a>        <span class="n">agent</span> <span class="o">=</span> <span class="n">EpsilonGreedyOptimized</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">arm_probabilities</span><span class="p">)</span>
<a name="rest_code_832685b26783430788086575214384a8-19"></a>        <span class="n">average_rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
<a name="rest_code_832685b26783430788086575214384a8-20"></a>        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
<a name="rest_code_832685b26783430788086575214384a8-21"></a>            <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
<a name="rest_code_832685b26783430788086575214384a8-22"></a>                <span class="n">arm</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">select_arm</span><span class="p">()</span>
<a name="rest_code_832685b26783430788086575214384a8-23"></a>                <span class="n">old_reward</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">total_reward</span>
<a name="rest_code_832685b26783430788086575214384a8-24"></a>                <span class="n">agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
<a name="rest_code_832685b26783430788086575214384a8-25"></a>                <span class="n">average_rewards</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">-</span> <span class="n">old_reward</span><span class="p">)</span>
<a name="rest_code_832685b26783430788086575214384a8-26"></a>            <span class="n">agent</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a name="rest_code_832685b26783430788086575214384a8-27"></a>        <span class="n">outcomes</span><span class="p">[</span><span class="s2">"Epsilon {0:.02f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)]</span> <span class="o">=</span> <span class="n">average_rewards</span><span class="o">/</span><span class="n">trials</span>
<a name="rest_code_832685b26783430788086575214384a8-28"></a>    <span class="k">return</span> <span class="n">outcomes</span>
</pre>
<pre class="code ipython"><a name="rest_code_3cba7a53b9e240fab4772772d80b982c-1"></a><span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a name="rest_code_3cba7a53b9e240fab4772772d80b982c-2"></a><span class="n">averages</span> <span class="o">=</span> <span class="n">average_reward</span><span class="p">(</span><span class="n">TIMES</span><span class="p">,</span> <span class="n">TRIALS</span><span class="p">)</span>
<a name="rest_code_3cba7a53b9e240fab4772772d80b982c-3"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Run Time: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
<a name="rest_code_3cba7a53b9e240fab4772772d80b982c-4"></a><span class="n">averages</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">averages</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Run Time: 0:01:08.727723
</pre>
<pre class="code ipython"><a name="rest_code_599a325931b34b5d9bfd4c5d6c1ad228-1"></a><span class="n">figure</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a name="rest_code_599a325931b34b5d9bfd4c5d6c1ad228-2"></a><span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<a name="rest_code_599a325931b34b5d9bfd4c5d6c1ad228-3"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Reward of the Epsilon Greedy Algorithm ({} trials)"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TRIALS</span><span class="p">))</span>
<a name="rest_code_599a325931b34b5d9bfd4c5d6c1ad228-4"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Time (number of pulls on the arm)"</span><span class="p">)</span>
<a name="rest_code_599a325931b34b5d9bfd4c5d6c1ad228-5"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Average Reward"</span><span class="p">)</span>
<a name="rest_code_599a325931b34b5d9bfd4c5d6c1ad228-6"></a><span class="n">averages</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'.'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">"None"</span><span class="p">)</span>
</pre>
<img alt="epsilon_averages.png" src="posts/finding-the-best-epsilon/epsilon_averages.png"><p>There's much more variablity and overlap here, as you might expect since I made the probabilities closer. Interestingly, the strongly exploratory agents seem to do worse, even from the beginning, while the more exploitative ones do better.  Although it looks like 0.2 might be doing as well or better than 0.1 once you get over 100.</p>
</div>
<div class="section" id="cumulative-reward">
<h2><a class="toc-backref" href="posts/finding-the-best-epsilon/#id8">6 Cumulative Reward</a></h2>
<p>The previous two metrics turn out to be useful, but somewhat unfair to the aggresively exploring models, which we know won't ultimately do as well, but do have an advantage in the initial phase. To better qualify the overall effect of exploration versus exploitation, it's better to use a cumulative sum of the rewards.</p>
<pre class="code ipython"><a name="rest_code_3aca164cc5e0483f8a8aeac037317037-1"></a><span class="nd">@jit</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-2"></a><span class="k">def</span> <span class="nf">cumulative_reward</span><span class="p">(</span><span class="n">arms</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-3"></a>    <span class="sd">"""this generates the cumulative reward as the agent pulls the arms</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-4"></a>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-5"></a><span class="sd">    Args:</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-6"></a><span class="sd">     arms (numpy.array): array of probabilities that the arm will pay-off</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-7"></a><span class="sd">     trials (int): number of times to train the agent</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-8"></a><span class="sd">     times (int): length of time to train the agent</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-9"></a><span class="sd">    Returns:</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-10"></a><span class="sd">     Dict: the probabilites for each epsilon over time</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-11"></a><span class="sd">    """</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-12"></a>    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">arms</span><span class="p">)</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-13"></a>    <span class="n">epsilons</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-14"></a>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-15"></a>    <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{}</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-16"></a>    <span class="k">for</span> <span class="n">epsilon</span> <span class="ow">in</span> <span class="n">epsilons</span><span class="p">:</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-17"></a>        <span class="n">agent</span> <span class="o">=</span> <span class="n">EpsilonGreedyOptimized</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">arms</span><span class="p">)</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-18"></a>        <span class="n">cumulative_rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-19"></a>        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-20"></a>            <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-21"></a>                <span class="n">arm</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">select_arm</span><span class="p">()</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-22"></a>                <span class="n">agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-23"></a>                <span class="n">cumulative_rewards</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">total_reward</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-24"></a>            <span class="n">agent</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-25"></a>        <span class="n">outcomes</span><span class="p">[</span><span class="s2">"Epsilon {:.02f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cumulative_rewards</span><span class="o">/</span><span class="n">trials</span>
<a name="rest_code_3aca164cc5e0483f8a8aeac037317037-26"></a>    <span class="k">return</span> <span class="n">outcomes</span>
</pre>
<pre class="code ipython"><a name="rest_code_3d277ef6cf3e4633ac8409bf34bf741e-1"></a><span class="k">def</span> <span class="nf">generate_cumulative</span><span class="p">(</span><span class="n">arms</span><span class="p">):</span>
<a name="rest_code_3d277ef6cf3e4633ac8409bf34bf741e-2"></a>    <span class="sd">"""runs the cumulative output function</span>
<a name="rest_code_3d277ef6cf3e4633ac8409bf34bf741e-3"></a>
<a name="rest_code_3d277ef6cf3e4633ac8409bf34bf741e-4"></a><span class="sd">    Args:</span>
<a name="rest_code_3d277ef6cf3e4633ac8409bf34bf741e-5"></a><span class="sd">     arms (numpy.array): probabilities that arms will pay out</span>
<a name="rest_code_3d277ef6cf3e4633ac8409bf34bf741e-6"></a>
<a name="rest_code_3d277ef6cf3e4633ac8409bf34bf741e-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_3d277ef6cf3e4633ac8409bf34bf741e-8"></a><span class="sd">     pandas.DataFrame: the average cumulative rewards</span>
<a name="rest_code_3d277ef6cf3e4633ac8409bf34bf741e-9"></a><span class="sd">    """</span>
<a name="rest_code_3d277ef6cf3e4633ac8409bf34bf741e-10"></a>    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a name="rest_code_3d277ef6cf3e4633ac8409bf34bf741e-11"></a>    <span class="n">cumulative</span> <span class="o">=</span> <span class="n">cumulative_reward</span><span class="p">(</span><span class="n">arms</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">TIMES</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">)</span>
<a name="rest_code_3d277ef6cf3e4633ac8409bf34bf741e-12"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"Run Time: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
<a name="rest_code_3d277ef6cf3e4633ac8409bf34bf741e-13"></a>    <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">cumulative</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_28f8abe6943e4dfeba74f062b8e3b43d-1"></a><span class="k">def</span> <span class="nf">plot_cumulative</span><span class="p">(</span><span class="n">cumulative</span><span class="p">):</span>
<a name="rest_code_28f8abe6943e4dfeba74f062b8e3b43d-2"></a>    <span class="sd">"""generates and plots cumulative average</span>
<a name="rest_code_28f8abe6943e4dfeba74f062b8e3b43d-3"></a>
<a name="rest_code_28f8abe6943e4dfeba74f062b8e3b43d-4"></a><span class="sd">    Args:</span>
<a name="rest_code_28f8abe6943e4dfeba74f062b8e3b43d-5"></a><span class="sd">     cumulative (pandas.DataFrame): data to plot</span>
<a name="rest_code_28f8abe6943e4dfeba74f062b8e3b43d-6"></a><span class="sd">    """</span>
<a name="rest_code_28f8abe6943e4dfeba74f062b8e3b43d-7"></a>    <span class="n">figure</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a name="rest_code_28f8abe6943e4dfeba74f062b8e3b43d-8"></a>    <span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<a name="rest_code_28f8abe6943e4dfeba74f062b8e3b43d-9"></a>    <span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Cumulative Reward of the Epsilon Greedy Algorithm ({} trials)"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TRIALS</span><span class="p">))</span>
<a name="rest_code_28f8abe6943e4dfeba74f062b8e3b43d-10"></a>    <span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Time (number of pulls on the arm)"</span><span class="p">)</span>
<a name="rest_code_28f8abe6943e4dfeba74f062b8e3b43d-11"></a>    <span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Cumulative Reward"</span><span class="p">)</span>
<a name="rest_code_28f8abe6943e4dfeba74f062b8e3b43d-12"></a>    <span class="n">cumulative</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
<a name="rest_code_28f8abe6943e4dfeba74f062b8e3b43d-13"></a>    <span class="k">return</span>
</pre>
<pre class="code ipython"><a name="rest_code_dab9b023901e46caaeea5a4084f22a21-1"></a><span class="n">cumulative</span> <span class="o">=</span> <span class="n">generate_cumulative</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
<a name="rest_code_dab9b023901e46caaeea5a4084f22a21-2"></a><span class="n">plot_cumulative</span><span class="p">(</span><span class="n">cumulative</span><span class="p">)</span>
</pre>
<img alt="epsilon_greedy_cumulative.png" src="posts/finding-the-best-epsilon/epsilon_greedy_cumulative.png"><p>Because of the randomness this will change everytime you run it, but we can see that in this case, the average cumulative reward was better for the 0.3 and 0.5 epsilon values that the more conservative values up until around 275, and the second most conservative case (0.2) actually did worse on average than the more exploratory cases did.</p>
<div class="section" id="imbalanced-case">
<h3><a class="toc-backref" href="posts/finding-the-best-epsilon/#id9">6.1 Imbalanced Case</a></h3>
<p>I'll re-run this again with more arms and a only one clear good arm to see if this changes things.</p>
<pre class="code ipython"><a name="rest_code_23fadfc804a54e19ae1f10eba630ffb0-1"></a><span class="n">plot_cumulative</span><span class="p">(</span><span class="n">generate_cumulative</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">])))</span>
</pre>
<img alt="epsilon_cumulative_2.png" src="posts/finding-the-best-epsilon/epsilon_cumulative_2.png"><p>In this case, the most exploitive agent did much worse than the other agents. It looks like it didn't find the best arm until around the 240th pull. In this case, when most arms pay off poorly and one arm pays off much better, the exploratory arms accumulate more reward within our time frame. I'm guessing that the 0.10 epsilon would, given enough time, pull ahead, and you can in fact see that the most exploratory agent has already been surpassed by the 0.2 agent, so eventually exploration would probably take a back seat to exploitation, but not in this case. It's important to note, however, that if the most exploitive agent had happened to find the best arm at the start, he would likely have ended up the best, it's just the nature of randomization that you aren't guaranteed that this would be the case.</p>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/A-Bernoulli-Arm/" class="u-url">A Bernoulli Arm</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                hades
            </span></p>
            <p class="dateline"><a href="posts/A-Bernoulli-Arm/" rel="bookmark"><time class="published dt-published" datetime="2017-07-30T18:37:00-07:00" title="2017-07-30 18:37">2017-07-30 18:37</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="introduction">
<h2>1 Introduction</h2>
<p>This is an implementation of one arm of a <a class="reference external" href="https://en.wikipedia.org/wiki/Multi-armed_bandit">n-armed bandit</a> to test the Epsilon Greedy algorithm. It takes a probability that it will return a reward. It also optionally let's you set the penalty and reward values, but defaults to a reward of 1 and a penalty of 0 (so it's really no reward more than a penalty).</p>
</div>
<div class="section" id="imports">
<h2>2 Imports</h2>
<pre class="code python"><a name="rest_code_faf342424cd44410a5992a9205bad8b9-1"></a><span class="c1"># python standard library</span>
<a name="rest_code_faf342424cd44410a5992a9205bad8b9-2"></a><span class="kn">import</span> <span class="nn">random</span>
</pre>
</div>
<div class="section" id="bernoulli-arm">
<h2>3 Bernoulli Arm</h2>
<p>The Bernoulli Arm will generate a value when its arm is pulled at a payout rate specified by the `probability` value.</p>
<pre class="code python"><a name="rest_code_33bf9e47b5344e34927f880e18e3fec8-1"></a><span class="o">&lt;&lt;</span><span class="n">imports</span><span class="o">&gt;&gt;</span>
<a name="rest_code_33bf9e47b5344e34927f880e18e3fec8-2"></a>
<a name="rest_code_33bf9e47b5344e34927f880e18e3fec8-3"></a><span class="k">class</span> <span class="nc">BernoulliArm</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_33bf9e47b5344e34927f880e18e3fec8-4"></a>    <span class="sd">"""A simulation of one arm of a multi-armed bandit</span>
<a name="rest_code_33bf9e47b5344e34927f880e18e3fec8-5"></a>
<a name="rest_code_33bf9e47b5344e34927f880e18e3fec8-6"></a><span class="sd">    Args:</span>
<a name="rest_code_33bf9e47b5344e34927f880e18e3fec8-7"></a><span class="sd">     probability (float): probability of a reward</span>
<a name="rest_code_33bf9e47b5344e34927f880e18e3fec8-8"></a><span class="sd">     reward (float): value to return on a win</span>
<a name="rest_code_33bf9e47b5344e34927f880e18e3fec8-9"></a><span class="sd">     penalty (float): value to return on a loss</span>
<a name="rest_code_33bf9e47b5344e34927f880e18e3fec8-10"></a><span class="sd">    """</span>
<a name="rest_code_33bf9e47b5344e34927f880e18e3fec8-11"></a>    <span class="o">&lt;&lt;</span><span class="n">constructor</span><span class="o">&gt;&gt;</span>
<a name="rest_code_33bf9e47b5344e34927f880e18e3fec8-12"></a>
<a name="rest_code_33bf9e47b5344e34927f880e18e3fec8-13"></a>    <span class="o">&lt;&lt;</span><span class="n">call</span><span class="o">&gt;&gt;</span>
</pre>
<div class="section" id="constructor">
<h3>3.1 Constructor</h3>
<p>The constructor takes three values:</p>
<ul class="simple">
<li>probability of winning</li>
<li>reward on winning</li>
<li>penalty on losing</li>
</ul>
<p>Because of the way the problem is set up, the reward and penalty are already set at 1 and 0, but I didn't want there to be magic numbers so they can be changed if needed.</p>
<pre class="code python"><a name="rest_code_8e786658fa3e4e0e9d1ae04853a93283-1"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">probability</span><span class="p">,</span> <span class="n">reward</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a name="rest_code_8e786658fa3e4e0e9d1ae04853a93283-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">probability</span> <span class="o">=</span> <span class="n">probability</span>
<a name="rest_code_8e786658fa3e4e0e9d1ae04853a93283-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">reward</span> <span class="o">=</span> <span class="n">reward</span>
<a name="rest_code_8e786658fa3e4e0e9d1ae04853a93283-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">penalty</span> <span class="o">=</span> <span class="n">penalty</span>
<a name="rest_code_8e786658fa3e4e0e9d1ae04853a93283-5"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="the-call">
<h3>3.2 The Call</h3>
<p>This is called <tt class="docutils literal">pull</tt> in most cases, but I thought it would be more uniform to put it in a call.</p>
<pre class="code python"><a name="rest_code_016e8b598b5145a4abf6a662921bafcc-1"></a><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_016e8b598b5145a4abf6a662921bafcc-2"></a>    <span class="sd">"""pulls the arm and returns a reward or penalty</span>
<a name="rest_code_016e8b598b5145a4abf6a662921bafcc-3"></a>
<a name="rest_code_016e8b598b5145a4abf6a662921bafcc-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_016e8b598b5145a4abf6a662921bafcc-5"></a><span class="sd">     float: value returned on pulling the arm</span>
<a name="rest_code_016e8b598b5145a4abf6a662921bafcc-6"></a><span class="sd">    """</span>
<a name="rest_code_016e8b598b5145a4abf6a662921bafcc-7"></a>    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">probability</span><span class="p">:</span>
<a name="rest_code_016e8b598b5145a4abf6a662921bafcc-8"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">penalty</span>
<a name="rest_code_016e8b598b5145a4abf6a662921bafcc-9"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reward</span>
</pre>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/The-Epsilon-Greedy-Algorithm/" class="u-url">The Epsilon Greedy Algorithm</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                hades
            </span></p>
            <p class="dateline"><a href="posts/The-Epsilon-Greedy-Algorithm/" rel="bookmark"><time class="published dt-published" datetime="2017-07-30T18:22:00-07:00" title="2017-07-30 18:22">2017-07-30 18:22</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="background">
<h2>1 Background</h2>
<p>This is an implementation of the Epsilon Greedy algorithm to find solutions for the multi-arm-bandit problem.</p>
</div>
<div class="section" id="imports">
<h2>2 Imports</h2>
<pre class="code python"><a name="rest_code_94ad09ba32d6423fbcc305aaed56a8ed-1"></a><span class="c1"># python</span>
<a name="rest_code_94ad09ba32d6423fbcc305aaed56a8ed-2"></a><span class="kn">import</span> <span class="nn">random</span>
<a name="rest_code_94ad09ba32d6423fbcc305aaed56a8ed-3"></a>
<a name="rest_code_94ad09ba32d6423fbcc305aaed56a8ed-4"></a><span class="c1"># pypi</span>
<a name="rest_code_94ad09ba32d6423fbcc305aaed56a8ed-5"></a><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jit</span>
<a name="rest_code_94ad09ba32d6423fbcc305aaed56a8ed-6"></a><span class="kn">import</span> <span class="nn">numpy</span>
</pre>
</div>
<div class="section" id="find-first">
<h2>3 Find First</h2>
<p>This is a helper function to find the first matching item in an array-like collection.</p>
<pre class="code python"><a name="rest_code_341ef2ca2d7c4df49468ed91b7ea417b-1"></a><span class="nd">@jit</span>
<a name="rest_code_341ef2ca2d7c4df49468ed91b7ea417b-2"></a><span class="k">def</span> <span class="nf">find_first</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">vector</span><span class="p">):</span>
<a name="rest_code_341ef2ca2d7c4df49468ed91b7ea417b-3"></a>    <span class="sd">"""find the first item in the vector</span>
<a name="rest_code_341ef2ca2d7c4df49468ed91b7ea417b-4"></a>
<a name="rest_code_341ef2ca2d7c4df49468ed91b7ea417b-5"></a><span class="sd">    Args:</span>
<a name="rest_code_341ef2ca2d7c4df49468ed91b7ea417b-6"></a><span class="sd">     item: thing to match</span>
<a name="rest_code_341ef2ca2d7c4df49468ed91b7ea417b-7"></a><span class="sd">     vector: thing to search</span>
<a name="rest_code_341ef2ca2d7c4df49468ed91b7ea417b-8"></a>
<a name="rest_code_341ef2ca2d7c4df49468ed91b7ea417b-9"></a><span class="sd">    Returns:</span>
<a name="rest_code_341ef2ca2d7c4df49468ed91b7ea417b-10"></a><span class="sd">     value: index of first matching item, -1 if not found</span>
<a name="rest_code_341ef2ca2d7c4df49468ed91b7ea417b-11"></a><span class="sd">    """</span>
<a name="rest_code_341ef2ca2d7c4df49468ed91b7ea417b-12"></a>    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="p">)):</span>
<a name="rest_code_341ef2ca2d7c4df49468ed91b7ea417b-13"></a>        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">vector</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
<a name="rest_code_341ef2ca2d7c4df49468ed91b7ea417b-14"></a>            <span class="k">return</span> <span class="n">index</span>
<a name="rest_code_341ef2ca2d7c4df49468ed91b7ea417b-15"></a>    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</pre>
</div>
<div class="section" id="epsilon-greedy">
<h2>4 Epsilon Greedy</h2>
<p>The <em>epsilon-greedy</em> algorithm tries to solve the exploitation-exploration dilemna by exploring a fraction of the time (set by <em>epsilon</em>) and using the best solution found so far the rest of the time. This implementation is based on the one in Bandit Algorithms for Website Optimization <a class="footnote-reference" href="posts/The-Epsilon-Greedy-Algorithm/#id5" id="id1">[1]</a> .</p>
<pre class="code python"><a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-1"></a><span class="o">&lt;&lt;</span><span class="n">imports</span><span class="o">&gt;&gt;</span>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-2"></a>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-3"></a><span class="o">&lt;&lt;</span><span class="n">find</span><span class="o">-</span><span class="n">first</span><span class="o">&gt;&gt;</span>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-4"></a><span class="k">class</span> <span class="nc">EpsilonGreedy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-5"></a>    <span class="sd">"""The Epsilon Greedy Algorithm</span>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-6"></a>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-7"></a><span class="sd">    Args:</span>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-8"></a><span class="sd">     epsilon (float): fraction of the time to explore</span>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-9"></a><span class="sd">     arms (list): collection of bandits to pull</span>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-10"></a><span class="sd">    """</span>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-11"></a>    <span class="o">&lt;&lt;</span><span class="n">constructor</span><span class="o">&gt;&gt;</span>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-12"></a>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-13"></a>    <span class="o">&lt;&lt;</span><span class="n">best</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-14"></a>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-15"></a>    <span class="o">&lt;&lt;</span><span class="n">counts</span><span class="o">&gt;&gt;</span>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-16"></a>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-17"></a>    <span class="o">&lt;&lt;</span><span class="n">rewards</span><span class="o">&gt;&gt;</span>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-18"></a>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-19"></a>    <span class="o">&lt;&lt;</span><span class="n">select</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-20"></a>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-21"></a>    <span class="o">&lt;&lt;</span><span class="n">update</span><span class="o">&gt;&gt;</span>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-22"></a>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-23"></a>    <span class="o">&lt;&lt;</span><span class="n">reset</span><span class="o">&gt;&gt;</span>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-24"></a>
<a name="rest_code_a90c7cfc856e426ab41a2cdfafb52f52-25"></a>    <span class="o">&lt;&lt;</span><span class="n">call</span><span class="o">&gt;&gt;</span>
</pre>
<div class="section" id="the-constructor">
<h3>4.1 The Constructor</h3>
<p>The constructor takes two arguments - <em>epsilon</em> and <em>arms</em>. The <em>arms</em> list should contain bandits that return a reward or penalty when pulled (called).</p>
<pre class="code python"><a name="rest_code_ebc6da1cfd1c47fdbf1ecaf08bc0f249-1"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">arms</span><span class="p">):</span>
<a name="rest_code_ebc6da1cfd1c47fdbf1ecaf08bc0f249-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
<a name="rest_code_ebc6da1cfd1c47fdbf1ecaf08bc0f249-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="n">arms</span>
<a name="rest_code_ebc6da1cfd1c47fdbf1ecaf08bc0f249-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_ebc6da1cfd1c47fdbf1ecaf08bc0f249-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_rewards</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_ebc6da1cfd1c47fdbf1ecaf08bc0f249-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_ebc6da1cfd1c47fdbf1ecaf08bc0f249-7"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="best-arm">
<h3>4.2 Best Arm</h3>
<p>The <tt class="docutils literal">best_arm</tt> property returns the index of the arm that has the highest average reward so far. It returns the index instead of the arm itself because it's used to get the matching counts and rewards in the <tt class="docutils literal">update</tt> method.</p>
<pre class="code python"><a name="rest_code_c1ebfeed07cc4e1ca933263728811764-1"></a><span class="nd">@property</span>
<a name="rest_code_c1ebfeed07cc4e1ca933263728811764-2"></a><span class="k">def</span> <span class="nf">best_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_c1ebfeed07cc4e1ca933263728811764-3"></a>    <span class="sd">"""Index of the arm with the most reward"""</span>
<a name="rest_code_c1ebfeed07cc4e1ca933263728811764-4"></a>    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<a name="rest_code_c1ebfeed07cc4e1ca933263728811764-5"></a>    <span class="k">return</span> <span class="n">find_first</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="counts">
<h3>4.3 Counts</h3>
<p>The `counts` keeps track of the number of times each arm is pulled.</p>
<pre class="code python"><a name="rest_code_ed37564f3f8b41e094adedae9d4236f5-1"></a><span class="nd">@property</span>
<a name="rest_code_ed37564f3f8b41e094adedae9d4236f5-2"></a><span class="k">def</span> <span class="nf">counts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_ed37564f3f8b41e094adedae9d4236f5-3"></a>    <span class="sd">"""counts of times each arm is pulled</span>
<a name="rest_code_ed37564f3f8b41e094adedae9d4236f5-4"></a>
<a name="rest_code_ed37564f3f8b41e094adedae9d4236f5-5"></a><span class="sd">    Returns:</span>
<a name="rest_code_ed37564f3f8b41e094adedae9d4236f5-6"></a><span class="sd">     numpy.array: array of counts</span>
<a name="rest_code_ed37564f3f8b41e094adedae9d4236f5-7"></a><span class="sd">    """</span>
<a name="rest_code_ed37564f3f8b41e094adedae9d4236f5-8"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<a name="rest_code_ed37564f3f8b41e094adedae9d4236f5-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a name="rest_code_ed37564f3f8b41e094adedae9d4236f5-10"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span>
</pre>
</div>
<div class="section" id="rewards">
<h3>4.4 Rewards</h3>
<p>The <tt class="docutils literal">rewards</tt> attributes holds the running average reward that each arm has returned.</p>
<pre class="code python"><a name="rest_code_2b7fc19b5bd44ef796e737bade250a0d-1"></a><span class="nd">@property</span>
<a name="rest_code_2b7fc19b5bd44ef796e737bade250a0d-2"></a><span class="k">def</span> <span class="nf">rewards</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_2b7fc19b5bd44ef796e737bade250a0d-3"></a>    <span class="sd">"""array of running average of rewards for each arms</span>
<a name="rest_code_2b7fc19b5bd44ef796e737bade250a0d-4"></a>
<a name="rest_code_2b7fc19b5bd44ef796e737bade250a0d-5"></a><span class="sd">    Returns:</span>
<a name="rest_code_2b7fc19b5bd44ef796e737bade250a0d-6"></a><span class="sd">     numpy.array: running averages</span>
<a name="rest_code_2b7fc19b5bd44ef796e737bade250a0d-7"></a><span class="sd">    """</span>
<a name="rest_code_2b7fc19b5bd44ef796e737bade250a0d-8"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rewards</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<a name="rest_code_2b7fc19b5bd44ef796e737bade250a0d-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_2b7fc19b5bd44ef796e737bade250a0d-10"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rewards</span>
</pre>
</div>
<div class="section" id="reset">
<h3>4.5 Reset</h3>
<pre class="code python"><a name="rest_code_6f88f30a2d134bebb8afcbd1e7883965-1"></a><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_6f88f30a2d134bebb8afcbd1e7883965-2"></a>    <span class="sd">"""sets the counts and rewards to None</span>
<a name="rest_code_6f88f30a2d134bebb8afcbd1e7883965-3"></a>
<a name="rest_code_6f88f30a2d134bebb8afcbd1e7883965-4"></a><span class="sd">    This lets you re-used the EpsilonGreedy without re-constructing</span>
<a name="rest_code_6f88f30a2d134bebb8afcbd1e7883965-5"></a><span class="sd">    the arms</span>
<a name="rest_code_6f88f30a2d134bebb8afcbd1e7883965-6"></a><span class="sd">    """</span>
<a name="rest_code_6f88f30a2d134bebb8afcbd1e7883965-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_6f88f30a2d134bebb8afcbd1e7883965-8"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_rewards</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_6f88f30a2d134bebb8afcbd1e7883965-9"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_6f88f30a2d134bebb8afcbd1e7883965-10"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="select-arm">
<h3>4.6 Select Arm</h3>
<p>The <em>select_arm</em> method will choose either the best arm or a random one based on a randomly drawn value and how it compares to epsilon.</p>
<pre class="code python"><a name="rest_code_b0a20645b4c14eaaa245e457edfd9acd-1"></a><span class="k">def</span> <span class="nf">select_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_b0a20645b4c14eaaa245e457edfd9acd-2"></a>    <span class="sd">"""chooses the next arm to update</span>
<a name="rest_code_b0a20645b4c14eaaa245e457edfd9acd-3"></a>
<a name="rest_code_b0a20645b4c14eaaa245e457edfd9acd-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_b0a20645b4c14eaaa245e457edfd9acd-5"></a><span class="sd">     int: index of the next arm to pull</span>
<a name="rest_code_b0a20645b4c14eaaa245e457edfd9acd-6"></a><span class="sd">    """</span>
<a name="rest_code_b0a20645b4c14eaaa245e457edfd9acd-7"></a>    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">:</span>
<a name="rest_code_b0a20645b4c14eaaa245e457edfd9acd-8"></a>        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_b0a20645b4c14eaaa245e457edfd9acd-9"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_arm</span>
</pre>
</div>
<div class="section" id="update">
<h3>4.7 Update</h3>
<p>The update method pulls the arm whose index it is given and then updates the count and reward.</p>
<pre class="code python"><a name="rest_code_318e77a900f84e238dc4e13c8ee1d4e0-1"></a><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">):</span>
<a name="rest_code_318e77a900f84e238dc4e13c8ee1d4e0-2"></a>    <span class="sd">"""pulls the arm and updates the value</span>
<a name="rest_code_318e77a900f84e238dc4e13c8ee1d4e0-3"></a>
<a name="rest_code_318e77a900f84e238dc4e13c8ee1d4e0-4"></a><span class="sd">    Args:</span>
<a name="rest_code_318e77a900f84e238dc4e13c8ee1d4e0-5"></a><span class="sd">     arm (int): index of the arm to pull</span>
<a name="rest_code_318e77a900f84e238dc4e13c8ee1d4e0-6"></a><span class="sd">    """</span>
<a name="rest_code_318e77a900f84e238dc4e13c8ee1d4e0-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a name="rest_code_318e77a900f84e238dc4e13c8ee1d4e0-8"></a>    <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
<a name="rest_code_318e77a900f84e238dc4e13c8ee1d4e0-9"></a>    <span class="n">average_reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
<a name="rest_code_318e77a900f84e238dc4e13c8ee1d4e0-10"></a>    <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">arm</span><span class="p">]()</span>
<a name="rest_code_318e77a900f84e238dc4e13c8ee1d4e0-11"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">+=</span> <span class="n">reward</span>
<a name="rest_code_318e77a900f84e238dc4e13c8ee1d4e0-12"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">))</span> <span class="o">*</span> <span class="n">average_reward</span>
<a name="rest_code_318e77a900f84e238dc4e13c8ee1d4e0-13"></a>                        <span class="o">+</span> <span class="p">(</span><span class="n">reward</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">)))</span>
<a name="rest_code_318e77a900f84e238dc4e13c8ee1d4e0-14"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="call">
<h3>4.8 Call</h3>
<p>The <em>__call__</em> method will be the main update method that unifies the naming conventions found in the books.</p>
<pre class="code python"><a name="rest_code_8bbea1d04b72473ba428ff23b44749fb-1"></a><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_8bbea1d04b72473ba428ff23b44749fb-2"></a>    <span class="sd">"""chooses an arm and updates the rewards"""</span>
<a name="rest_code_8bbea1d04b72473ba428ff23b44749fb-3"></a>    <span class="n">arm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_arm</span><span class="p">()</span>
<a name="rest_code_8bbea1d04b72473ba428ff23b44749fb-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
<a name="rest_code_8bbea1d04b72473ba428ff23b44749fb-5"></a>    <span class="k">return</span>
</pre>
</div>
</div>
<div class="section" id="epsilon-greedy-optimized">
<h2>5 Epsilon Greedy Optimized</h2>
<p>It turns out that while the implementation above works correctly, it can be rather slow, given that we need to train it thousands of times to get meaningful results. This is a numba-compatible version that drops the testing time from around 11 minutes to a minute or less. One of the restrictions of using classes in numba is that you have to declare the types of all the attributes of the class (this happens in the <cite>spec</cite> passed to the <cite>jitclass</cite> decorator). This means that I can't pass in <cite>BernoulliArm</cite> objects to the constructor, because <cite>numba</cite> has no idea what they are, so this solution is a hybrid greedy algorithm and bandit arm mashed together.</p>
<p>The documentation for <cite>numba</cite> states that you have to initialize the attributes in the <cite>__init__</cite> method so I'm getting rid of the properties that build the numpy arrays and moving their creation to the constructor. In addition, the code that no longer expects the =BernoulliArm= objects will have to be re-implemented. In the tangle code anything with the <cite>optimized-</cite> prefix is re-implemented (other than the <cite>spec</cite>), otherwise the code is being pulled in from the original <cite>EpsilonGreedy</cite> implementation.</p>
<pre class="code python"><a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-1"></a><span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-2"></a>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-3"></a><span class="o">&lt;&lt;</span><span class="n">spec</span><span class="o">&gt;&gt;</span>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-4"></a>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-5"></a><span class="o">&lt;&lt;</span><span class="n">find</span><span class="o">-</span><span class="n">first</span><span class="o">&gt;&gt;</span>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-6"></a><span class="nd">@jitclass</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-7"></a><span class="k">class</span> <span class="nc">EpsilonGreedyOptimized</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-8"></a>    <span class="sd">"""The Epsilon Greedy Algorithm</span>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-9"></a>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-10"></a><span class="sd">    Args:</span>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-11"></a><span class="sd">     epsilon (float): fraction of the time to explore</span>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-12"></a><span class="sd">     arms (list): collection of probabilities for bandit arm</span>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-13"></a><span class="sd">    """</span>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-14"></a>    <span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">constructor</span><span class="o">&gt;&gt;</span>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-15"></a>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-16"></a>    <span class="o">&lt;&lt;</span><span class="n">best</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-17"></a>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-18"></a>    <span class="o">&lt;&lt;</span><span class="n">select</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-19"></a>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-20"></a>    <span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">pull</span><span class="o">-</span><span class="n">arm</span><span class="o">&gt;&gt;</span>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-21"></a>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-22"></a>    <span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">update</span><span class="o">&gt;&gt;</span>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-23"></a>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-24"></a>    <span class="o">&lt;&lt;</span><span class="n">optimized</span><span class="o">-</span><span class="n">reset</span><span class="o">&gt;&gt;</span>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-25"></a>
<a name="rest_code_b8a2b0eb39c8448185cbf291c82cf9be-26"></a>    <span class="o">&lt;&lt;</span><span class="n">call</span><span class="o">&gt;&gt;</span>
</pre>
<div class="section" id="optimized-imports">
<h3>5.1 Optimized Imports</h3>
<pre class="code python"><a name="rest_code_2d1b97d4426f4ec0b5d08cda88eed1ec-1"></a><span class="c1"># python</span>
<a name="rest_code_2d1b97d4426f4ec0b5d08cda88eed1ec-2"></a><span class="kn">import</span> <span class="nn">random</span>
<a name="rest_code_2d1b97d4426f4ec0b5d08cda88eed1ec-3"></a>
<a name="rest_code_2d1b97d4426f4ec0b5d08cda88eed1ec-4"></a><span class="c1"># pypi</span>
<a name="rest_code_2d1b97d4426f4ec0b5d08cda88eed1ec-5"></a><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_2d1b97d4426f4ec0b5d08cda88eed1ec-6"></a>    <span class="n">jit</span><span class="p">,</span>
<a name="rest_code_2d1b97d4426f4ec0b5d08cda88eed1ec-7"></a>    <span class="n">jitclass</span><span class="p">,</span>
<a name="rest_code_2d1b97d4426f4ec0b5d08cda88eed1ec-8"></a>    <span class="p">)</span>
<a name="rest_code_2d1b97d4426f4ec0b5d08cda88eed1ec-9"></a><span class="kn">import</span> <span class="nn">numba</span>
<a name="rest_code_2d1b97d4426f4ec0b5d08cda88eed1ec-10"></a><span class="kn">import</span> <span class="nn">numpy</span>
</pre>
</div>
<div class="section" id="the-spec">
<h3>5.2 The Spec</h3>
<p>This is how you tell numba what attributes the class will have. This is where most of the errors were when I first tried this. The error-messages aren't particularly helpful. Just be aware that this is the first place you should look if things crash.</p>
<pre class="code python"><a name="rest_code_b06983598a0043398d0f06c2b06d98dc-1"></a><span class="n">spec</span> <span class="o">=</span> <span class="p">[</span>
<a name="rest_code_b06983598a0043398d0f06c2b06d98dc-2"></a>    <span class="p">(</span><span class="s2">"epsilon"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">),</span>
<a name="rest_code_b06983598a0043398d0f06c2b06d98dc-3"></a>    <span class="p">(</span><span class="s2">"arms"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a name="rest_code_b06983598a0043398d0f06c2b06d98dc-4"></a>    <span class="p">(</span><span class="s2">"counts"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a name="rest_code_b06983598a0043398d0f06c2b06d98dc-5"></a>    <span class="p">(</span><span class="s2">"rewards"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">double</span><span class="p">[:]),</span>
<a name="rest_code_b06983598a0043398d0f06c2b06d98dc-6"></a>    <span class="p">(</span><span class="s2">"total_reward"</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
<a name="rest_code_b06983598a0043398d0f06c2b06d98dc-7"></a><span class="p">]</span>
</pre>
</div>
<div class="section" id="id2">
<h3>5.3 The Constructor</h3>
<p>The constructor takes two arguments - <em>epsilon</em> and <em>arms</em>. The <em>arms</em> list should contain probabilities that a reward or penalty will be returned when pulled.</p>
<pre class="code python"><a name="rest_code_585b5f5006b149099a36b0f03b7fbb62-1"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">arms</span><span class="p">):</span>
<a name="rest_code_585b5f5006b149099a36b0f03b7fbb62-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
<a name="rest_code_585b5f5006b149099a36b0f03b7fbb62-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="n">arms</span>
<a name="rest_code_585b5f5006b149099a36b0f03b7fbb62-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_585b5f5006b149099a36b0f03b7fbb62-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_585b5f5006b149099a36b0f03b7fbb62-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_585b5f5006b149099a36b0f03b7fbb62-7"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="id3">
<h3>5.4 Reset</h3>
<pre class="code python"><a name="rest_code_d0ea99283ba9467c9cab96e65bb59234-1"></a><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_d0ea99283ba9467c9cab96e65bb59234-2"></a>    <span class="sd">"""sets the counts, rewards, total_reward to 0s</span>
<a name="rest_code_d0ea99283ba9467c9cab96e65bb59234-3"></a>
<a name="rest_code_d0ea99283ba9467c9cab96e65bb59234-4"></a><span class="sd">    This lets you re-used the EpsilonGreedy</span>
<a name="rest_code_d0ea99283ba9467c9cab96e65bb59234-5"></a><span class="sd">    """</span>
<a name="rest_code_d0ea99283ba9467c9cab96e65bb59234-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_d0ea99283ba9467c9cab96e65bb59234-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
<a name="rest_code_d0ea99283ba9467c9cab96e65bb59234-8"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_d0ea99283ba9467c9cab96e65bb59234-9"></a>    <span class="k">return</span>
</pre>
</div>
<div class="section" id="pull-arm">
<h3>5.5 Pull Arm</h3>
<p>Since we can't give user-defined objects as attributes of the class, this version will be both algorithm and bandit.</p>
<pre class="code python"><a name="rest_code_55930c8fd4c84c6a9403906b8854a5d3-1"></a><span class="k">def</span> <span class="nf">pull_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">):</span>
<a name="rest_code_55930c8fd4c84c6a9403906b8854a5d3-2"></a>    <span class="sd">"""gets the reward</span>
<a name="rest_code_55930c8fd4c84c6a9403906b8854a5d3-3"></a>
<a name="rest_code_55930c8fd4c84c6a9403906b8854a5d3-4"></a><span class="sd">    Args:</span>
<a name="rest_code_55930c8fd4c84c6a9403906b8854a5d3-5"></a><span class="sd">     arm (int): index for the arm-probability array</span>
<a name="rest_code_55930c8fd4c84c6a9403906b8854a5d3-6"></a><span class="sd">    Returns:</span>
<a name="rest_code_55930c8fd4c84c6a9403906b8854a5d3-7"></a><span class="sd">     int: reward or no reward</span>
<a name="rest_code_55930c8fd4c84c6a9403906b8854a5d3-8"></a><span class="sd">    """</span>
<a name="rest_code_55930c8fd4c84c6a9403906b8854a5d3-9"></a>    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">arm</span><span class="p">]:</span>
<a name="rest_code_55930c8fd4c84c6a9403906b8854a5d3-10"></a>        <span class="k">return</span> <span class="mi">0</span>
<a name="rest_code_55930c8fd4c84c6a9403906b8854a5d3-11"></a>    <span class="k">return</span> <span class="mi">1</span>
</pre>
</div>
<div class="section" id="id4">
<h3>5.6 Update</h3>
<p>The update method pulls the arm whose index it is given and then updates the count and reward. Here we're calling the <tt class="docutils literal">pull_arm</tt> method instead of using a <tt class="docutils literal">BernoulliArm</tt> so we can't re-use the original method.</p>
<pre class="code python"><a name="rest_code_97b6389b3f044909854125e9802215da-1"></a><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">):</span>
<a name="rest_code_97b6389b3f044909854125e9802215da-2"></a>    <span class="sd">"""pulls the arm and updates the value</span>
<a name="rest_code_97b6389b3f044909854125e9802215da-3"></a>
<a name="rest_code_97b6389b3f044909854125e9802215da-4"></a><span class="sd">    Args:</span>
<a name="rest_code_97b6389b3f044909854125e9802215da-5"></a><span class="sd">     arm (int): index of the arm to pull</span>
<a name="rest_code_97b6389b3f044909854125e9802215da-6"></a><span class="sd">    """</span>
<a name="rest_code_97b6389b3f044909854125e9802215da-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a name="rest_code_97b6389b3f044909854125e9802215da-8"></a>    <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
<a name="rest_code_97b6389b3f044909854125e9802215da-9"></a>    <span class="n">average_reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
<a name="rest_code_97b6389b3f044909854125e9802215da-10"></a>    <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_arm</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
<a name="rest_code_97b6389b3f044909854125e9802215da-11"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">+=</span> <span class="n">reward</span>
<a name="rest_code_97b6389b3f044909854125e9802215da-12"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">))</span> <span class="o">*</span> <span class="n">average_reward</span>
<a name="rest_code_97b6389b3f044909854125e9802215da-13"></a>                        <span class="o">+</span> <span class="p">(</span><span class="n">reward</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">)))</span>
<a name="rest_code_97b6389b3f044909854125e9802215da-14"></a>    <span class="k">return</span>
</pre>
</div>
</div>
<div class="section" id="references">
<h2>6 References</h2>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup>
<col class="label">
<col>
</colgroup>
<tbody valign="top"><tr>
<td class="label"><a class="fn-backref" href="posts/The-Epsilon-Greedy-Algorithm/#id1">[1]</a></td>
<td>Bandit Algorithms for Website Optimization by John Myles White. Copyright 2013 John Myles White, 978-1-449-34133-6</td>
</tr></tbody>
</table>
</div>
</div>
    </div>
    </article>
</div>







        </div>
        <!--End of body content-->

        <footer id="footer">
            Contents  2017         <a href="mailto:necromuralist@gmail.com">necromuralist</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a>
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
